#define a.dracula   o3#define a.coffin    o4#define dark.pic    v31#define wake.timer  v32#define stake.timer v33#define asked.which.key f32#define stake.dracula   f33#define catch.ego   f34#define bite.ego    f35#define drac.sees.cross f37#define drac.exit.coffin    f38#define drac.awakes f39if (newRoom)  {  load.view(View99);  load.view(View58);  dark.pic = 96;  load.pic(dark.pic);  animate.obj(a.coffin);  random(0, 255, work.3);  if (work.f)    {    work.3 = 0;    }  if (work.3 < 128 &&       dracula.state != draculaSTAKED)    {    dracula.state = draculaIN_COFFIN;    coffin.state = 0;    animate.obj(a.dracula);    work = 2;    step.size(a.dracula, work);    release.priority(a.dracula);    load.view(View53);    load.view(View59);    load.view(View51);    load.view(View52);    load.view(View57);    load.view(View60);    set.view(a.coffin, View57);    set.cel(a.coffin, 0);    }  else    {    if (dracula.state != draculaSTAKED)      {      dracula.state = 0;      }    set.view(a.coffin, View58);    if (coffin.state == draculaSTAKED)      {      set.cel(a.coffin, 0);      }    else      {      set.cel(a.coffin, 3);      coffin.state = 1;      }    }  position(ego, 132, 130);  if (candle.lit)    {    v30 = 1;    reset(dark.basement);    load.pic(currentRoom);    draw.pic(currentRoom);    discard.pic(currentRoom);    ignore.blocks(a.coffin);    position(a.coffin, 65, 95);    draw(a.coffin);    stop.update(a.coffin);    }  else    {    v30 = 0;    set(dark.basement);    set.view(ego, View99);    draw.pic(dark.pic);    set.priority(ego, 12);    set.priority(a.dracula, 4);    set.priority(a.coffin, 4);    }  draw(ego);  show.pic();  }if (v35 > 0)  {  discard.view(View60);  discard.view(View57);  discard.view(View52);  discard.view(View51);  discard.view(View59);  if (v35 == 6)    {    discard.view(View53);    }  v35 = 0;  }--wake.timer;if (dracula.state == draculaIN_COFFIN &&     wake.timer == 0 &&     coffin.state == 1)  {  start.update(a.coffin);  set.cel(a.coffin, 0);  set.view(a.coffin, View60);  work = 2;  cycle.time(a.coffin, work);  end.of.loop(a.coffin, drac.awakes);  dracula.state = draculaAWAKE;  print("Count Dracula is awake! Run before it's too late!");  }if (drac.awakes)  {  reset(drac.awakes);  v34 = 2;  set.view(a.coffin, View58);  set.cel(a.coffin, 3);  set.view(a.dracula, View51);  position(a.dracula, 73, 107);  draw(a.dracula);  set(drac.exit.coffin);  follow.ego(a.dracula, 4, catch.ego);  force.update(a.coffin);  }if (catch.ego)  {  print("You are caught in Dracula's grasp! Saliva drips off the end of his "        "sharp fangs.");  reset(catch.ego);  if (wearing.cross)    {    print("Suddenly, he is aware of the silver cross you are wearing around "          "your neck!");    set(drac.sees.cross);    }  else    {    if (!candle.lit)      {      set.priority(ego, 4);      }    prevent.input();    erase(a.dracula);    stop.motion(ego);    if ((posn(ego, 32, 96, 44, 100) ||         posn(ego, 28, 111, 40, 127) ||         posn(ego, 23, 128, 35, 144) ||         posn(ego, 18, 145, 31, 160) ||         posn(ego, 97, 94, 104, 106)))      {      temp.x = 0;      temp.y = 0;      }    else      {      temp.x = 248;      temp.y = 0;      }    reposition(ego, temp.x, temp.y);    set.view(ego, View53);    work = 3;    cycle.time(ego, work);    set(keep.cycling);    set.cel(ego, 0);    end.of.loop(ego, bite.ego);    v35 = 5;    }  }if (bite.ego)  {  stop.cycling(ego);  reset(keep.cycling);  print("You feel them sink into the soft flesh of your neck, and then ... "        "nothing.");  reset(bite.ego);  dracula.state = draculaBITE_EGO;  set(certain.death);  }if (v34 == 2 && drac.sees.cross)  {  v34 = 0;  }else  {  if (isset(f36))    {    erase(a.dracula);    reset(drac.exit.coffin);    reset(f36);    v35 = 6;    }  --stake.timer;  if (stake.timer == 1)    {    force.update(a.coffin);    set.view(a.coffin, View58);    set.cel(a.coffin, 3);    reset(keep.cycling);    start.motion(ego);    set.view(ego, View0);    set.loop(ego, 1);    get.posn(ego, work.2, work.3);    temp.x = 76;    temp.y = 107;    temp.x -= work.2;    temp.y -= work.3;    reposition(ego, temp.x, temp.y);    v35 = 6;    print("You place the pointed stake on Count Dracula's chest. Quickly, using "          "the mallet, you pound the stake through his heart. Dracula "          "disintegrates into a pile of dust. A small silver key is left behind "          "in the coffin.");    }  if (stake.dracula)    {    reset(stake.dracula);    stop.motion(ego);    set.cel(ego, 0);    get.posn(ego, work.2, work.3);    temp.x = 65;    temp.y = 107;    temp.x -= work.2;    temp.y -= work.3;    reposition(ego, temp.x, temp.y);    set.view(ego, View59);    stake.timer = 25;    currentScore  += 4;    currentScore  += v80;    }  if (!candle.lit)    {    if (v30 == 1)      {      v30 = 2;      set(dark.basement);      if (drac.exit.coffin)        {        erase(a.dracula);        }      draw.pic(dark.pic);      show.pic();      set.priority(ego, 12);      set.view(ego, View99);      set.priority(a.dracula, 4);      set.priority(a.coffin, 4);      stop.update(a.coffin);      force.update(a.coffin);      if (drac.exit.coffin)        {        draw(a.dracula);        }      }    else      {      goto(Label14);      }    }  if (!haveInput)    {    goto(Label15);    }  if ((said("check out") ||       said("check out", "antique shop") ||       said("check out", "swim")))    {    print("There is a beautiful, ornate coffin to one side of this dreadful "          "room. Dust is everywhere, cobwebs fill the corners, and a sickly "          "odor permeates the air.");    }  if (said("acquire", "casket"))    {    print("You don't think you could carry around a heavy %w2, do you?");    }  if ((said("get in", "casket") ||       said("enter", "casket") ||       said("climb", "casket")))    {    print("That is truly crazy!");    }  if (!said("check out", "casket") &&       !said("look in", "casket"))    {    goto(Label2);    }  if (!posn(ego, 50, 105, 97, 109))    {    print("At this distance the candle does not provide enough light for you to "          "see much detail.");    goto(Label15);    }  if (coffin.state != 1)    {    print("The lid of the beautifully carved coffin is closed.");    goto(Label15);    }  if (dracula.state == draculaIN_COFFIN)    {    print("Quaking, you look into the beautiful coffin. A vampire is lying "          "asleep within it! It must be Count Dracula!");    goto(Label15);    }  else    {    print("Trembling with fear, you peer into the ornate coffin. Finding it "          "unoccupied, you see the interior is lined with shiny red satin.");    }Label1:  if (!took.pillow)    {    print("A red satin pillow lies at one end.");    }  else    {    if (!got.gold.key.3)      {      print("Against the red satin, you notice a large golden key!");      }    }  if (!took.silver.key && dracula.state == draculaSTAKED)    {    print("A small silver key is lying within the coffin!");    }  goto(Label15);Label2:  if (!said("open", "casket") &&       !said("open", "lid"))    {    goto(Label3);    }  if (coffin.state == 1)    {    print("The lid to the coffin is already up.");    }  else    {    if (!posn(ego, 50, 105, 97, 115))      {      print("To do that, you will need to get closer.");      }    else      {      start.update(a.coffin);      end.of.loop(a.coffin, done);      coffin.state = 1;      if (dracula.state != 1)        {        print("Nervously, you lift the heavy lid of the elegant coffin. You "              "peek into its red satin interior. The coffin is unoccupied.");        goto(Label1);        }      else        {        print("With trepidation, you lift the heavy lid of the beautifully "              "carved coffin. Your heart beats wildly when you see a vampire "              "lying asleep within it! It must be Count Dracula!");        wake.timer = 100;        }      }    }  goto(Label15);Label3:  if (!said("close", "casket") &&       !said("close", "lid"))    {    goto(Label4);    }  if (coffin.state != 1)    {    print("The lid to the coffin is already closed.");    }  else    {    if (!posn(ego, 50, 105, 97, 115))      {      print("To do that, you will need to get closer.");      }    else      {      start.update(a.coffin);      reverse.loop(a.coffin, done);      coffin.state = 2;      wake.timer = 0;      }    }  goto(Label15);Label4:  if (said("acquire", "cushion"))    {    if (has("Pillow"))      {      print("You already have.");      }    else      {      if ((coffin.state != 1 || took.pillow))        {        print("You don't see one here.");        }      else        {        if (!posn(ego, 50, 105, 97, 115))          {          print("To do that, you will need to get closer.");          }        else          {          if (dracula.state == 1)            {            print("That was truly a dumb thing to do! Run before he catches "                  "you!");            wake.timer = 0;            }          else            {            print("You remove the shiny red %w2 from the coffin. Lo and behold, "                  "a large gold key was under the %w2!");            get("Pillow");            set(took.pillow);            }          }        }      }    }  if (coffin.state == 1)    {    if (dracula.state == draculaSTAKED)      {      if (!took.silver.key)        {        if ((!took.pillow || got.gold.key.3))          {          goto(Label6);          }        else          {          goto(Label7);          }        }      }    if (took.pillow && !got.gold.key.3)      {      goto(Label5);      }    }  if ((said("acquire", "key") ||       said("acquire", "gold", "key") ||       said("acquire", "silver", "key") ||       said("acquire", "keys") ||       said("acquire", "both", "keys")))    {    print("You don't see one here.");    goto(Label15);    }  goto(Label12);Label5:  if ((said("acquire", "key") ||       said("acquire", "gold", "key")))    {    if (!posn(ego, 50, 105, 97, 115))      {      print("To do that, you will need to get closer.");      }    else      {      goto(Label8);      }    }  goto(Label11);Label6:  if ((said("acquire", "key") ||       said("acquire", "silver", "key")))    {    if (!posn(ego, 50, 105, 97, 115))      {      print("To do that, you will need to get closer.");      }    else      {      goto(Label9);      }    }  goto(Label11);Label7:  if (said("acquire", "key"))    {    print("There are two keys in the coffin. Do you want the gold one or the "          "silver one?");    set(asked.which.key);    goto(Label15);    }  if (said("acquire", "gold", "key"))    {    goto(Label8);    }  if (asked.which.key &&       (said("gold", "one") ||       said("gold", "key") ||       said("acquire", "gold", "one")))    {    goto(Label8);    }  if (said("acquire", "silver", "key"))    {    goto(Label9);    }  if (asked.which.key &&       (said("silver", "one") ||       said("silver", "key") ||       said("acquire", "silver", "one")))    {    goto(Label9);    }  if ((said("acquire", "keys") ||       said("acquire", "both", "keys")))    {    goto(Label10);    }  if (asked.which.key &&       said("acquire", "both", "them"))    {    goto(Label10);    }  if (!haveMatch &&       said("anyword", "anyword"))    {    reset(haveMatch);    reset(asked.which.key);    }  goto(Label12);Label8:  print("OK.");  get("Gold Key");  set(got.gold.key.3);  reset(asked.which.key);  currentScore  += 5;  goto(Label15);Label9:  print("OK.");  get("Silver Key");  set(took.silver.key);  reset(asked.which.key);  currentScore  += 2;  goto(Label15);Label10:  print("OK.");  get("Gold Key");  set(got.gold.key.3);  get("Silver Key");  set(took.silver.key);  reset(asked.which.key);  currentScore  += 5;  currentScore  += 2;  goto(Label15);Label11:  if ((said("acquire", "keys") ||       said("acquire", "both", "keys")))    {    print("There is only one key here.");    goto(Label15);    }  else    {    if ((said("anyword", "key") ||         said("anyword", "anyword", "key")))      {      if (!said("check out", "key") &&           !said("check out", "anyword", "key"))        {        print("You don't see one here.");        goto(Label15);        }      else        {        reset(haveMatch);        }      }    }Label12:  if ((said("show", "cross") ||       said("show", "count dracula", "cross")))    {    if (!has("Cross"))      {      print("You don't have it!");      goto(Label15);      }    }  if (dracula.state == draculaIN_COFFIN &&       coffin.state == 1)    {    if ((said("speak", "count dracula") ||         said("hello", "anyword") ||         said("say", "hello") ||         said("show", "cross") ||         said("show", "count dracula", "cross")))      {      print("Count Dracula is fast asleep in his coffin. He pays you no heed.");      }    else      {      if ((said("acquire", "count dracula") ||           said("capture", "count dracula")))        {        print("That is truly crazy!");        }      else        {        if (!posn(ego, 50, 105, 97, 115))          {          if ((said("wake", "count dracula") ||               said("kill", "count dracula") ||               said("pound", "pole", "count dracula")))            {            print("To do that, you will need to get closer.");            }          else            {            if (said("check out", "count dracula"))              {              print("At this distance the candle does not provide enough light "                    "for you to see much detail.");              }            }          }        else          {          if (said("wake", "count dracula"))            {            print("That was truly a dumb thing to do! Run before he catches "                  "you!");            wake.timer = 0;            }          else            {            if ((said("kill", "count dracula") ||                 said("pound", "pole", "count dracula")))              {              if (has("Stake") &&                   has("Mallet") &&                   !said("kill", "count dracula", "knife"))                {                set(keep.cycling);                move.obj(ego, 76, 107, 0, stake.dracula);                wake.timer = 250;                dracula.state = draculaSTAKED;                }              else                {                if (has("Sword") &&                     !said("pound", "pole", "count dracula"))                  {                  print("You plunge the sword into Count Dracula's sleeping "                        "body. Oh, dear! It has no effect. You just woke him "                        "up.");                  wake.timer = 0;                  }                else                  {                  print("You have no way of killing Count Dracula. You are in "                        "mortal danger!");                  }                }              }            else              {              if (said("check out", "count dracula"))                {                print("Count Dracula is tall and elegantly dressed with a black "                      "cloak wrapped around him. His face and hands are chalk "                      "white. His lips are blood red.");                }              }            }          }        }      }    goto(Label15);    }  if (dracula.state == 1 &&       coffin.state != 1)    {    if ((said("speak", "count dracula") ||         said("kill", "count dracula")))      {      print("The coffin isn't open.");      }    }Label13:  if (dracula.state == draculaAWAKE)    {    if ((said("speak", "count dracula") ||         said("hello", "anyword") ||         said("say", "hello")))      {      print("You don't want to chitchat with Count Dracula!");      }    else      {      if ((said("show", "cross") ||           said("show", "count dracula", "cross")))        {        set(drac.sees.cross);        }      else        {        if ((said("kill", "count dracula") ||             said("pound", "pole", "count dracula")))          {          print("You have no way of killing Count Dracula. You are in mortal "                "danger!");          }        else          {          if (said("check out", "count dracula"))            {            print("Count Dracula is tall and elegantly dressed with a black "                  "cloak wrapped around him. His face and hands are chalk "                  "white. His lips are blood red.");            }          else            {            if ((said("anyword", "count dracula") ||                 said("anyword", "anyword", "count dracula")))              {              print("You don't have time! Run for your life!");              }            }          }        }      }    goto(Label15);    }  if ((said("anyword", "count dracula") ||       said("anyword", "anyword", "count dracula") ||       said("show", "cross")))    {    if ((dracula.state != 1 ||         coffin.state == 3))      {      print("There is no one here but you.");      }    else      {      if (coffin.state == 2)        {        print("Count Dracula is fast asleep in his coffin. He pays you no heed.");        }      }    }  goto(Label15);  }print("Count Dracula is terrified of the cross. He turns into a bat and flies "      "away.");force.update(a.coffin);set.cel(a.coffin, 3);set.view(a.coffin, View58);set.view(a.dracula, View52);work = 2;cycle.time(a.dracula, work);step.size(a.dracula, work);ignore.blocks(a.dracula);ignore.objs(a.dracula);start.cycling(a.dracula);set.priority(a.dracula, 11);dracula.state = 4;move.obj(a.dracula, 137, 80, 0, f36);currentScore  += v80;v80 = 0;goto(Label15);Label14:if (!haveMatch &&     !said("light", "candle"))  {  if (said("check out", "anyword"))    {    print("It is pitch black in here! You can't see a thing!");    }  else    {    if (said("show", "cross"))      {      goto(Label13);      }    else      {      if (said("anyword", "anyword"))        {        print("You can't do that while stumbling around in the dark.");        }      }    }  }Label15:if (!isset(haveMatch) &&     said("check out", "anyword"))  {  if (dracula.state == 3)    {    print("You don't have time! Run for your life!");    }  else    {    if (dracula.state == 1)      {      print("Are you crazy? Dracula hangs out here, and you want to stand "            "around looking at things?");      }    else      {      reset(haveMatch);      }    }  }if (edgeEgoHit == RIGHT_EDGE)  {  observe.objs(a.dracula);  release.priority(ego);  release.priority(a.dracula);  force.update(a.coffin);  release.priority(a.coffin);  if (dracula.state == 0)    {    random(0, 100, work.3);    if (work.3 < 128)      {      dracula.state = 61;      }    else      {      dracula.state = 64;      }    }  if (dracula.state == 3)    {    dracula.state = 71;    }  new.room(Logic66); [ ##LE001##  }return();[ Messages#message 1 "There is a beautiful, ornate coffin to one side of this dreadful room. Dust is everywhere, cobwebs fill the corners, and a sickly odor permeates the air."#message 2 "The lid of the beautifully carved coffin is closed."#message 3 "Trembling with fear, you peer into the ornate coffin. Finding it unoccupied, you see the interior is lined with shiny red satin."#message 4 "A red satin pillow lies at one end."#message 5 "Against the red satin, you notice a large golden key!"#message 6 "A small silver key is lying within the coffin!"#message 7 "Quaking, you look into the beautiful coffin. A vampire is lying asleep within it! It must be Count Dracula!"#message 8 "The lid to the coffin is already up."#message 9 "Nervously, you lift the heavy lid of the elegant coffin. You peek into its red satin interior. The coffin is unoccupied."#message 10 "With trepidation, you lift the heavy lid of the beautifully carved coffin. Your heart beats wildly when you see a vampire lying asleep within it! It must be Count Dracula!"#message 11 "The lid to the coffin is already closed."#message 12 "Count Dracula is tall and elegantly dressed with a black cloak wrapped around him. His face and hands are chalk white. His lips are blood red."#message 13 "You remove the shiny red %w2 from the coffin. Lo and behold, a large gold key was under the %w2!"#message 14 "At this distance the candle does not provide enough light for you to see much detail."#message 15 "There are two keys in the coffin. Do you want the gold one or the silver one?"#message 16 "There is only one key here."#message 17 "You don't think you could carry around a heavy %w2, do you?"#message 18 "Count Dracula is awake! Run before it's too late!"#message 19 "You are caught in Dracula's grasp! Saliva drips off the end of his sharp fangs."#message 20 "You feel them sink into the soft flesh of your neck, and then ... nothing."#message 21 "Count Dracula is fast asleep in his coffin. He pays you no heed."#message 22 "You don't want to chitchat with Count Dracula!"#message 23 "That is truly crazy!"#message 24 "You place the pointed stake on Count Dracula's chest. Quickly, using the mallet, you pound the stake through his heart. Dracula disintegrates into a pile of dust. A small silver key is left behind in the coffin."#message 25 "You have no way of killing Count Dracula. You are in mortal danger!"#message 26 "You plunge the sword into Count Dracula's sleeping body. Oh, dear! It has no effect. You just woke him up."#message 27 "You need something to pound the stake with."#message 28 "That was truly a dumb thing to do! Run before he catches you!"#message 29 "To do that, you will need to get closer."#message 30 "There is no one here but you."#message 31 "You don't have time! Run for your life!"#message 32 "Count Dracula is terrified of the cross. He turns into a bat and flies away."#message 33 "You don't have it!"#message 34 "You don't see one here."#message 35 "You already have."#message 36 "OK."#message 37 "You can't do that while stumbling around in the dark."#message 38 "Suddenly, he is aware of the silver cross you are wearing around your neck!"#message 39 "It is pitch black in here! You can't see a thing!"#message 40 "Are you crazy? Dracula hangs out here, and you want to stand around looking at things?"#message 41 "The coffin isn't open."