#define a.mirror    o1#define a.boulder   o2#define a.dragon    o3#define burned.ego  f20#define dragon.moves.boulder   f21#define boulder.moved   f22#define dragon.leaves   f23#define dragon.step v30#define dragon.loop v31if (newRoom)  {  load.pic(currentRoom);  draw.pic(currentRoom);  discard.pic(currentRoom);  if (!took.mirror)    {    load.view(View34);    }  if (dragon.state == dragonDEAD)    {    load.view(View61);    }  if (dragon.state == dragonINITIAL)    {    load.view(View33);    load.view(View61);    load.view(View82);    load.sound(m.badguy);    load.sound(Sound7);    }  load.view(View35);  if (previousRoom == 52)    {    set.view(ego, View0);    reset(keep.cycling);    drown.swim = 0;    position(ego, 133, 136);    if (!met.dragon)      {      set(met.dragon);      currentScore  += 1;      }    }  if (previousRoom == 50)    {    position(ego, 9, 138);    }  if (!took.mirror)    {    animate.obj(a.mirror);    set.view(a.mirror, View34);    position(a.mirror, 38, 108);    draw(a.mirror);    stop.update(a.mirror);    }  if (dragon.state == dragonDOUSED)    {    animate.obj(a.boulder);    set.view(a.boulder, View35);    ignore.blocks(a.boulder);    position(a.boulder, 8, 127);    draw(a.boulder);    stop.cycling(a.boulder);    }  if (dragon.state != dragonDOUSED)    {    animate.obj(a.boulder);    set.view(a.boulder, View35);    ignore.blocks(a.boulder);    position(a.boulder, 3, 127);    draw(a.boulder);    stop.cycling(a.boulder);    animate.obj(a.dragon);    if (dragon.state == dragonDEAD)      {      add.to.pic(View61, 0, 0, 40, 152, 0, 0);      }    if (dragon.state == dragonINITIAL)      {      set.view(a.dragon, View33);      position(a.dragon, 40, 120);      dragon.step = 3;      step.size(a.dragon, dragon.step);      draw(a.dragon);      observe.blocks(a.dragon);      follow.ego(a.dragon, 20, burned.ego);      }    }  draw(ego);  show.pic();  }get.posn(ego, temp.x, temp.y);if (temp.x > 15)  {  ignore.blocks(ego);  }if (temp.x < 16)  {  if (dragon.state == 2)    {    ignore.blocks(ego);    }  else    {    observe.blocks(ego);    }  }if (dragon.state == dragonINITIAL &&     !isset(lf4))  {  set(lf4);  sound(m.badguy, lf5);  }if (dragon.state == dragonINITIAL &&     isset(lf5))  {  current.loop(a.dragon, dragon.loop);  if (dragon.loop == 0)    {    sound(Sound7, done);    }  else    {    stop.sound();    }  }if (burned.ego &&     dragon.state == dragonINITIAL)  {  reset(burned.ego);  set.view(ego, View82);  if (have.shield)    {    print("Your shield melted from the intensity of the dragon's flames!  You "          "should know about these fire-breathing dragons!  Maybe next time you "          "will be a little more careful!");    }  else    {    print("You should know about these fire-breathing dragons!  Maybe next time "          "you will be a little more careful!");    }  set(certain.death);  }if (said("check", "room"))  {  if (!took.mirror &&       dragon.state == dragonINITIAL)    {    print("The ferocious fire-breathing dragon is protecting the magic mirror.");    }  if (!took.mirror &&       dragon.state == dragonDEAD)    {    print("There is a dead dragon, a large boulder, and a seemingly ordinary "          "mirror in the cave.");    }  if (!took.mirror &&       dragon.state == dragonDOUSED)    {    print("There is a large granite boulder and a magic mirror!! in the cave.");    }  }if (said("check", "cave"))  {  if (!took.mirror &&       dragon.state == dragonINITIAL)    {    print("A green, scaly dragon breathing hot fire and smoke is protecting the "          "mirror.");    }  if (took.mirror &&       dragon.state == dragonDEAD)    {    print("In this large cavern, there is a slimy dead dragon, an opening on "          "one side, and a large boulder in the other.");    }  if (!took.mirror &&       dragon.state == dragonDEAD)    {    print("There is a dead dragon, a large boulder, and a seemingly ordinary "          "mirror in the cave.");    }  if (!took.mirror &&       dragon.state == dragonDOUSED)    {    print("There is a large granite boulder and a magic mirror!! in the cave.");    }  if (took.mirror &&       dragon.state == dragonDOUSED)    {    print("The cavern is empty, save for a couple of openings on either side.");    }  }if (said("check", "dragon"))  {  if (dragon.state == dragonDOUSED)    {    print("There is no dragon here.");    }  if (dragon.state == dragonINITIAL)    {    print("This ferocious, fire-breathing dragon with sharp, green scales and a "          "long tail is protecting the magic mirror. Watch out for the flames!");    }  if (dragon.state == dragonDEAD)    {    print("You see the once powerful dragon lying lifeless before you.");    }  }if (said("find", "dragon"))  {  if (dragon.state == dragonDOUSED)    {    print("There is no dragon here.");    }  if ((dragon.state == dragonINITIAL ||       dragon.state == dragonDEAD))    {    print("I think you found the dragon!");    }  }if ((said("check", "stalactite") ||     said("check", "stalactite")))  {  print("It took millenniums for these stalagmites and stalactites to form.");  }if (said("check", "boulder"))  {  print("This boulder is a huge chunk of granite.");  }if ((said("move", "boulder") ||     said("move", "boulder")))  {  print("This boulder is far too heavy to move.");  }if (dragon.state == dragonINITIAL)  {  if ((said("check", "doorway") ||       said("look in", "doorway")))    {    print("A strange watery light issues from the hole.");    }  if ((said("speak", "dragon") ||       said("hello") ||       said("say", "hello")))    {    print("This dragon does not respond to reason.");    }  }if (dragon.state != 0)  {  if ((said("check", "doorway") ||       said("look in", "doorway")))    {    if (posn(ego, 1, 1, 75, 166))      {      print("The hole seems to lead further into the cave.");      }    else      {      print("A strange watery light issues from the hole.");      }    }  }if (dragon.state == dragonDEAD)  {  if (said("acquire", "dagger"))    {    print("The mere thought of retrieving the dagger repulses you.");    }  }if (have.dagger)  {  if (said("use", "dagger"))    {    print("How?");    }  }if (said("kill", "dragon"))  {  if (dragon.state == dragonDOUSED)    {    print("How?");    }  if (dragon.state == dragonDEAD)    {    print("This dragon had only one life and you have taken it.");    }  if (dragon.state == dragonINITIAL)    {    if (posn(ego, 105, 96, 145, 166))      {      print("You can't do that from here.!");      }    else      {      print("How do you wish to accomplish that?");      }    }  }if (have.bucket)  {  if (said("cast", "bucket"))    {    print("You throw your bucket on the cavern floor.");    reset(have.bucket);    drop("water bucket");    currentScore -= 2;    if (have.water)      {      reset(have.water);      drop("water");      reset(points.water);      currentScore -= 2;      }    }  }if (!have.mirror && took.mirror)  {  if (said("anyword", "mirror"))    {    print("There is no mirror here.");    }  }if (!have.mirror && !took.mirror)  {  if (said("steal", "mirror") &&       dragon.state == dragonINITIAL)    {    print("With that dragon here?  No way!");    }  if (posn(ego, 26, 104, 59, 127))    {    if (said("check", "mirror"))      {      if (dragon.state == dragonINITIAL)        {        print("The dragon is protecting the magic mirror.");        }      if ((dragon.state == dragonDOUSED ||           dragon.state == dragonDEAD))        {        print("The magic mirror is framed with ornate mahogany wood, polished "              "to a high sheen.");        }      }    if (said("acquire", "mirror"))      {      if (dragon.state == dragonINITIAL)        {        print("I do not think that you can get close enough to the magic mirror "              "with the dragon here.");        }      if ((dragon.state == dragonDOUSED ||           dragon.state == dragonDEAD))        {        start.update(a.mirror);        erase(a.mirror);        set(have.mirror);        set(took.mirror);        get("magic mirror");        print("Carefully, you pick up the magic mirror.");        ++num.treasures;        currentScore  += 8;        }      }    }  if (!posn(ego, 26, 104, 59, 127))    {    if (said("check", "mirror"))      {      print("You could get a much better view if you were closer.");      }    if (said("acquire", "mirror"))      {      print("You are not close enough to reach it.");      }    }  }if (!have.water)  {  if ((said("douse", "dragon") ||       said("cast", "water") ||       said("cast", "water", "dragon")))    {    if (dragon.state != dragonDOUSED)      {      print("You have nothing with which to douse a dragon.");      }    if (dragon.state == dragonDOUSED)      {      print("There is no dragon here.");      }    }  }if (posn(ego, 105, 96, 145, 166) &&     dragon.state == dragonINITIAL)  {  if (have.dagger &&       (said("cast", "dagger") ||       said("cast", "dagger", "dragon")))    {    reset(have.dagger);    print("The dagger sings through the air, but falls short of the dragon.  "          "You should have been closer.");    drop("dagger");    currentScore -= 5;    }  if (have.water &&       (said("cast", "water") ||       said("cast", "water", "dragon") ||       said("douse", "dragon")))    {    reset(have.water);    print("You throw your water, but to no avail.  It lands on the floor and is "          "quickly absorbed.");    drop("water");    currentScore -= 2;    reset(points.water);    }  }if (!posn(ego, 105, 96, 145, 166) &&     dragon.state == dragonINITIAL)  {  if (have.water &&       (said("cast", "water") ||       said("cast", "water", "dragon") ||       said("douse", "dragon")))    {    reset(have.water);    print("The water hits the dragon squarely in the mouth, extinguishing its "          "roaring flames.  No fire!  How mortified and embarrassed the dragon "          "is!  Moving a huge boulder in leaving, the dragon creeps off to "          "sulk.");    drop("water");    currentScore -= 2;    currentScore  += 7;    set.loop(a.dragon, 1);    reset(points.water);    move.obj(a.dragon, 40, 137, 0, dragon.moves.boulder);    dragon.state = dragonDOUSED;    }  if (have.dagger &&       (said("cast", "dagger") ||       said("cast", "dagger", "dragon")))    {    ignore.blocks(a.dragon);    reset(have.dagger);    print("Nervously, you throw the dagger at the dragon and strike it in the "          "heart.  Death for the dragon is instant.");    drop("dagger");    currentScore -= 5;    currentScore  += 3;    erase(a.dragon);    set.view(a.dragon, View61);    dragon.step = 0;    step.size(a.dragon, dragon.step);    draw(a.dragon);    stop.motion(a.dragon);    stop.cycling(a.dragon);    dragon.state = dragonDEAD;    }  }if (dragon.moves.boulder)  {  reset(dragon.moves.boulder);  start.cycling(a.boulder);  end.of.loop(a.boulder, boulder.moved);  }if (boulder.moved)  {  ignore.blocks(a.dragon);  reset(boulder.moved);  stop.cycling(a.boulder);  move.obj(a.dragon, 4, 137, 0, dragon.leaves);  }if (dragon.leaves)  {  reset(dragon.leaves);  erase(a.dragon);  }if (edgeEgoHit == RIGHT_EDGE)  {  new.room(Logic52);  }if (posn(ego, 0, 0, 1, 167))  {  new.room(Logic50);  }return();[ Messages#message 1 "The ferocious fire-breathing dragon is protecting the magic mirror."#message 2 "There is a dead dragon, a large boulder, and a seemingly ordinary mirror in the cave."#message 3 "There is a large granite boulder and a magic mirror!! in the cave."#message 4 "A green, scaly dragon breathing hot fire and smoke is protecting the mirror."#message 5 "In this large cavern, there is a slimy dead dragon, an opening on one side, and a large boulder in the other."#message 6 "The cavern is empty, save for a couple of openings on either side."#message 7 "There is no dragon here."#message 8 "This ferocious, fire-breathing dragon with sharp, green scales and a long tail is protecting the magic mirror. Watch out for the flames!"#message 9 "You see the once powerful dragon lying lifeless before you."#message 10 "It took millenniums for these stalagmites and stalactites to form."#message 11 "This boulder is a huge chunk of granite."#message 12 "This boulder is far too heavy to move."#message 13 "A strange watery light issues from the hole."#message 14 "The mere thought of retrieving the dagger repulses you."#message 15 "The hole seems to lead further into the cave."#message 16 "How?"#message 17 "This dragon had only one life and you have taken it."#message 18 "With that dragon here?  No way!"#message 19 "This dragon does not respond to reason."#message 20 "You throw your bucket on the cavern floor."#message 21 "The dragon is protecting the magic mirror."#message 22 "The magic mirror is framed with ornate mahogany wood, polished to a high sheen."#message 23 "There is no mirror here."#message 24 "Carefully, you pick up the magic mirror."#message 25 "I do not think that you can get close enough to the magic mirror with the dragon here."#message 26 "You could get a much better view if you were closer."#message 27 "You are not close enough to reach it."#message 28 "You don't have a dagger."#message 29 "You don't have any water."#message 30 "You have nothing with which to douse a dragon."#message 31 "You can't do that from here.!"#message 32 "The dagger sings through the air, but falls short of the dragon.  You should have been closer."#message 33 "You throw your water, but to no avail.  It lands on the floor and is quickly absorbed."#message 34 "The water hits the dragon squarely in the mouth, extinguishing its roaring flames.  No fire!  How mortified and embarrassed the dragon is!  Moving a huge boulder in leaving, the dragon creeps off to sulk."#message 35 "Nervously, you throw the dagger at the dragon and strike it in the heart.  Death for the dragon is instant."#message 36 "How do you wish to accomplish that?"#message 37 "You are too busy looking around to even think about that."#message 38 "You should know about these fire-breathing dragons!  Maybe next time you will be a little more careful!"#message 39 "Your shield melted from the intensity of the dragon's flames!  You should know about these fire-breathing dragons!  Maybe next time you will be a little more careful!"#message 40 "I think you found the dragon!"