#define a.shield    o1#define a.leprechaun.chaser    o2#define a.sceptre   o3#define king.alone  f20#define escape.msg  f21#define leprechaun.catch.ego f22#define king.gets.up    f23#define king.leaves f24#define blocked.msg f25#define play.the.fiddle f26#define fiddle.done f27#define king.timer  v30if (newRoom)  {  set.horizon(58);  load.pic(currentRoom);  draw.pic(currentRoom);  discard.pic(currentRoom);  if (previousRoom == 76)    {    position(ego, 87, 67);    }  if (previousRoom == 78)    {    position(ego, 9, 95);    }  if (!took.shield)    {    load.view(View49);    }  if (!took.sceptre)    {    load.view(View48);    }  if (!leprechauns.gone)    {    load.sound(Sound21);    load.view(View47);    load.view(View79);    }  if (!leprechaun.king.gone)    {    load.view(View81);    load.view(View54);    }  if (!leprechauns.gone)    {    add.to.pic(View79, 1, 0, 94, 156, 14, 0);    add.to.pic(View79, 1, 0, 120, 156, 14, 0);    add.to.pic(View79, 1, 0, 106, 144, 13, 0);    add.to.pic(View79, 1, 0, 128, 156, 14, 0);    add.to.pic(View79, 1, 0, 111, 78, 7, 0);    add.to.pic(View79, 0, 0, 57, 72, 7, 0);    add.to.pic(View79, 0, 0, 45, 77, 7, 0);    add.to.pic(View79, 0, 0, 36, 88, 8, 0);    add.to.pic(View79, 0, 0, 16, 140, 12, 0);    add.to.pic(View79, 0, 0, 30, 150, 13, 0);    }  if (!leprechaun.king.gone)    {    animate.obj(a.leprechaun.king);    set.view(a.leprechaun.king, View54);    position(a.leprechaun.king, 121, 98);    set.priority(a.leprechaun.king, 10);    ignore.blocks(a.leprechaun.king);    draw(a.leprechaun.king);    if (leprechauns.gone)      {      set(king.alone);      king.timer = 27;      }    }  if (!leprechauns.gone)    {    animate.obj(a.leprechaun.chaser);    set.view(a.leprechaun.chaser, View47);    position(a.leprechaun.chaser, 56, 108);    if (!have.clover)      {      set(escape.msg);      follow.ego(a.leprechaun.chaser, 5, leprechaun.catch.ego);      }    else      {      wander(a.leprechaun.chaser);      }    ignore.blocks(a.leprechaun.chaser);    draw(a.leprechaun.chaser);    }  if (!took.shield)    {    animate.obj(a.shield);    set.view(a.shield, View49);    position(a.shield, 131, 128);    draw(a.shield);    }  if (leprechaun.king.gone && !took.sceptre)    {    animate.obj(a.sceptre);    set.view(a.sceptre, View48);    position(a.sceptre, 115, 106);    draw(a.sceptre);    }  draw(ego);  show.pic();  }if (!leprechauns.gone)  {  if (!play.the.fiddle)    {    set(play.the.fiddle);    sound(Sound21, fiddle.done);    }  if (fiddle.done)    {    reset(play.the.fiddle);    reset(fiddle.done);    }  }if (!leprechauns.gone && have.clover)  {  observe.blocks(ego);  if (posn(ego, 80, 110, 139, 141))    {    if (!blocked.msg)      {      print("The King's magic prevents you from getting close enough to harm "            "him.");      set(blocked.msg);      }    }  }if (leprechauns.gone && !leprechaun.king.gone)  {  ignore.blocks(ego);  if (posn(ego, 31, 110, 158, 98))    {    if (!blocked.msg)      {      print("The King's magic prevents you from getting close enough to harm "            "him.");      set(blocked.msg);      }    }  }if (leprechauns.gone && leprechaun.king.gone)  {  ignore.blocks(ego);  }--king.timer;if (king.alone &&     king.timer == 1)  {  king.timer = 0;  erase(a.leprechaun.king);  set.view(a.leprechaun.king, View81);  position(a.leprechaun.king, 115, 117);  set.loop(a.leprechaun.king, 1);  draw(a.leprechaun.king);  move.obj(a.leprechaun.king, 33, 114, 0, king.gets.up);  animate.obj(a.sceptre);  set.view(a.sceptre, View48);  position(a.sceptre, 115, 106);  draw(a.sceptre);  print("After his followers have danced away, the King of the leprechauns "        "realizes he can lead best by following, and leaves, forgetting his "        "beautiful sceptre.");  }if (king.gets.up)  {  reset(king.gets.up);  move.obj(a.leprechaun.king, 5, 85, 0, king.leaves);  }if (king.leaves)  {  set(leprechaun.king.gone);  reset(king.alone);  reset(king.leaves);  erase(a.leprechaun.king);  }if (escape.msg)  {  reset(escape.msg);  print("I hope you can escape from the leprechauns, but it doesn't look good "        "for you.");  }if (leprechaun.catch.ego)  {  reset(leprechaun.catch.ego);  print("The leprechaun, with much support from his peers, catches you and "        "refuses to let go.  I think you will be here for a long, long time.");  stop.motion(ego);  set(fFlag95);  stop.cycling(ego);  stop.motion(a.leprechaun.chaser);  stop.cycling(a.leprechaun.chaser);  set(certain.death);  }if (have.fiddle)  {  if (said("play", "fiddle"))    {    if (!leprechauns.gone)      {      print("You find playing the fiddle here very fun, but the dance floor is "            "in the other room.");      }    else      {      print("You play a little tune on the fiddle to amuse yourself.");      }    }  }if (said("check", "throne"))  {  if (!king.alone && !leprechauns.gone)    {    print("The King of the leprechauns is sitting on the stone throne.");    }  else    {    print("This is a rather simple stone throne, compared to King Edward's.");    }  }if (!leprechauns.gone && have.clover)  {  if (said("check", "leprechaun"))    {    print("The little green men do not seem to be noticing you; perhaps because "          "of the fourleaf clover.");    }  if ((said("speak", "leprechaun") ||       said("hello") ||       said("say", "hello")))    {    print("I would not try talking to the leprechauns.  You might say the wrong "          "thing.");    }  if (said("kill", "leprechaun"))    {    print("You would not get all of them before they got you.");    }  }if (!leprechauns.gone && !have.clover)  {  if (said("anyword", "leprechaun"))    {    print("The leprechauns seem irritated by your invasion of their territory.  "          "I would be real careful about what I say and do right now!");    }  }if (leprechauns.gone)  {  if (said("anyword", "leprechaun"))    {    print("There aren't any leprechauns here.");    }  }if (!leprechaun.king.gone)  {  if (!king.alone)    {    if ((said("check", "king") ||         said("check", "king", "leprechaun") ||         said("check", "leprechaun", "king")))      {      if (!took.shield)        {        print("The King of the leprechauns is sitting on the stone throne. The "              "magic shield is next to the throne.");        }      else        {        print("The King of the leprechauns is sitting on the stone throne.");        }      }    }  if (king.alone)    {    if ((said("check", "king") ||         said("check", "king", "leprechaun") ||         said("check", "leprechaun", "king")))      {      print("The King is leaving.");      }    }  if ((said("speak", "king") ||       said("hello") ||       said("say", "hello")))    {    print("The leprechaun King ignores your words.");    }  }if (leprechaun.king.gone)  {  if (said("anyword", "king"))    {    print("The King of the leprechauns is no longer here.");    }  }if ((said("check", "cave") ||     said("check", "room")))  {  if (took.shield && took.sceptre)    {    print("This is the throne room of the leprechaun King.");    }  if ((king.alone || leprechaun.king.gone))    {    if (took.shield && !took.sceptre)      {      print("This is the throne room of the leprechaun King.  There is a "            "sceptre next to the throne.");      }    if (!took.shield && !took.sceptre)      {      print("This is the throne room of the leprechaun King.  There is a shield "            "and a sceptre near the throne.");      }    }  if (!king.alone && !leprechaun.king.gone)    {    if (!took.shield)      {      print("This is the throne room of the leprechaun King.  There is a shield "            "next to the throne.");      }    }  }if (said("check", "stairs"))  {  if (posn(ego, 56, 10, 60, 156))    {    print("The stairs go up a narrow tunnel.");    }  else    {    print("To see the stairs, you have to get closer.");    }  }if (!have.shield && took.shield)  {  if (said("check", "shield"))    {    print("I think there might have been a shield here once, but someone has "          "since taken it.");    }  if (said("acquire", "shield"))    {    print("The shield is no longer here.");    }  }if (!took.shield)  {  if (said("check", "shield"))    {    if (posn(ego, 121, 118, 144, 138))      {      print("It is made of titanium and is rimmed with jewels.");      }    else      {      print("You need to get closer to see it clearly.");      }    }  if (said("acquire", "shield"))    {    if (posn(ego, 121, 118, 144, 138))      {      erase(a.shield);      if (leprechauns.gone)        {        print("You take the magic shield and carefully put it in your pocket.");        }      else        {        print("As inconspicuously as possible, you add the shield to what you "              "are carrying.");        }      set(took.shield);      set(have.shield);      get("shield");      currentScore  += 8;      ++num.treasures;      }    else      {      print("You must be closer to do that.");      }    }  }if (took.sceptre && !have.sceptre)  {  if (said("check", "sceptre"))    {    print("I see no sceptre in the vicinity.");    }  if (said("acquire", "sceptre"))    {    print("There is no sceptre in sight to get.");    }  }if (!took.sceptre)  {  if (posn(ego, 103, 100, 142, 142))    {    if ((leprechaun.king.gone || king.alone))      {      if (said("check", "sceptre"))        {        print("The sceptre is fashioned from gold and silver, and accented with "              "emeralds.");        }      if (said("acquire", "sceptre"))        {        erase(a.sceptre);        set(took.sceptre);        set(have.sceptre);        print("Eagerly, you pick up the sceptre.");        get("sceptre");        currentScore  += 6;        }      }    if (!leprechaun.king.gone && !king.alone)      {      if (said("check", "sceptre"))        {        print("I see no sceptre right here.");        }      if (said("acquire", "sceptre"))        {        print("I see no sceptre to get around here.");        }      }    }  if (!posn(ego, 103, 100, 142, 142))    {    if ((said("check", "sceptre") ||         said("acquire", "sceptre")))      {      print("You must be closer to do that.");      }    }  }if (edgeEgoHit != NOT_HIT)  {  if (king.alone)    {    set(leprechaun.king.gone);    }  }if (edgeEgoHit == TOP_EDGE)  {  new.room(Logic76);  }if (posn(ego, 0, 0, 1, 167))  {  new.room(Logic78);  }return();[ Messages#message 1 "You find playing the fiddle here very fun, but the dance floor is in the other room."#message 2 "You play a little tune on the fiddle to amuse yourself."#message 3 "It is very difficult to play a fiddle if you do not have one."#message 4 "This is a rather simple stone throne, compared to King Edward's."#message 5 "The little green men do not seem to be noticing you; perhaps because of the fourleaf clover."#message 6 "I would not try talking to the leprechauns.  You might say the wrong thing."#message 7 "You would not get all of them before they got you."#message 8 "There aren't any leprechauns here."#message 9 "The King of the leprechauns is sitting on the stone throne. The magic shield is next to the throne."#message 10 "The King of the leprechauns is sitting on the stone throne."#message 11 "The King is leaving."#message 12 "The King of the leprechauns is no longer here."#message 13 "The stairs go up a narrow tunnel."#message 14 "To see the stairs, you have to get closer."#message 15 "The leprechaun King ignores your words."#message 16 "I hope you can escape from the leprechauns, but it doesn't look good for you."#message 17 "The leprechaun, with much support from his peers, catches you and refuses to let go.  I think you will be here for a long, long time."#message 18 "The King's magic prevents you from getting close enough to harm him."#message 19 "After his followers have danced away, the King of the leprechauns realizes he can lead best by following, and leaves, forgetting his beautiful sceptre."#message 20 "The shield is already in your pocket."#message 21 "I think there might have been a shield here once, but someone has since taken it."#message 22 "The shield is no longer here."#message 23 "It is made of titanium and is rimmed with jewels."#message 24 "As inconspicuously as possible, you add the shield to what you are carrying."#message 25 "You take the magic shield and carefully put it in your pocket."#message 26 "You need to get closer to see it clearly."#message 27 "You must be closer to do that."#message 28 "The sceptre is fashioned from gold and silver, and accented with emeralds."#message 29 "I see no sceptre right here."#message 30 "I see no sceptre to get around here."#message 31 "Eagerly, you pick up the sceptre."#message 32 "I see no sceptre in the vicinity."#message 33 "There is no sceptre in sight to get."#message 34 "The leprechauns seem irritated by your invasion of their territory.  I would be real careful about what I say and do right now!"#message 35 "This is the throne room of the leprechaun King."#message 36 "This is the throne room of the leprechaun King.  There is a shield and a sceptre near the throne."#message 37 "This is the throne room of the leprechaun King.  There is a shield next to the throne."#message 38 "This is the throne room of the leprechaun King.  There is a sceptre next to the throne."#message 39 "The King of the leprechauns is sitting on the stone throne."