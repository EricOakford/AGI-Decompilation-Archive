#define a.giant o1#define a.chest o2#define giant.timer.1   v30#define giant.timer.2   v31#define giant.step v33#define fall.offscreen  f20#define fall.sound  f21#define giant.caught.ego    f22#define giant.chase.ego f23#define sling.it.with.chest  f24#define sling.it.no.chest f25if (newRoom)  {  ignore.horizon(ego);  load.pic(currentRoom);  draw.pic(currentRoom);  discard.pic(currentRoom);  load.view(View105);  load.view(View114);  load.sound(m.badguy);  load.sound(s.ego.fall);  load.sound(Sound9);  load.sound(Sound18);  giant.step = 0;  if (have.sling)    {    load.view(View102);    animate.obj(a.ego.sling);    set.view(a.ego.sling, View102);    }  if (!have.chest && !took.chest)    {    load.view(View37);    animate.obj(a.chest);    set.view(a.chest, View37);    load.view(View36);    load.view(View52);    load.view(View68);    load.view(View77);    }  if ((have.chest || took.chest))    {    load.view(View68);    load.view(View66);    load.view(View77);    }  if (giant.state == 0)    {    animate.obj(a.giant);    set.view(a.giant, View36);    position(a.giant, 91, 71);    follow.ego(a.giant, 10, giant.caught.ego);    set(giant.chase.ego);    giant.timer.1 = 250;    giant.timer.2 = 2;    }  if (giant.state == 2)    {    animate.obj(a.giant);    set.view(a.giant, View66);    position(a.giant, 91, 71);    follow.ego(a.giant, 10, giant.caught.ego);    set(giant.chase.ego);    }  if (giant.state == 4)    {    animate.obj(a.giant);    set.view(a.giant, View77);    position(a.giant, 73, 113);    set.cel(a.giant, 3);    stop.cycling(a.giant);    step.size(a.giant, giant.step);    animate.obj(a.chest);    set.view(a.chest, View37);    position(a.chest, 75, 114);    draw(a.chest);    }  if (giant.state == 5)    {    animate.obj(a.giant);    set.view(a.giant, View77);    position(a.giant, 73, 113);    set.cel(a.giant, 3);    stop.cycling(a.giant);    step.size(a.giant, giant.step);    }  draw(a.giant);  draw(ego);  show.pic();  }if ((giant.state == 0 ||     giant.state == 2))  {  if (!isset(lf6))    {    set(lf6);    sound(m.badguy, done);    }  }if (isset(giant.caught.ego) &&     isset(giant.chase.ego))  {  if (isset(ego.invisible))    {    reset(giant.caught.ego);    reset(giant.chase.ego);    print("The giant cannot see you since you are invisible.");    wander(a.giant);    }  else    {    if (isset(have.shield))      {      reset(giant.caught.ego);      reset(giant.chase.ego);      print("You are fortunate that you have the magic shield or this giant "            "would cause problems for you.");      wander(a.giant);      }    else      {      if (isset(protected.spell))        {        reset(giant.caught.ego);        reset(giant.chase.ego);        print("The fairy godmother's spell is protecting you.");        wander(a.giant);        }      else        {        if (!isset(have.shield) &&             !isset(ego.invisible) &&             !isset(protected.spell))          {          if ((giant.state == 0 ||               giant.state == 2))            {            reset(giant.caught.ego);            reset(giant.chase.ego);            set.view(ego, View114);            print("Be a little more careful next time.  This giant is mean!");            wander(a.giant);            set(certain.death);            }          }        }      }    }  }if (egoHitSpecial)  {  set(ego.fell);  reset(egoHitSpecial);  program.control();  if (!ego.invisible)    {    set.view(ego, View105);    }  start.cycling(ego);  set(keep.cycling);  sound(s.ego.fall, sound.done);  erase(ego);  }if (sound.done)  {  reset(sound.done);  set(fall.offscreen);  }if (fall.offscreen)  {  reset(fall.offscreen);  print("You know you can't walk on clouds.");  set(certain.death);  }if (said("check", "giant"))  {  if (giant.state == 2)    {    print("The giant is enormous!  He does look rather stupid, though.");    }  if (giant.state == 0)    {    print("The enormous giant has been carrying that heavy chest for longer "          "than he can remember.");    }  if (giant.state == 1)    {    print("The giant is sleeping with a chest.");    }  if (giant.state == 3)    {    print("The huge giant has fallen asleep and is now snoring loudly.");    }  if (giant.state == 4)    {    print("The giant lies dead on the ground and there is a chest beside him.");    }  if (giant.state == 5)    {    print("The giant has been slain by a little pebble to the forehead.");    }  }if ((said("speak", "giant") ||     said("hello") ||     said("say", "hello")))  {  if ((giant.state == 2 ||       giant.state == 0))    {    print("The giant is in no mood for talking.");    }  if ((giant.state == 1 ||       giant.state == 3))    {    print("It is not a good idea to wake a sleeping giant.");    }  if ((giant.state == 4 ||       giant.state == 5))    {    print("A dead giant does not have a lot to say.");    }  }if (!have.chest && !took.chest)  {  if (said("check", "chest"))    {    print("The magic chest appears to have been fashioned from ebony and rimmed "          "on the edges with gold.");    }  }if (!have.chest)  {  if ((said("acquire", "chest") ||       said("acquire", "chest", "giant")))    {    if (giant.state == 0)      {      print("The giant is protecting the magic chest.");      }    if (took.chest)      {      print("There is no chest around here to get.");      }    distance(ego, a.giant, work.2);    if (giant.state == 1)      {      if (work.2 > 30)        {        print("There is no way you can get the chest from here!");        }      else        {        erase(a.giant);        set.view(a.giant, View68);        stop.motion(a.giant);        draw(a.giant);        print("Very carefully, you slip the magic chest from the sleeping "              "giant's arms.");        set(have.chest);        set(took.chest);        currentScore  += 8;        get("chest");        ++num.treasures;        giant.state = 3;        }      }    distance(ego, a.chest, work);    if (giant.state == 4)      {      if (work > 30)        {        print("There is no way you can get the chest from here!");        }      else        {        erase(a.chest);        print("It's easy to take a magic chest from a dead giant.");        set(have.chest);        set(took.chest);        currentScore  += 8;        get("chest");        ++num.treasures;        giant.state = 5;        }      }    }  }if (have.sling)  {  distance(ego, a.giant, work.3);  if ((said("use", "sling") ||       said("a", "sling")))    {    if (!isset(have.pebbles))      {      print("You need some kind of small rock to use the sling.");      }    if (have.pebbles &&         work.3 < 20)      {      print("The giant is to close for the slingshot to be effective.  I would "            "suggest you RUN!");      }    if (have.pebbles &&         !took.chest &&         !ego.invisible &&         giant.state == 0 &&         work.3 > 19 &&         !ego.fell)      {      reset(giant.chase.ego);      get.posn(ego, ego.x, ego.y);      position.v(a.ego.sling, ego.x, ego.y);      erase(ego);      draw(a.ego.sling);      sound(Sound18, done);      end.of.loop(a.ego.sling, sling.it.with.chest);      print("You put the pebble in the sling, take careful aim, and luckily hit "            "the giant in the forehead!  He falls down dead.");      reset(have.pebbles);      drop("pebbles");      currentScore -= 1;      }    if (have.pebbles &&         took.chest &&         !ego.invisible &&         giant.state == 2 &&         work.3 > 19)      {      reset(giant.chase.ego);      get.posn(ego, ego.x, ego.y);      position.v(a.ego.sling, ego.x, ego.y);      erase(ego);      draw(a.ego.sling);      sound(Sound18, done);      end.of.loop(a.ego.sling, sling.it.no.chest);      print("You put the pebble in the sling, take careful aim, and luckily hit "            "the giant in the forehead!  He falls down dead.");      reset(have.pebbles);      drop("pebbles");      currentScore -= 1;      }    if (have.pebbles &&         !took.chest &&         ego.invisible)      {      if ((giant.state == 0 ||           giant.state == 2))        {        print("Not when you're invisible!");        }      }    if (have.pebbles)      {      if ((giant.state == 1 ||           giant.state == 3))        {        print("It would be rather cowardly of you to kill a giant while he is "              "asleep!");        }      }    }  }if (sling.it.with.chest)  {  reset(sling.it.with.chest);  erase(a.ego.sling);  set.view(ego, View0);  position.v(ego, ego.x, ego.y);  draw(ego);  erase(a.giant);  set.view(a.giant, View77);  step.size(a.giant, giant.step);  draw(a.giant);  end.of.loop(a.giant, done);  get.posn(a.giant, temp.x, temp.y);  position.v(a.chest, temp.x, temp.y);  draw(a.chest);  giant.state = 4;  currentScore  += 3;  }if (sling.it.no.chest)  {  reset(sling.it.no.chest);  erase(a.ego.sling);  set.view(ego, View0);  position.v(ego, ego.x, ego.y);  draw(ego);  erase(a.giant);  set.view(a.giant, View77);  step.size(a.giant, giant.step);  draw(a.giant);  end.of.loop(a.giant, done);  giant.state = 5;  }if (have.dagger)  {  if ((said("use", "dagger") ||       said("cast", "dagger")))    {    reset(have.dagger);    drop("dagger");    print("I don't believe it!  How could you miss something so big?");    currentScore -= 5;    }  }if (said("kill", "giant"))  {  if (giant.state == 0)    {    print("How?");    }  if (giant.state == 2)    {    print("There is no reason to kill the giant.");    }  if ((giant.state == 1 ||       giant.state == 3))    {    print("It would be rather cowardly of you to kill a giant while he is "          "asleep!");    }  if ((giant.state == 4 ||       giant.state == 5))    {    print("The giant has been slain by a little pebble to the forehead.");    }  }if ((said("check", "room") ||     said("check", "clouds")))  {  print("You are in the Land of the Clouds.  It is rumored that a giant lives "        "up here.");  }if (giant.state == 0)  {  --giant.timer.1;  if (giant.timer.1 == 0)    {    if (giant.timer.2 > 0)      {      --giant.timer.2;      giant.timer.1 = 250;      }    }  }if (giant.timer.1 == 1 &&     giant.timer.2 == 0)  {  reset(giant.chase.ego);  giant.timer.1 = 0;  stop.motion(a.giant);  erase(a.giant);  set.view(a.giant, View52);  step.size(a.giant, giant.step);  draw(a.giant);  giant.state = 1;  if (!giant.fell.asleep)    {    set(giant.fell.asleep);    currentScore  += 7;    }  print("What luck!  The huge giant fell fast asleep!");  }if ((giant.state == 1 ||     giant.state == 3))  {  if (!isset(lf8))    {    set(lf8);    sound(Sound9, lf7);    }  if (isset(lf7))    {    reset(lf7);    reset(lf8);    }  }if (certain.death)  {  goto(exit);  }if (edgeEgoHit != NOT_HIT)  {  if (giant.state == 1)    {    giant.state = 0;    }  if (giant.state == 3)    {    giant.state = 2;    }  }if (edgeEgoHit == RIGHT_EDGE)  {  new.room(Logic59);  }if (edgeEgoHit == LEFT_EDGE)  {  new.room(Logic57);  }if (edgeEgoHit == BOTTOM_EDGE)  {  new.room(Logic61);  }exit:return();[ Messages#message 1 "You are fortunate that you have the magic shield or this giant would cause problems for you."#message 2 "The giant cannot see you since you are invisible."#message 3 "The fairy godmother's spell is protecting you."#message 4 "The giant is enormous!  He does look rather stupid, though."#message 5 "The enormous giant has been carrying that heavy chest for longer than he can remember."#message 6 "The huge giant has fallen asleep and is now snoring loudly."#message 7 "The magic chest appears to have been fashioned from ebony and rimmed on the edges with gold."#message 8 "The giant is protecting the magic chest."#message 9 "There is no chest around here to get."#message 10 "Very carefully, you slip the magic chest from the sleeping giant's arms."#message 11 "There is no way you can get the chest from here!"#message 12 "It's easy to take a magic chest from a dead giant."#message 13 "You need some kind of small rock to use the sling."#message 14 "You put the pebble in the sling, take careful aim, and luckily hit the giant in the forehead!  He falls down dead."#message 15 "Not when you're invisible!"#message 16 "It would be rather cowardly of you to kill a giant while he is asleep!"#message 17 "You have no sling!"#message 18 "I don't believe it!  How could you miss something so big?"#message 19 "You have no dagger!"#message 20 "How?"#message 21 "There is no reason to kill the giant."#message 22 "You are in the Land of the Clouds.  It is rumored that a giant lives up here."#message 23 "The giant has been slain by a little pebble to the forehead."#message 24 "Be a little more careful next time.  This giant is mean!"#message 25 "You know you can't walk on clouds."#message 26 "The giant is in no mood for talking."#message 27 "It is not a good idea to wake a sleeping giant."#message 28 "A dead giant does not have a lot to say."#message 29 "What luck!  The huge giant fell fast asleep!"#message 30 "The giant is sleeping with a chest."#message 31 "The giant lies dead on the ground and there is a chest beside him."#message 32 "The giant is to close for the slingshot to be effective.  I would suggest you RUN!"