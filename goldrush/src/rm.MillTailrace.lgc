[***********************************************************[[ rm.MillTailrace[[ The mill tailrace is at the west edge of the town of [ Coloma, and dumps into the American River. Jerrod can't [ find any gold here and there is nothing needed here that[ advances the game.[[***********************************************************[ **************************************[ LOCAL DEFINES[ **************************************#define vPanTimer                  v220#define vPanStatus                 v221#define fWading                    f220[ **************************************[ FIRST CYCLE ONLY[ **************************************if (isset(newRoom))  {  [ load the mule logic  load.logics(lgc.Mule);    [ load views used in the room  load.view(vw.JerrodCA);  load.view(vw.WadingJerrodCA);  load.view(vw.Panning);    [ load and draw picture for current room  load.pic(currentRoom);  draw.pic(currentRoom);    [ horizon is set to 80 in American River rooms  set.horizon(80);    [ Jerrod uses his normal California attire  animate.obj(ego);  set.view(ego, vw.JerrodCA);  [ if Jerrod is in the water in the tailrace  if (isset(InTailrace))    {    [ switch to wading view    set.view(ego, vw.WadingJerrodCA);    set.priority(ego, 8);    [ set local flag to show Jerrod is wading in the water    set(fWading);    }  ignore.blocks(ego);  draw(ego);    [ if Jerrod has a mule  if ((has(LazyMule) || has("James' ol' mule")))    {    [ do mule initialization steps    call(lgc.Mule);    }        [ now show the picture  show.pic();    [ clear the custom status line  clear.lines(24, 24, BLACK);    [ not necessary to reset this flag; AGI resets it  [ automatically  reset(newRoom);  }  [ **************************************[ EVERY CYCLE[ **************************************[ if Jerrod is on shore of river (left edge) or on the left[ edge of the riverif ((posn(ego, 0, 91, 20, 93) ||     posn(ego, 0, 80, 3, 90)))  {  [ if he is on the water and not wading  if (isset(onWater) && !isset(fWading))    {    [ set wading flag    set(fWading);    [ and switch to wading view    set.priority(ego, 8);    set.view(ego, vw.WadingJerrodCA);    }      [ if Jerrod is NOT on the water is wading  if (!isset(onWater) && isset(fWading))    {    [ reset the flag    reset(fWading);    [ switch back to normal view    release.priority(ego);    set.view(ego, vw.JerrodCA);    }  }  [ if Jerrod is at left edge of tailraceif (posn(ego, 21, 80, 21, 90))  {  [ set the flag  set(InTailrace);  }  [ if Jerrod is one pixel to left of the left edge of[ the tailraceif (posn(ego, 20, 80, 20, 91))  {  [ reset the flag  reset(InTailrace);  }  [ if panning timer is activeif (vPanTimer > 0)  {  [ increment the timer  ++vPanTimer;  }  [ after 15 cycles of panningif (vPanTimer == 15 && vPanStatus == 1)  {  [ reset timer and status  vPanTimer = 0;  vPanStatus = 0;  [ there is no more gold at Sutters Mill  print("Nothin'!");  [ switch back to wading view  set.view(ego, vw.WadingJerrodCA);  [ Jerrod can continue moving  start.motion(ego);  [ reset the cycle at rest flag  reset(CycleAtRest);  }  [ **************************************[ PROCESS PLAYER INPUT[ **************************************[ if player hasn't provided input no need to do said testsif (!isset(haveInput))  {  goto(CheckExits);  }  [ look/look aroundif ((said("examine", "around") || said("examine")))  {  print("This is the end of the tailrace of Sutter's Sawmill.");  print("The town of Coloma is farther to the east.");  }  [ look grassif (said("examine", "grass"))  {  print("This is just wild grass.");  }  [ look treeif (said("examine", "forest"))  {  print("This is just one of the many trees found in these parts.");  }  [ look rockif (said("examine", "rock"))  {  print("This is just another rock.");  }  [ look creekif ((said("examine", "creek") ||     said("examine", "water") ||     said("examine", "american", "creek")))  {  print("This is where the tailrace rejoins the American River.");  }  [ look tailraceif (said("examine", "tailrace"))  {  print("Historical note:\n\nOn the morning of January 24, 1848, James Wilson "        "Marshall found the first nugget of gold in the tailrace of Sutter's "        "Mill. This discovery changed the course of history.");  print("Since then, this area has been panned out!");  }  [ look across riverif ((said("examine", "across") ||     said("examine", "across", "creek") ||     said("examine", "across", "water") ||     said("examine", "across", "american", "creek")))  {  print("The land across the river is no different than what is on this side.");  }  [ use pan/pan for goldif ((said("use", "pan") ||     said("pan", "gold") ||     said("pan")))  {  [ if Jerrod has a pan  if (has("Gold pan"))    {    [ if Jerrod is wading in the water    if (isset(fWading))      {      [ switch to panning view      set.view(ego, vw.Panning);      set.cel(ego, 0);      [ Jerrod stops moving while panning      stop.motion(ego);      [ start timer, and set status to panning      vPanTimer = 1;      vPanStatus = 1;      [ allow ego object to cycle at rest      set(CycleAtRest);      [ begin cycling (panning)      start.cycling(ego);      }    else      {      print("Ya can't be pannin' unless yer in the water!");      }    }  else    {    print("If yer gonna pan ya gotta get one!");    }  }  [ dig for gold/use shovelif ((said("use", "shovel") ||     said("dig", "gold") ||     said("dig") ||     said("dig", "hole")))  {  [ if Jerrod has a shovel  if (has("Shovel"))    {    print("Don't dig up the town!  Do that somewhere else!!");    }  else    {    print("No shovel, no diggin'!");    }  }  [ look sawmillif ((said("examine", "sawmill") ||     said("examine", "sutter", "sawmill") ||     said("examine", "looked at") ||     said("examine", "looked at", "mill") ||     said("examine", "mill")))  {  print("The sawmill is nearby to the east.");  }  [ **************************************[ CHECK FOR AN EXIT CONDITION[ **************************************[ (unlike most other logics, the check for exit condition[ happens LAST in this room)CheckExits:[ if Jerrod has a muleif ((has(LazyMule) || has("James' ol' mule")))  {  [ process mule related commands before checking exits  call(lgc.Mule);  }  if (edgeEgoHit != NOT_HIT)  {  [ if at left edge  if (edgeEgoHit == LEFT_EDGE)    {    [ go back to American River wilderness    --WildernessX;    new.room(lgc.AmRiverWild); [ ##LE001##    }      [ if at right edge  if (edgeEgoHit == RIGHT_EDGE)    {    [ go to Sutters Mill    ++WildernessX;    new.room(rm.SuttersMill); [ ##LE002##    }      [ if at bottom edge  if (edgeEgoHit == BOTTOM_EDGE)    {    [ go into wilderness    ++WildernessY;    new.room(lgc.Wilderness); [ ##LE003##    }  }  return();[ **************************************[ MESSAGES[ **************************************#message 1 "This is the end of the tailrace of Sutter's Sawmill."#message 2 "This is just wild grass."#message 3 "This is just one of the many trees found in these parts."#message 4 "This is just another rock."#message 5 "This is where the tailrace rejoins the American River."#message 6 "The land across the river is no different than what is on this side."#message 7 "Ya can't be pannin' unless yer in the water!"#message 8 "If yer gonna pan ya gotta get one!"#message 9 "Nothin'!"#message 10 "The town of Coloma is farther to the east."#message 11 "Historical note:\n\nOn the morning of January 24, 1848, James Wilson Marshall found the first nugget of gold in the tailrace of Sutter's Mill. This discovery changed the course of history."#message 12 "Since then, this area has been panned out!"#message 13 "The sawmill is nearby to the east."#message 40 "Don't dig up the town!  Do that somewhere else!!"#message 41 "No shovel, no diggin'!"