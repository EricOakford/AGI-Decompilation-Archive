[***********************************************************[[ rm.Hotel1stFloorLeft[ [ This room is the interior hallway on the first floor, [ left side, of the hotel Green Pastures. Jake's 'mystery [ room' is here (the door without a number), but it can't[ be accessed from the hallway. The room looks like a [ closet when it is inspected from the hallway.[[ This room uses a timer to dismiss message windows used in[ the knocking sequence; but since none of the print [ commands in the sequence use the leaveWindow flag, none of [ those print commands actually need to be dismissed; [ it's a bug. No one checked that the leaveWindow flag[ was being used in these rooms for the effect they sought.[[***********************************************************[ **************************************[ LOCAL DEFINES[ **************************************#define oDoor12                      o1#define oDoorExt                     o2#define vTmpStep                   v220#define vKnockStatus               v221#define vKnockTimer                v222#define fDoor12Moved               f220#define fDoorExtMoved              f221#define fDoor12Open                f222#define fDoorExtOpen               f223[ f224 through f237 are not used#define fSoundDone                 f238[ **************************************[ FIRST CYCLE ONLY[ **************************************if (isset(newRoom))  {  [ load picture for current room  load.pic(currentRoom);    [ load views used in the room  load.view(vw.BigJerrodCA);  load.view(vw.HotelRoomArt);    [load sounds used in the room  load.sound(s.Effect1);  load.sound(s.Effect2);    [ draw the room picture  draw.pic(currentRoom);    [ room 12 door  animate.obj(oDoor12);  set.view(oDoor12, vw.HotelRoomArt);  set.loop(oDoor12, 0);  set.cel(oDoor12, 0);  position(oDoor12, 32, 63);  set.priority(oDoor12, 4);  draw(oDoor12);  stop.cycling(oDoor12);    [ exterior door to balcony  animate.obj(oDoorExt);  set.view(oDoorExt, vw.HotelRoomArt);  set.loop(oDoorExt, 1);  set.cel(oDoorExt, 0);  ignore.objs(oDoorExt);  position(oDoorExt, 145, 75);  set.priority(oDoorExt, 6);  draw(oDoorExt);  stop.cycling(oDoorExt);    [ Jerrod uses large California view, and size 2 step  animate.obj(ego);  vTmpStep = 2;  step.size(ego, vTmpStep);  set.view(ego, vw.BigJerrodCA);    [ if coming from the lobby  if (previousRoom == rm.HotelLobby)    {    [ position Jerrod at top of stairs    position(ego, 58, 73);    }  draw(ego);    [ now show the picture  show.pic();  }  [ **************************************[ EVERY CYCLE[ **************************************[ if Jerrod is by Room 12 door and door is not openif (posn(ego, 26, 65, 40, 70) && !isset(fDoor12Open))  {  [ play sound of door opening  sound(s.Effect1, fSoundDone);  [ open the door  end.of.loop(oDoor12, fDoor12Moved);  set(fDoor12Open);  }  [ if Jerrod is not by Room 12 and the door is openif (!posn(ego, 26, 65, 40, 70) && isset(fDoor12Open))  {  [ close the door  reverse.loop(oDoor12, fDoor12Moved);  reset(fDoor12Open);  }  [ when room 12 door finishes movingif (isset(fDoor12Moved))  {  [ reset the flag  reset(fDoor12Moved);  [ if door just closed  if (!isset(fDoor12Open))    {    [ plays sound of door closing    sound(s.Effect2, fSoundDone);    }  }  [ if Jerrod is by the balcony door and door is not openif (posn(ego, 128, 60, 150, 165) && !isset(fDoorExtOpen))  {  [ play sound of door opening  sound(s.Effect1, fSoundDone);  [ open the door  end.of.loop(oDoorExt, fDoorExtMoved);  set(fDoorExtOpen);  }  [ if Jerrod is not by the balcony door and door is openif (!posn(ego, 128, 60, 150, 165) && isset(fDoorExtOpen))  {  [ close the door  reverse.loop(oDoorExt, fDoorExtMoved);  reset(fDoorExtOpen);  }  [ when balcony door finishes movingif (isset(fDoorExtMoved))  {  [ reset the flag  reset(fDoorExtMoved);  [ if door just closed  if (!isset(fDoorExtOpen))    {    [ play sound of door closing    sound(s.Effect2, fSoundDone);    }  }  [ if Jerrod has knocked on a doorif (vKnockStatus == 1)  {  [ increment timer  ++vKnockTimer;  [ after twenty cycles  if (vKnockTimer == 20)    {    [ reset timer    vKnockTimer = 0;    [ advance to next stage (waiting for response)    vKnockStatus = 2;    [ dismiss the message window (not necessary because the    [ window is already dismissed)    close.window();    }  }  [ if waiting for a responseif (vKnockStatus == 2)  {  [ increment timer  ++vKnockTimer;  [ after twenty cycles  if (vKnockTimer == 20)    {    [ reset timer    vKnockTimer = 0;    [ advance to next stage (dismiss the message)    vKnockStatus = 3;    print.at("No one's comin' to the door.", 12, 5, 0);    }  }  [ if waiting for last message to be dismissed (this doesn't[ actually do anything; the message was not printed with the[ leaveWindow flag set, so it's already dismissed)if (vKnockStatus == 3)  {  [ increment timer  ++vKnockTimer;  [ after twenty cycles  if (vKnockTimer == 20)    {    [ reset timer and status    vKnockTimer = 0;    vKnockStatus = 0;    [ dismiss the message window (not necessary because the    [ window is already dismissed)    close.window();    }  }  [ **************************************[ CHECK FOR AN EXIT CONDITION[ **************************************if (posn(ego, 1, 66, 2, 88))  {  [ adjust Jerrod's position for the new room  position(ego, 146, 75);  new.room(rm.Hotel2ndFloorLeft); [ ##LE001##  }  if (posn(ego, 145, 72, 146, 78))  {  [ adjust Jerrod's position, loop and direction for the new  [ room  position(ego, 34, 85);  set.loop(ego, 2);  egoDir = DOWN;  [ go out on the balcony  new.room(rm.GreenPastures); [ ##LE002##  }  if (posn(ego, 54, 65, 62, 66))  {  position(ego, 54, 52);  set.loop(ego, 0);  egoDir = DOWN_RIGHT;  new.room(rm.HotelLobby); [ ##LE003##  }  [ **************************************[ PROCESS PLAYER INPUT[ **************************************[ if player hasn't provided input no need to do said testsif (!isset(haveInput))  {  goto(Done);  }  [ look around/lookif ((said("examine", "around") ||     said("examine") ||     said("examine", "hall")))  {  print("This hallway has many doors. There is a door to the balcony, a door to "        "room 13, and a door with no number.");  }  [ look doorif (said("examine", "door"))  {  [ if near one of the three doors, or open doorway down to  [ first floor  if ((posn(ego, 0, 60, 45, 90) ||       posn(ego, 46, 60, 79, 90) ||       posn(ego, 80, 60, 125, 90) ||       posn(ego, 126, 60, 150, 90)))    {    [ if near room 12 door    if (posn(ego, 0, 60, 45, 90))      {      [ if close enough that the door is open      if (posn(ego, 26, 65, 40, 70))        {        print("This is a closet door. It won't open all the way 'cause of the "              "supplies inside. Ya can barely see a few small holes.");        goto(Done);        }      print("This looks like a door to a closet.");      }          [ if near the doorway down to first floor    if (posn(ego, 46, 60, 79, 90))      {      print("Ya can see the stairs through the open doorway.");      }          [ if near room 13    if (posn(ego, 80, 60, 125, 90))      {      print("This is the door to room 13.");      }          [ if near the balcony door    if (posn(ego, 126, 60, 150, 90))      {      print("This door leads to the balcony.");      }    }  }  [ look closet/look in roomif ((said("examine", "closet", "rol") ||     said("examine", "anyword", "closet") ||     said("examine", "in") ||     said("examine", "in", "around")))  {  [ if close enough that door is open  if (posn(ego, 26, 65, 40, 70))    {    print("You see a small closet filled with supplies.");    }  else    {    print("From the hallway it looks like another hotel room. But it's just a "          "closet.");    }  }  [ enter closet/go in closet/walk in closetif ((said("enter", "closet") ||     said("go", "closet") ||     said("boardwalk", "closet") ||     said("boardwalk", "in", "closet")))  {  [ if close enough that the door is open  if (posn(ego, 26, 65, 40, 70))    {    print("This door won't open any further. It's a small closet filled with "          "supplies.");    }  else    {    print("The door to the closet is closed.");    }  }  [ look number/look room numberif ((said("examine", "number") ||     said("examine", "around", "number")))  {  [ if by room 13  if (posn(ego, 95, 60, 113, 90))    {    print("The number on this door is \"13\".");    }  else    {    print("Ya cain't see any numbers from here.");    }  }  [ open door/walk in roomif ((said("open", "door") ||     said("pull", "door") ||     said("push", "door") ||     said("move", "door") ||     said("go", "around") ||     said("enter", "around") ||     said("go", "door") ||     said("enter", "door") ||     said("boardwalk", "door") ||     said("boardwalk", "in") ||     said("boardwalk", "in", "around") ||     said("boardwalk", "in", "door")))  {  [ if by one of the three doors  if ((posn(ego, 26, 65, 40, 70) ||       posn(ego, 94, 65, 112, 75) ||       posn(ego, 128, 60, 150, 165)))    {    [ if by room 12 door or by balcony door    if ((posn(ego, 26, 65, 40, 70) ||         posn(ego, 128, 60, 150, 165)))      {      [ this response makes no sense for the balcony door -      [ an obvious bug that should have a separate response      [ for being next to balcony      print("This door won't open any further. It's a small closet filled with "            "supplies.");      }    else      {      print("This door's locked.");      }    }  else    {    print("Ya cain't do that from here!");    }  }  [ look carpet/look floorif ((said("examine", "carpet") || said("examine", "deck")))  {  print("It's a hardwood floor covered with carpeting.");  }  [look porch/look balconyif ((said("examine", "porch") ||     said("examine", "balcony")))  {  [ if close enough that the door is open  if (posn(ego, 128, 60, 150, 153))    {    print("You see the balcony through the open door.");    }  else    {    print("The door to the balcony is closed.");    }  }  [ look wall/look wallpaperif ((said("examine", "wall") ||     said("examine", "wall", "newspaper") ||     said("examine", "wallpaper")))  {  print("The walls have nice wallpaper on 'em.");  }  [ read messageif ((said("examine", "message") ||     said("read", "message") ||     said("open", "message")))  {  [ if Jerrod has the message for room 11  if (has("Message for room 11"))    {    print("The message is written on a folded piece of paper with only one word "          "visible on the outside...");    print("\n CONFIDENTIAL!! \n \n");    }  else    {    print("Ya don't have a message.");    }  }  [ knock/knock on doorif ((said("knock") ||     said("knock", "knock") ||     said("knock", "knock", "knock") ||     said("knock", "door")))  {  [ if by one of the three doors  if ((posn(ego, 26, 65, 40, 70) ||       posn(ego, 94, 65, 112, 75) ||       posn(ego, 128, 60, 150, 165)))    {    [ if close enough to room 12 or balcony that the door is    [ open    if ((posn(ego, 26, 65, 40, 70) ||         posn(ego, 128, 60, 150, 165)))      {      print("Why do that? The door's open!");      }    else      {      [ must be by room 13 - start the knock sequence      print.at("Knock, knock, knock...", 12, 9, 0);      vKnockStatus = 1;      }    }  else    {    print("Ya cain't do that from here!");    }  }  [ look stairs/look lobbyif ((said("examine", "stair") || said("examine", "lobby")))  {  print("The stairs lead to the lobby.");  }  [ look holes/look nail holesif ((said("examine", "hole") ||     said("examine", "nail", "hole")))  {  [ if close to room 12 door  if (posn(ego, 26, 65, 40, 70))    {    print("There are some small nail holes in the door. There may have been a "          "number here at one time.");    }  else    {    print("Ya cain't do that from here!");    }  }  [ enter room/walk in roomif ((said("go", "around") ||     said("enter", "around") ||     said("boardwalk") ||     said("boardwalk", "around") ||     said("go", "hotel", "around") ||     said("enter", "hotel", "around") ||     said("boardwalk", "hotel", "around")))  {  [ if close enough to room 12  if (posn(ego, 26, 65, 40, 70))    {    print("There's no need to. It's just a small closet.");    }  else    {    print("Go ahead 'n try!");    }  }  [ unlock door/use keyif ((said("unlock", "door") || said("use", "house key")))  {  print("Ya got nothin' to do that with!");  }  [ look sign/read signif ((said("examine", "sign") || said("read", "sign")))  {  [ if by the stairs entrance  if (posn(ego, 46, 60, 79, 90))    {    print("\n LOBBY \n");    }  else    {    print("Ya cain't do that from here!");    }  }  [ look supplies (presumably referring to supplies in the[ closetif (said("examine", "provisions"))  {  [ probably should have a location check here; if the  [ closet door is closed, response should say something  [ like "you can's see any supplies"  print("These are just hotel supplies.");  }  [ get suppliesif (said("acquire", "provisions"))  {  [ probably should have a location check here; if the  [ closet door is closed, response should say something  [ like "you can's see any supplies"  print("You don't need any of these supplies.");  }  Done:return();[ **************************************[ MESSAGES[ **************************************#message 2 "Ya can see the stairs through the open doorway."#message 3 "This is the door to room 13."#message 4 "This door leads to the balcony."#message 5 "This is a closet door. It won't open all the way 'cause of the supplies inside. Ya can barely see a few small holes."#message 6 "This looks like a door to a closet."#message 7 "From the hallway it looks like another hotel room. But it's just a closet."#message 8 "The door to the closet is closed."#message 9 "The number on this door is \"13\"."#message 10 "Ya cain't see any numbers from here."#message 11 "This door won't open any further. It's a small closet filled with supplies."#message 12 "This door's locked."#message 13 "Ya cain't do that from here!"#message 14 "It's a hardwood floor covered with carpeting."#message 15 "You see the balcony through the open door."#message 16 "The walls have nice wallpaper on 'em."#message 17 "The message is written on a folded piece of paper with only one word visible on the outside..."#message 18 "\n CONFIDENTIAL!! \n \n"#message 19 "Ya don't have a message."#message 20 "Why do that? The door's open!"#message 21 "Knock, knock, knock..."#message 22 "No one's comin' to the door."#message 23 "The stairs lead to the lobby."#message 24 "There are some small nail holes in the door. There may have been a number here at one time."#message 25 "This hallway has many doors. There is a door to the balcony, a door to room 13, and a door with no number."#message 26 "The door to the balcony is closed."#message 27 "\n LOBBY \n"#message 40 "There's no need to. It's just a small closet."#message 41 "Go ahead 'n try!"#message 42 "Ya got nothin' to do that with!"#message 43 "These are just hotel supplies."#message 44 "You don't need any of these supplies."#message 45 "You see a small closet filled with supplies."