[***********************************************************[[ rm.LIJMSC_Corral [[ In this room, Jerrod has to buy animals to pull the[ wagons. If he gets the wrong kind, he will die on the[ trail. Although Jerrod can buy mules or oxen, only mules[ are in this corral.[[***********************************************************[ **************************************[ LOCAL DEFINES[ **************************************#define oRancher                     o1#define oMule1                       o2#define oMule2                       o3#define oMule3                       o4#define oMule4                       o5#define oMule5                       o6#define oMule6                       o7#define oMule7                       o8#define vRndY                      v220#define vRancherStatus             v221#define vRndMsg                    v222#define vRndX                      v223#define vStepTime                  v224#define vCycleTime                 v225#define vStepSize                  v226#define fNearRancher               f220 [ this flag not used#define fSndDone                   f221[ **************************************[ FIRST CYCLE ONLY[ **************************************if (isset(newRoom))  {  [ step time/size and cycle time are same for all the mules  vStepTime = 2;  vCycleTime = 2;  vStepSize = 1;    [ load the main timing logic  load.logics(lgc.WagonTripTiming);    [ load the current room picture  load.pic(currentRoom);    [ load views used in the room (except sick Jerrod and  [ dying Jerrod views aren't actually used; they shouldn't  [ be loaded if not being used)  load.view(vw.JerrodCA);  load.view(vw.SickJerrodCA);  load.view(vw.DyingJerrodCA);  load.view(vw.HardwareClerk);  load.view(vw.LIJMSCArt);  load.view(vw.Mule);    [ load the one sound used in the room  load.sound(m.FoundGold);    [ draw the current picture  draw.pic(currentRoom);    [ add corral gate to picture as background image  add.to.pic(vw.LIJMSCArt, 1, 0, 89, 131, 12, 12);    [ add seven mules, wandering around the corral all  [ starting at random locations    [ mule #1  animate.obj(oMule1);  set.view(oMule1, vw.Mule);  random(72, 128, vRndY);  random(3, 137, vRndX);  position.v(oMule1, vRndX, vRndY);  draw(oMule1);  step.size(oMule1, vStepSize);  cycle.time(oMule1, vCycleTime);  step.time(oMule1, vStepTime);  wander(oMule1);  [ mule #2  animate.obj(oMule2);  set.view(oMule2, vw.Mule);  random(72, 128, vRndY);  random(3, 137, vRndX);  position.v(oMule2, vRndX, vRndY);  draw(oMule2);  step.size(oMule2, vStepSize);  cycle.time(oMule2, vCycleTime);  step.time(oMule2, vStepTime);  wander(oMule2);  [ mule #3  animate.obj(oMule3);  set.view(oMule3, vw.Mule);  random(72, 128, vRndY);  random(3, 137, vRndX);  position.v(oMule3, vRndX, vRndY);  draw(oMule3);  step.size(oMule3, vStepSize);  cycle.time(oMule3, vCycleTime);  step.time(oMule3, vStepTime);  wander(oMule3);  [ mule #4  animate.obj(oMule4);  set.view(oMule4, vw.Mule);  random(72, 128, vRndY);  random(3, 137, vRndX);  position.v(oMule4, vRndX, vRndY);  draw(oMule4);  step.size(oMule4, vStepSize);  cycle.time(oMule4, vCycleTime);  step.time(oMule4, vStepTime);  wander(oMule4);  [ mule #5  animate.obj(oMule5);  set.view(oMule5, vw.Mule);  random(72, 128, vRndY);  random(3, 137, vRndX);  position.v(oMule5, vRndX, vRndY);  draw(oMule5);  step.size(oMule5, vStepSize);  cycle.time(oMule5, vCycleTime);  step.time(oMule5, vStepTime);  wander(oMule5);  [ mule #6  animate.obj(oMule6);  set.view(oMule6, vw.Mule);  random(72, 128, vRndY);  random(3, 137, vRndX);  position.v(oMule6, vRndX, vRndY);  draw(oMule6);  step.size(oMule6, vStepSize);  cycle.time(oMule6, vCycleTime);  step.time(oMule6, vStepTime);  wander(oMule6);  [ mule #7  animate.obj(oMule7);  set.view(oMule7, vw.Mule);  random(72, 128, vRndY);  random(3, 137, vRndX);  position.v(oMule7, vRndX, vRndY);  draw(oMule7);  step.size(oMule7, vStepSize);  cycle.time(oMule7, vCycleTime);  step.time(oMule7, vStepTime);  wander(oMule7);    [ rancher who's selling the mules and oxen  animate.obj(oRancher);  set.view(oRancher, vw.HardwareClerk);  set.loop(oRancher, 0);  position(oRancher, 19, 137);  draw(oRancher);  stop.cycling(oRancher);    [ Jerrod, in California attire  animate.obj(ego);  set.view(ego, vw.JerrodCA);  draw(ego);  show.pic();  block(2, 71, 157, 129);  }  [ **************************************[ EVERY CYCLE[ **************************************[ nothing specific in this room[ **************************************[ CHECK FOR AN EXIT CONDITION[ **************************************[ if Jerrod is at bottom or left of roomif ((posn(ego, 46, 166, 159, 166) ||     posn(ego, 152, 40, 152, 165)))  {  [ position him so he will be in correct spot in new room  position(ego, 58, 165);  [ change direction to UP  egoDir = UP;  [ go back to previous room  new.room.v(previousRoom);  }  [ these two blocks don't do anything; the flag fNearRancher[ is never used anywhere. Looks like they were planning on[ using the flag when processing 'said' commands, but then[ decided to stick with separate 'posn' tests for each 'said'[ command[ if near the rancher, and flag not setif (posn(ego, 13, 132, 30, 144) && !isset(fNearRancher))  {  [ set it  set(fNearRancher);  }[ if not near rancher, and flag is setif (!posn(ego, 13, 132, 30, 144) && isset(fNearRancher))  {  [ clear it  reset(fNearRancher);  }[ **************************************[ PROCESS PLAYER INPUT[ **************************************[ if player hasn't provided input no need to do said testsif (!isset(haveInput))  {  goto(Done);  }  [ talk to rancherif ((said("speak", "boy") ||     said("speak", "rancher") ||     said("speak")))  {  [ if near the rancher  if (posn(ego, 13, 132, 30, 144))    {    [ if Jerrod doesn't have animals yet    if ((vRancherStatus == 0 ||         vRancherStatus == 1 ||         vRancherStatus == 2))      {      [ change status to indicate waiting for Jerrod to      [ state his purpose      vRancherStatus = 1;      print.at("The man says, \"Hello, young greenhorn, what can I do for you "               "today?\"", 8, 3, 20);      }    [ if Jerrod has an animal team    if (vRancherStatus == 3)      {      [ display a random greeting from the rancher      random(4, 6, vRndMsg);      print.at.v(vRndMsg, 8, 3, 20);      }    }  else    {    print("No one is close enough to hear you.");    }  }  [ look rancherif ((said("examine", "boy") || said("examine", "rancher")))  {  [ if in the barn  if ((posn(ego, 0, 132, 49, 155) ||       posn(ego, 0, 156, 45, 167)))    {    print("There's a rancher in the corner of the barn watching the animals.");    }  else    {    print("There is no %w2 out here!");    }  }  [ get animals/buy animalsif ((said("acquire", "animal") ||     said("want", "animal") ||     said("need", "animal") ||     said("acquire", "livestock") ||     said("want", "livestock") ||     said("need", "livestock") ||     said("acquire", "team") ||     said("want", "team") ||     said("need", "team") ||     said("acquire", "animal", "team") ||     said("want", "animal", "team") ||     said("need", "animal", "team") ||     said("buy", "animal") ||     said("buy", "livestock") ||     said("buy", "team") ||     said("buy", "animal", "team")))  {  [ if near the rancher  if (posn(ego, 13, 132, 30, 144))    {    [ if Jerrod does not already have animals    if ((vRancherStatus == 0 ||         vRancherStatus == 1 ||         vRancherStatus == 2))      {      [ if initiating the conversation, OR waiting for      [ Jerrod to state his purpose      if ((vRancherStatus == 0 || vRancherStatus == 1))        {                print.at("The man says, \"You've come to the right place for that!\"", 8, 3, 20);        }      [ rancher tells Jerrod his options      print.at("\"This is what I have to offer you; mules, young oxen, or "               "mature oxen. Which would you like?\"", 8, 3, 20);      [ now waiting for Jerrod to choose an option      vRancherStatus = 2;      }    [ if Jerrod already has a team of animals    if (vRancherStatus == 3)      {      print.at("The man looks puzzled and says, \"You already have a team of "               "animals. You don't need more animals.\"", 8, 3, 20);      }    }  else    {    print("No one is close enough to hear you.");    }  }[ buy mule/buy oxenif ((said("acquire", "horse") ||     said("buy", "horse") ||     said("acquire", "team", "horse") ||     said("buy", "team", "horse") ||     said("horse") ||     said("team", "horse") ||     said("acquire", "cattle") ||     said("buy", "cattle") ||     said("cattle") ||     said("acquire", "team", "cattle") ||     said("buy", "team", "cattle")))  {  [ if near the rancher  if (posn(ego, 13, 132, 30, 144))    {    [ if Jerrod doesn't already have animals    if ((vRancherStatus == 0 ||         vRancherStatus == 1 ||         vRancherStatus == 2))      {      [ rancher tells Jerrod his options      print.at("\"This is what I have to offer you; mules, young oxen, or "               "mature oxen. Which would you like?\"", 8, 3, 20);      vRancherStatus = 2;      }    [ if Jerrod already has animals    if (vRancherStatus == 3)      {      print.at("The man looks puzzled and says, \"You already have a team of "               "animals. You don't need more animals.\"", 8, 3, 20);      }    }  else    {    print("No one is close enough to hear you.");    }  }  [ get oxen/buy oxenif ((said("acquire", "ox") || said("buy", "ox")))  {  [ if near the rancher  if (posn(ego, 13, 132, 30, 144))    {    [ if Jerrod doesn't already have animals    if ((vRancherStatus == 0 ||         vRancherStatus == 1 ||         vRancherStatus == 2))      {      [ rancher tells Jerrod to be more specific      print.at("The man says, \"What type of oxen; young oxen or mature oxen?\"", 8, 3, 20);      vRancherStatus = 2;      }    [ if Jerrod already has animals    if (vRancherStatus == 3)      {      print.at("The man looks puzzled and says, \"You already have a team of "               "animals. You don't need more animals.\"", 8, 3, 20);      }    }  else    {    print("No one is close enough to hear you.");    }  }  [ get mule/buy muleif ((said("acquire", "donkey") || said("buy", "donkey")))  {  [ if near the rancher  if (posn(ego, 13, 132, 30, 144))    {    [ if Jerrod already has animals    if (vRancherStatus == 3)      {      print.at("The man looks puzzled and says, \"You already have a team of "               "animals. You don't need more animals.\"", 8, 3, 20);      }    [ if Jerrod doesn't have animals yet    if ((vRancherStatus == 0 ||         vRancherStatus == 1 ||         vRancherStatus == 2))      {      [ Jerrod gets the mules (which will get him killed      [ later...)      vRancherStatus = 3;      [ Jerrod needs to report back to Captain Buddy      CaptainBuddyStatus = 3;      [ note the animal type      AnimalTeam = 1;      [ score two points      currentScore  += 2;      print.at("The man says, \"These mules are mighty fine animals. I hope "               "they will do a good job for you.\"", 8, 3, 20);      print.at("\"I will deliver them to your company camp before nightfall.\"", 8, 3, 20);      }    }  else    {    print("No one is close enough to hear you.");    }  }  [ muleif (said("donkey"))  {  [ if near the rancher  if (posn(ego, 13, 132, 30, 144))    {    [ if NOT waiting for Jerrod to pick an option    if ((vRancherStatus == 0 ||         vRancherStatus == 1 ||         vRancherStatus == 3))      {      print.at("The man says, \"What about `%w1?' Speak to me clearly son!\"", 8, 3, 20);      }    [ waiting for Jerrod to pick an option    [ assume he means "get mule"    if (vRancherStatus == 2)      {      [ Jerrod gets the mules (which will get him killed      [ later)      vRancherStatus = 3;      [ Jerrod needs to report back to Captain Buddy      CaptainBuddyStatus = 3;      [ note the animal type      AnimalTeam = 1;      [ score two points      currentScore  += 2;      print.at("The man says, \"These mules are mighty fine animals. I hope "               "they will do a good job for you.\"", 8, 3, 20);      print.at("\"I will deliver them to your company camp before nightfall.\"", 8, 3, 20);      }    }  else    {    print("No one is close enough to hear you.");    }  }  [ young oxen/youngif ((said("young", "ox") || said("young")))  {  [ if near the rancher  if (posn(ego, 13, 132, 30, 144))    {    [ if NOT waiting for Jerrod to pick an option    if ((vRancherStatus == 0 ||         vRancherStatus == 1 ||         vRancherStatus == 3))      {      print.at("The man says, \"What about `%w1 %w2?' You're not making sense "               "son!\"", 8, 3, 20);      }    [ if waiting for Jerrod to pick an option assume he    [ means "buy young oxen"    if (vRancherStatus == 2)      {      [ Jerrod gets the young oxen (which will get Jerrod      [ killed later)      vRancherStatus = 3;      [ Jerrod needs to report back to Captain Buddy      CaptainBuddyStatus = 3;      [ note the animal type      AnimalTeam = 2;      [ score 3 points      currentScore  += 3;      print.at("The man says, \"These are very strong, young oxen. I hope they "               "will perform well for you when the going gets rough.\"", 8, 3, 20);      print.at("\"I will deliver them to your company camp before nightfall.\"", 8, 3, 20);      }    }  else    {    print("No one is close enough to hear you.");    }  }  [ mature oxen/matureif ((said("mature", "ox") || said("mature")))  {  [ if near the rancher  if (posn(ego, 13, 132, 30, 144))    {    [ if NOT waiting for Jerrod to pick an option    if ((vRancherStatus == 0 ||         vRancherStatus == 1 ||         vRancherStatus == 3))      {      print.at("The man says, \"What about `%w1 %w2?' You're not making sense "               "son!\"", 8, 3, 20);      }    [ if waiting for Jerrod to pick an option assume he    [ means "get mature oxen"    if (vRancherStatus == 2)      {      [ Jerrod gets the mature oxen (good choice)      vRancherStatus = 3;      [ Jerrod needs to report back to Captain Buddy      CaptainBuddyStatus = 3;      [ note the animal type      AnimalTeam = 3;      [ score five points      currentScore  += 5;      [ play sound      sound(m.FoundGold, fSndDone);      print.at("The man says, \"These mature oxen are weathered, tested, and "               "true. I am sure you will not be disappointed.\"", 8, 3, 20);      print.at("\"I will deliver them to your company camp before nightfall.\"", 8, 3, 20);      }    }  else    {    print("No one is close enough to hear you.");    }  }  [ oxenif (said("ox"))  {  [ if near the rancher  if (posn(ego, 13, 132, 30, 144))    {    [ if NOT waiting for Jerrod to pick an option    if ((vRancherStatus == 0 ||         vRancherStatus == 1 ||         vRancherStatus == 3))      {      print.at("The man says, \"What about `%w1?' Speak to me clearly son!\"", 8, 3, 20);      }    [ if waiting for Jerrod to pick an option    if (vRancherStatus == 2)      {      [ rancher needs Jerrod to be more specific      print.at("The man says, \"What type of oxen; young oxen or mature oxen?\"", 8, 3, 20);      }    }  else    {    print("No one is close enough to hear you.");    }  }  [ get young oxenif ((said("acquire", "young", "ox") ||     said("buy", "young", "ox")))  {  [ if near the rancher  if (posn(ego, 13, 132, 30, 144))    {    [ if Jerrod already has animals    if (vRancherStatus == 3)      {      print("The man looks puzzled and says, \"You already have a team of "            "animals. You don't need more animals.\"");      }    [ if Jerrod doesn't have animals yet    if ((vRancherStatus == 0 ||         vRancherStatus == 1 ||         vRancherStatus == 2))      {      [ Jerrod gets the young oxen (which will get him      [ killed later)      vRancherStatus = 3;      [ Jerrod needs to report back to Captain Buddy      CaptainBuddyStatus = 3;      [ note the animal type      AnimalTeam = 2;      [ score three points      currentScore  += 3;      print.at("The man says, \"These are very strong, young oxen. I hope they "               "will perform well for you when the going gets rough.\"", 8, 3, 20);      print.at("\"I will deliver them to your company camp before nightfall.\"", 8, 3, 20);      }    }  else    {    print("No one is close enough to hear you.");    }  }[ get mature oxenif ((said("acquire", "mature", "ox") ||     said("buy", "mature", "ox")))  {  [ if near the rancher  if (posn(ego, 13, 132, 30, 144))    {    [ if Jerrod already has animals    if (vRancherStatus == 3)      {      print("The man looks puzzled and says, \"You already have a team of "            "animals. You don't need more animals.\"");      }    [ if Jerrod doesn't have any animals yet    if ((vRancherStatus == 0 ||         vRancherStatus == 1 ||         vRancherStatus == 2))      {      [ Jerrod gets the mature oxen (good choice)      vRancherStatus = 3;      [ Jerrod needs to report to Captin Buddy      CaptainBuddyStatus = 3;      [ note the animal type      AnimalTeam = 3;      [ score 5 points      currentScore  += 5;      sound(m.FoundGold, fSndDone);      print.at("The man says, \"These mature oxen are weathered, tested, and "               "true. I am sure you will not be disappointed.\"", 8, 3, 20);      print.at("\"I will deliver them to your company camp before nightfall.\"", 8, 3, 20);      }    }  else    {    print("No one is close enough to hear you.");    }  }  [ look gateif (said("examine", "gate"))  {  print("It is a corral gate.");  }  [ open gateif ((said("open", "gate") ||     said("unlock", "gate")))  {  print("You don't need to open the gate.");  }  [ look lockif (said("examine", "lock"))  {  print("Nothing special about this lock; it just keeps the gate closed.");  }  [ look barnif (said("examine", "barn"))  {  print("It is just an old barn. There is a rancher in the barn watching the "        "animals.");  }[ look/look aroundif ((said("examine", "around") || said("examine")))  {  print("This is the corral just south of Independence. There is a rancher in "        "the barn watching the animals.");  }  [ look mules/look oxenif ((said("examine", "animal") ||     said("examine", "donkey") ||     said("examine", "ox") ||     said("examine", "horse") ||     said("examine", "cattle")))  {  print("The rancher keeps the mules in this corral. He also has oxen, but they "        "are in another corral.");  }  [ look corral/lopk fenceif ((said("examine", "corral") ||     said("examine", "fence")))  {  print("There are animals in the corral.");  }  [ look buildings/look cityif ((said("examine", "building") ||     said("examine", "home") ||     said("examine", "church") ||     said("examine", "independence") ||     said("examine", "city")))  {  print("In the distance you can see a few buildings that make up part of "        "Independence.");  }  [ look treesif (said("examine", "forest"))  {  print("There are a few trees in the distance.");  }  [ animalif (said("animal"))  {  print("What about %w1?");  }  [ thank youif ((said("thank", "you") ||     said("thank") ||     said("thank", "boy") ||     said("thank", "rancher")))  {  print("You're welcome!");  }  [ climb fenceif (said("climb", "fence"))  {  print("If you do that you just might get kicked in the jaw!");  }  Done:[ call main timing logiccall(lgc.WagonTripTiming);return();[ **************************************[ MESSAGES[ **************************************#message 1 "The man says, \"Hello, young greenhorn, what can I do for you today?\""#message 2 "The man says, \"You've come to the right place for that!\""#message 3 "\"This is what I have to offer you; mules, young oxen, or mature oxen. Which would you like?\""#message 4 "The man says, \"This is a lovely time of year in Missouri!\""#message 5 "The man says, \"What a beautiful day!\""#message 6 "The man says, \"Mmmmmm! I love that aroma!!\""#message 7 "The man looks puzzled and says, \"You already have a team of animals. You don't need more animals.\""#message 8 "No one is close enough to hear you."#message 9 "The man says, \"What type of oxen; young oxen or mature oxen?\""#message 10 "The man says, \"These mules are mighty fine animals. I hope they will do a good job for you.\""#message 11 "\"I will deliver them to your company camp before nightfall.\""#message 12 "The man says, \"What about `%w1?' Speak to me clearly son!\""#message 13 "The man says, \"What about `%w1 %w2?' You're not making sense son!\""#message 14 "The man says, \"These are very strong, young oxen. I hope they will perform well for you when the going gets rough.\""#message 15 "The man says, \"These mature oxen are weathered, tested, and true. I am sure you will not be disappointed.\""#message 21 "You don't need to open the gate."#message 22 "You need to get closer."#message 23 "There's a rancher in the corner of the barn watching the animals."#message 24 "There is no %w2 out here!"#message 25 "It is just an old barn. There is a rancher in the barn watching the animals."#message 26 "This is the corral just south of Independence. There is a rancher in the barn watching the animals."#message 27 "The rancher keeps the mules in this corral. He also has oxen, but they are in another corral."#message 29 "There are animals in the corral."#message 30 "In the distance you can see a few buildings that make up part of Independence."#message 31 "There are a few trees in the distance."#message 32 "What about %w1?"#message 33 "You're welcome!"#message 35 "It is a corral gate."#message 36 "Nothing special about this lock; it just keeps the gate closed."#message 37 "If you do that you just might get kicked in the jaw!"