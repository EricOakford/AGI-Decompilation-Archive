[***********************************************************[[ rm.Livery[[ The livery is where Jerrod boards the stagecoach to begin[ the trip to California. He can also die in this scene by[ getting kicked by the mule if he gets too close.[[***********************************************************[ **************************************[ LOCAL DEFINES[ **************************************[ o1 is not used#define oPony                        o2#define oButt                        o3#define oCoach                       o4#define oHorse1                      o5#define oHorse2                      o6#define oMidget                      o7#define oWindow                      o8#define oCoachInterior               o9#define oCoachDoor                  o10#define vRndNum                    v220#define vPonyX                     v221#define vPonyY                     v222#define vPonyStep                  v223#define vButtStatus                v224#define vSwishCount                v225#define vMidgetStatus              v226#define vBoardPhase                v227#define vCoachTimer                v228#define vMidgetDist                v229#define vMidgetX                   v230#define vMidgetY                   v231#define vMidgetOldX                v232#define vMidgetOldY                v233#define vRndNum2                   v234#define fPoster                    f220#define fPonyMoved                 f221#define fButtMoved                 f222#define fGreetings                 f223#define fMidgetMoved               f224#define fWindowMoved               f225#define fCoachMoved                f226#define fCoachDrMoved              f227#define fNoCoachBlock              f228#define fSoundDone                 f229#define fCoachSoundDone            f230[ **************************************[ FIRST CYCLE ONLY[ **************************************if (isset(newRoom))  {  [ load, draw and discard the room picture  load.pic(currentRoom);  draw.pic(currentRoom);  discard.pic(currentRoom);    [ load views with add-on art  load.view(vw.Posters);  load.view(vw.SkylineArt);  [ if the gold rush is public  if (isset(RushIsPublic))    {    [ add a poster to wall    add.to.pic(vw.Posters, 0, 6, 114, 110, 11, 11);    set(fPoster);    }  [ add skyline art  add.to.pic(vw.SkylineArt, 0, 1, 0, 52, 4, 4);  add.to.pic(vw.SkylineArt, 0, 7, 120, 52, 4, 4);  add.to.pic(vw.SkylineArt, 0, 8, 140, 52, 4, 4);    [ poster view not needed anymore (this also discards  [ vw.SkylineArt)  discard.view(vw.Posters);    [ load views used in the room  load.view(vw.JerrodNY);  load.view(vw.StagecoachArt);  load.view(vw.LiveryArt);  load.view(vw.StageCoach);  load.view(vw.Midget);    [ load sounds used in the room  load.sound(s.AddToScore);  load.sound(m.Travel);  load.sound(m.Death);    [ add Livery sign  add.to.pic(vw.LiveryArt, 6, 0, 51, 78, 11, 11);  [ add small sign io coach building  add.to.pic(vw.LiveryArt, 6, 1, 131, 87, 11, 11);  [ add details to top of building  add.to.pic(vw.LiveryArt, 6, 3, 5, 51, 11, 11);  [ add Coach sign  add.to.pic(vw.LiveryArt, 6, 5, 116, 72, 11, 11);    [ if the stagecoach journey is initiated  if (StagecoachPhase != SC_NOT_STARTED)    {    [ add art that shows the coach door open    add.to.pic(vw.LiveryArt, 6, 2, 128, 135, 11, 11);    }      [ add the pony in the yard  vPonyY = 167;  vPonyStep = 1;  animate.obj(oPony);  set.view(oPony, vw.LiveryArt);  [ choose a random direction  random(0, 1, vRndNum);  if (vRndNum == 0)    {    set.loop(oPony, 0);    random(4, 32, vPonyX);    }  if (vRndNum == 1)    {    set.loop(oPony, 1);    random(48, 76, vPonyX);    }  set.priority(oPony, 15);  position.v(oPony, vPonyX, vPonyY);  draw(oPony);  set(fPonyMoved);    [ horse butt sticking out of the barn  animate.obj(oButt);  set.view(oButt, vw.LiveryArt);  set.loop(oButt, 2);  set.cel(oButt, 0);  position(oButt, 61, 116);  ignore.objs(oButt);  ignore.blocks(oButt);  draw(oButt);  stop.cycling(oButt);    [ the midget runs the livery  animate.obj(oMidget);  set.view(oMidget, vw.Midget);  position(oMidget, 44, 106);  ignore.blocks(oMidget);  draw(oMidget);  [ initial status is wandering  vMidgetStatus = 20;    [ if the stagecoach is here  if (StagecoachPhase > SC_NOT_STARTED &&      StagecoachPhase < SC_TRAVELLING)    {    [ show the coach and horse teams    [ horse team #1    animate.obj(oHorse1);    set.view(oHorse1, vw.StageCoach);    set.loop(oHorse1, 1);    fix.loop(oHorse1);    ignore.objs(oHorse1);    ignore.blocks(oHorse1);    [ horse team #2    animate.obj(oHorse2);    set.view(oHorse2, vw.StageCoach);    set.loop(oHorse2, 2);    fix.loop(oHorse2);    ignore.objs(oHorse2);    ignore.blocks(oHorse2);    [ stagecoach    animate.obj(oCoach);    set.view(oCoach, vw.StageCoach);    set.loop(oCoach, 0);    set.cel(oCoach, 0);    fix.loop(oCoach);    ignore.objs(oCoach);    ignore.blocks(oCoach);    [ stagecoach window (hides Jerrod until he's actually    [ in the coach)    animate.obj(oWindow);    set.view(oWindow, vw.LiveryArt);    set.loop(oWindow, 5);    set.cel(oWindow, 0);    fix.loop(oWindow);    set.priority(oWindow, 13);        [ if stagecoach is waiting for Jerrod to show his ticket    if (StagecoachPhase == SC_WAIT_TICKET)      {      position(oHorse1, 78, 144);      position(oHorse2, 102, 144);      position(oCoach, 126, 144);      position(oWindow, 149, 116);      }    [ if stagecoach is waiting for Jerrod to board    if (StagecoachPhase == SC_WAIT_BOARD)      {      [ the stagecoach is closer to middle of the scene      position(oHorse1, 52, 144);      position(oHorse2, 76, 144);      position(oCoach, 100, 144);      position(oWindow, 123, 116);      }    draw(oHorse1);    stop.update(oHorse1);    draw(oHorse2);    stop.update(oHorse2);    draw(oCoach);    stop.update(oCoach);    draw(oWindow);    stop.update(oWindow);    }      [ Jerrod, in his normal Brooklyn attire  animate.obj(ego);  set.view(ego, vw.JerrodNY);    [ adjust Jerrod's position based on which room he came  [ from  if (previousRoom == rm.StageCoachOffice)    {    position(ego, 1, 133);    }  if (posn(ego, 150, 110, 160, 138))    {    position(ego, 152, 139);    }  draw(ego);  [ this room uses a lot of conditional lines and block()   [ commands to manage Jerrod's movement, so he starts out  [ observing blocks  observe.blocks(ego);    [ now show the picture  show.pic();  }  [ **************************************[ EVERY CYCLE[ **************************************[ if pony reached destination going leftif (isset(fPonyMoved) && vPonyX < 40)  {  [ move pony right, to random location   reset(fPonyMoved);  random(48, 76, vPonyX);  move.obj.v(oPony, vPonyX, vPonyY, vPonyStep, fPonyMoved);  set.loop(oPony, 0);  }  [ if pony reached destination going rightif (isset(fPonyMoved) && vPonyX > 40)  {  [ move pony left, to random location  reset(fPonyMoved);  random(4, 32, vPonyX);  move.obj.v(oPony, vPonyX, vPonyY, vPonyStep, fPonyMoved);  set.loop(oPony, 1);  }  [ if horse's butt is done swishing tailif (vButtStatus != 23)  {  [ random chance horse will swish his tail  random(1, 35, vButtStatus);  [ one in 35 chance  if (vButtStatus == 23)    {    [ if more than 16 (means horse has pooped)    if (vSwishCount > 16)      {      [ after pooping, do a smaller swish      set.loop(oButt, 2);      set.cel(oButt, 2);      end.of.loop(oButt, fButtMoved);      ++vSwishCount;      }    [ if this is 16th tail swish    if (vSwishCount == 16)      {      [ time to poop      set.loop(oButt, 4);      set.cel(oButt, 0);      end.of.loop(oButt, fButtMoved);      ++vSwishCount;      }    [ if less than 16 swishes already    if (vSwishCount < 16)      {      [ swish the tail      set.loop(oButt, 2);      set.cel(oButt, 0);      end.of.loop(oButt, fButtMoved);      ++vSwishCount;      }    [ after 100 swishes    if (vSwishCount == 100)      {      [ reset the cycle      vSwishCount = 0;      }    }  }  [ after horse tail finishes its cycleif (isset(fButtMoved))  {  [ reset to starting cel  reset(fButtMoved);  set.loop(oButt, 2);  set.cel(oButt, 0);  [ set status to start another cycle  vButtStatus = 0;  [ after pooping  if (vSwishCount == 17)    {    [ add the poop to the screen    add.to.pic(vw.LiveryArt, 6, 4, 61, 116, 8, 8);    }      [ if Jerrod got kicked (counter is set to 101 when Jerrod  [ gets kicked)  if (vSwishCount > 100)    {    [ reset swish count    vSwishCount = 0;    [ play death sound    sound(m.Death, fSoundDone);    [ no more input    prevent.input();    [ Jerrod is officially dead    set(JerrodIsDead);    stop.motion(ego);    display(22, 0, "You have determined that walking behind a horse is "            "hazardous to your health.");    }  }  [ if Jerrod is behind the horse (and not already kicked)if (posn(ego, 59, 116, 62, 116) && vSwishCount < 101)  {  [ allow ego object to cycle at rest  set(CycleAtRest);  [ set counter so it will finalize Jerrod's death  vSwishCount = 101;  stop.motion(ego);  [ set status so no more swishing  vButtStatus = 23;  [ the horse kicks Jerrod - change view to show the kick  set.view(ego, vw.LiveryArt);  set.loop(ego, 3);  set.cel(ego, 0);  [ adjust Jerrod's position so the view showing him getting  [ kicked lines up correctly on screen  if (EgoX == 59)    {    TmpX = -8; [ 248;    }  if (EgoX == 60)    {    TmpX = -9; [ 247;    }  if (EgoX == 61)    {    TmpX = -10; [ 246;    }  if (EgoX == 62)    {    TmpX = -11; [ 245;    }  TmpY = 0;  reposition(ego, TmpX, TmpY);  [ play the loop one time  end.of.loop(ego, fButtMoved);  }  [ if midget is wandering aboutif ((vMidgetStatus == 21 || vMidgetStatus == 20))  {  [ random chance he moves  random(1, 40, vRndNum2);  if (vRndNum2 == 10)    {    [ one in 40 chance he moves right    move.obj(oMidget, 74, 106, 1, fMidgetMoved);    }  if (vRndNum2 == 30)    {    [ one in 40 chance he moves lest    move.obj(oMidget, 44, 106, 1, fMidgetMoved);    }  }  [ if Jerrod is near or inside the livery and hasn't been[ greeted by the midget yetif (posn(ego, 40, 102, 53, 107) && !isset(fGreetings))  {  [ set flag, and greet Jerrod  set(fGreetings);  print.at("\"Hi, Jerrod. Please wait outside. I will be right out to help "           "you.\"", 3, 4, 15);  [ midget waits for Jerrod to go outside  vMidgetStatus = 1;  }  [ if NOT near inside the livery and flag is setif (!posn(ego, 40, 102, 53, 107) && isset(fGreetings))  {  [ reset flag so midget will greet Jerrod again  [ when he comes back  reset(fGreetings);  }  [ if ego is outside and midget is comingif (posn(ego, 28, 119, 80, 138) && vMidgetStatus == 1)  {  [ move to 'point 2'  reset(fMidgetMoved);  vMidgetStatus = 2;  move.obj(oMidget, 59, 106, 1, fMidgetMoved);  [ keep Jerrod around until midget arrives  block(27, 118, 81, 139);  }  [ when midget gets to point 2if (isset(fMidgetMoved) && vMidgetStatus == 2)  {  [ move to 'point 3'  reset(fMidgetMoved);  vMidgetStatus = 3;  move.obj(oMidget, 54, 120, 1, fMidgetMoved);  }  [ when midget gets to point 3if (isset(fMidgetMoved) && vMidgetStatus == 3)  {  [ midget offers to help  reset(fMidgetMoved);  vMidgetStatus = 4;  print.at("\"What may I help you with today?\"", 4, 8, 15);  [ Jerrod is free to move again  unblock();  }[ if Jerrod leaves area while midget is offering helpif (!posn(ego, 28, 119, 80, 138) && vMidgetStatus == 4)  {  [ midget heads back into the livery  vMidgetStatus = 10;  [ make sure message window is closed  close.window();  move.obj(oMidget, 59, 106, 1, fMidgetMoved);  }  [ if midget gets to point 10if (isset(fMidgetMoved) && vMidgetStatus == 10)  {  [ move to point 11  reset(fMidgetMoved);  vMidgetStatus = 11;  move.obj(oMidget, 44, 106, 1, fMidgetMoved);  }  [ if midget gets to point 11if (isset(fMidgetMoved) && vMidgetStatus == 11)  {  [ midget returns to wandering  reset(fMidgetMoved);  vMidgetStatus = 20;  [ make sure ego is free to move  unblock();  }  [ get midget's current locationget.posn(oMidget, vMidgetX, vMidgetY);[ if midget has stopped movingif (vMidgetOldX == vMidgetX && vMidgetOldY == vMidgetY)  {  [ stop cycling when not moving  stop.cycling(oMidget);  }else  {  [ cycle when moving  start.cycling(oMidget);  }[ save midget's locationvMidgetOldX = vMidgetX;vMidgetOldY = vMidgetY;[ if the stagecoach is moving to pick up Jerrod if (StagecoachPhase == SC_MOVE_PICKUP)  {  [ move the horses and coach to pickup point so Jerrod can  [ board  move.obj(oHorse1, 52, 144, 1, fCoachMoved);  start.cycling(oHorse1);  move.obj(oHorse2, 75, 144, 1, fCoachMoved);  start.cycling(oHorse2);  move.obj(oCoach, 99, 144, 1, fCoachMoved);  start.cycling(oCoach);  [ move the window too (to keep it synchronized with coach)  move.obj(oWindow, 123, 116, 1, fWindowMoved);  start.cycling(oWindow);  [ next stage is at the pickup point  StagecoachPhase = SC_AT_PICKUP;  }  [ when coach gets to pickup pointif (StagecoachPhase == SC_AT_PICKUP && isset(fWindowMoved))  {  reset(fWindowMoved);  [ now waiting for Jerrod to board  StagecoachPhase = SC_WAIT_BOARD;  [ horses and coach stop (window too)  stop.update(oHorse1);  stop.update(oHorse2);  stop.update(oCoach);  stop.update(oWindow);  [ allow updates for everything else  start.update(ego);  start.update(oMidget);  start.update(oButt);  start.update(oPony);  [ make sure coach and window are at starting cels  set.cel(oCoach, 0);  set.cel(oWindow, 0);  [ and force them to redraw right now  force.update(oCoach);  }  [ if Jerrod has boarded the stagecoachif (StagecoachPhase == SC_BOARDED)  {  [ increment timer  ++vCoachTimer;  [ after a slight pause of 20 cycles  if (vCoachTimer == 20)    {    [ reset timer    vCoachTimer = 0;    [ stagecoach is now ready to leave    StagecoachPhase = SC_READY_TO_GO;    }  }  [ after the slight pause, stagecoach is ready to goif (StagecoachPhase == SC_READY_TO_GO)  {  [ stagecoach is moving again, to left edge, toward the   [ ferry dock  StagecoachPhase = SC_LEAVING;  start.update(oHorse1);  start.update(oHorse2);  start.update(oCoach);  move.obj(oHorse1, 1, 144, 1, fWindowMoved);  start.cycling(oHorse1);  move.obj(oHorse2, 24, 144, 1, fCoachMoved);  start.cycling(oHorse2);  move.obj(oCoach, 48, 144, 1, fCoachMoved);  start.cycling(oCoach);  }  [ after stagecoach gets to left edgeif (StagecoachPhase == SC_LEAVING && isset(fWindowMoved))  {  [ stop cycling   stop.cycling(oHorse1);  stop.cycling(oHorse2);  stop.cycling(oCoach);  [ don't advance to next room until sound is done  if (isset(fCoachSoundDone))    {    [ stagecoach is on next leg of journey, travelling to    [ the ferry docck    StagecoachPhase = SC_TRAVELLING;    new.room(rm.StageCoachOffice); [ ##LE001##    }  }  [ if the stagecoach boarding sequence has begun, and the [ stagecoach door is done movingif (vBoardPhase == 1 && isset(fCoachDrMoved))  {  [ reset the flag  reset(fCoachDrMoved);  [ move to next phase (Jerrod boards the coach)  vBoardPhase = 2;  [ stop Jerrod; the game will move him into the coach  [ automatically  stop.motion(ego);    [ the coach door object handles the animation that shows  [ Jerrod getting in the stagecoach  animate.obj(oCoachDoor);  set.view(oCoachDoor, vw.StagecoachArt);  set.loop(oCoachDoor, 1);  fix.loop(oCoachDoor);  set.cel(oCoachDoor, 0);  set.priority(oCoachDoor, 14);  position(oCoachDoor, 109, 129);  ignore.blocks(oCoachDoor);  ignore.objs(oCoachDoor);  draw(oCoachDoor);    [ use this object to show the detail inside the coach when  [ the door is open  animate.obj(oCoachInterior);  set.view(oCoachInterior, vw.StagecoachArt);  set.loop(oCoachInterior, 2);  set.priority(oCoachInterior, 13);  position(oCoachInterior, 109, 129);  ignore.blocks(oCoachInterior);  ignore.objs(oCoachInterior);  draw(oCoachInterior);    [ cycle the door open  end.of.loop(oCoachDoor, fCoachDrMoved);  }  [ after door opensif (vBoardPhase == 2 && isset(fCoachDrMoved))  {  [ next phase has Jerrod climb in the coach  reset(fCoachDrMoved);  vBoardPhase = 3;  [ stop the door  stop.cycling(oCoachDoor);  [ change ego view to show Jerrod climbing into coach  set.view(ego, vw.StagecoachArt);  set.loop(ego, 0);  fix.loop(ego);  set.cel(ego, 0);  [ adjust position so new ego view draws in the  [ correct spot  TmpX = -3; [ 253;  TmpY = 0;  reposition(ego, TmpX, TmpY);  set.priority(ego, 14);  [ cycle Jerrod to finish climbing in  end.of.loop(ego, fCoachDrMoved);  [ allow ego object to cycle at rest  set(CycleAtRest);  }  [ after Jerrod climbs inif (vBoardPhase == 3 && isset(fCoachDrMoved))  {  [ close the door  reset(fCoachDrMoved);  vBoardPhase = 4;  reverse.loop(oCoachDoor, fCoachDrMoved);  [ set its priority so it shows on top of everything else  set.priority(oCoachDoor, 15);  }  [ after stagecoach door closes with Jerrod insideif (vBoardPhase == 4 && isset(fCoachDrMoved))  {  [ boarding sequence is done  reset(fCoachDrMoved);  vBoardPhase = 5;  [ window cover object not needed  erase(oWindow);  [ ego object not needed  erase(ego);  [ coach door and interior not needed  erase(oCoachInterior);  erase(oCoachDoor);  [ reset the cycle-at-rest flag (it's default state)  reset(CycleAtRest);  [ set phase to boarded  StagecoachPhase = SC_BOARDED;  [ and score two points  currentScore  += 2;  }[ when the stagecoach is on the screen it blocks movement[ (the conditional lines inside 45, 140-159, 145) when the[ stagecoach is not there, need to allow Jerrod to pass[ through[ if stagecoach trip hasn't startedif (StagecoachPhase == SC_NOT_STARTED)  {  [ if Jerrod is near the blocked area and the flag  [ indicating its OK to pass over isn't set  if (posn(ego, 45, 140, 159, 145) && !isset(fNoCoachBlock))    {    [ set the flag    set(fNoCoachBlock);    [ allow Jerrod to pass    ignore.blocks(ego);    }  [ if Jerrod leaves the area and the flag is set  if (!posn(ego, 45, 140, 159, 145) && isset(fNoCoachBlock))    {    [ clear the flag and observe blocks    reset(fNoCoachBlock);    observe.blocks(ego);    }  }  [ if stagecoach is waiting for Jerrod to show his ticketif (StagecoachPhase == SC_WAIT_TICKET)  {  [ the coach is here, but hasn't moved to the pick-up  [ spot, so a smaller area is still passable  if (posn(ego, 45, 140, 70, 145) && !isset(fNoCoachBlock))    {    [ set the flag    set(fNoCoachBlock);    [ allow Jerrod to pass    ignore.blocks(ego);    }  [ if Jerrod leaves the area  if (!posn(ego, 45, 140, 70, 145) && isset(fNoCoachBlock))    {    [ clear the flag and observe blocks    reset(fNoCoachBlock);    observe.blocks(ego);    }  }  [ if Jerrod has presented his ticket, but hasn't boarded yetif ((StagecoachPhase == SC_MOVE_PICKUP ||     StagecoachPhase == SC_AT_PICKUP ||     StagecoachPhase == SC_WAIT_BOARD))  {  [ the coach has moved to the pick up point, so a different  [ area is unblocked  if (posn(ego, 135, 140, 159, 145) && !isset(fNoCoachBlock))    {    [ set the flag    set(fNoCoachBlock);    [ allow Jerrod to pass    ignore.blocks(ego);    }  if (!posn(ego, 135, 140, 159, 145) &&       isset(fNoCoachBlock))    {    [ clear the flag and observe blocks    reset(fNoCoachBlock);    observe.blocks(ego);    }  }  [ **************************************[ CHECK FOR AN EXIT CONDITION[ **************************************if ((edgeEgoHit == RIGHT_EDGE ||     edgeEgoHit == BOTTOM_EDGE))  {   new.room(rm.NewspaperOffice); [ ##LE002##  }if (edgeEgoHit == LEFT_EDGE)  {  new.room(rm.StageCoachOffice); [ ##LE003##  }  [ **************************************[ PROCESS PLAYER INPUT[ **************************************[ if player hasn't provided input no need to do said testsif (!isset(haveInput))  {  goto(Done);  }  [ look sign/read signif ((said("examine", "sign") ||     said("examine", "billboard") ||     said("read", "sign") ||     said("read", "billboard") ||     said("examine", "note") ||     said("read", "note")))  {  [ there are a couple signs to read  if (posn(ego, 102, 125, 159, 149))    {    if (posn(ego, 102, 125, 122, 149))      {      if (isset(fPoster))        {        print("   The stage is set, \n You best get on it!! \n \n  CALIFORNIA "              "GOLD!!");        }      else        {        print("You are not able to read the poster from here.");        }      }    if (posn(ego, 123, 125, 159, 149))      {      print("  The sign says \n\n\" EMPLOYEES ONLY! \"");      }    }  else    {    print("You are not able to read the poster from here.");    }  }[ get ticket/buy ticket/ etc (there are a lot of ways to ask[ for a stagecoach ticket)if ((said("go", "coach") ||     said("go", "west") ||     said("go", "calif") ||     said("go", "independence") ||     said("go", "journey") ||     said("passage", "calif") ||     said("acquire", "coach") ||     said("acquire", "journey") ||     said("ride", "coach") ||     said("ride", "coach", "calif") ||     said("ride", "calif") ||     said("buy", "journey") ||     said("buy", "ticket") ||     said("buy", "ticket", "boy") ||     said("buy", "coach", "ticket") ||     said("buy", "coach", "ticket", "boy") ||     said("buy", "ticket", "coach") ||     said("buy", "ticket", "calif") ||     said("want", "ticket") ||     said("want", "buy", "ticket") ||     said("want", "acquire", "ticket") ||     said("want", "coach", "ticket") ||     said("want", "buy", "coach", "ticket") ||     said("want", "acquire", "coach", "ticket") ||     said("ask", "ticket") ||     said("ask", "coach", "ticket") ||     said("ask", "ticket", "coach") ||     said("ask", "boy", "ticket") ||     said("ask", "boy", "coach", "ticket") ||     said("ask", "boy", "ticket", "coach") ||     said("acquire", "ticket") ||     said("acquire", "ticket", "boy") ||     said("acquire", "coach", "ticket") ||     said("acquire", "ticket", "coach") ||     said("acquire", "ticket", "calif") ||     said("pay") ||     said("pay", "boy") ||     said("pay", "price") ||     said("pay", "ticket", "price") ||     said("pay", "price", "ticket") ||     said("pay", "bucks") ||     said("pay", "boy", "bucks") ||     said("pay", "bucks", "boy") ||     said("pay", "ticket") ||     said("pay", "boy", "ticket") ||     said("contribute", "bucks") ||     said("contribute", "bucks", "boy") ||     said("contribute", "boy", "bucks") ||     said("need", "ticket") ||     said("need", "coach", "ticket") ||     said("need", "ticket", "coach") ||     said("need", "ticket", "calif")))  {  [ get distance to midget  distance(ego, oMidget, vMidgetDist);  [ if close enough  if (vMidgetDist < 30)    {    [ if the midget has offered to help (and is waiting for    [ a reply)    if (vMidgetStatus == 4)      {      [ he can't sell Jerrod a ticket, but his response depends      [ on whether rush is public knowledge      if (isset(RushIsPublic))        {        print.at("The midget says, \"So the gold in California is luring you "                 "away from Brooklyn. You surprise me, Jerrod!\"", 4, 5, 0);        }      else        {        print.at("The midget says, \"So you believe those rumors about gold, "                 "Jerrod. You are a courageous young man!\"", 4, 8, 15);        }      print.at("\"I am thinking about heading West, but all I am giving up is a "               "life of shoveling manure. You have something to lose!\"", 4, 5, 0);      print.at("\"But anyway, Jerrod. I can't help you yet, I don't sell "               "tickets\"", 4, 5, 0);      }    else      {      print.at("\"Hi, Jerrod. Please wait outside. I will be right out to help "               "you.\"", 3, 4, 15);      [ set flag indicating midget has started talking to       [ Jerrod, and have midget start moving to Jerrod      set(fGreetings);      vMidgetStatus = 1;      }    }  else    {    print("The stage driver says, \"You need to show it to the short man.\"");    }  }  [ show ticket/give ticketif ((said("show", "ticket") ||     said("show", "ticket", "boy") ||     said("show", "boy", "ticket") ||     said("show", "coach", "ticket", "boy") ||     said("show", "boy", "coach", "ticket") ||     said("show", "coach", "ticket") ||     said("use", "ticket") ||     said("use", "coach", "ticket") ||     said("contribute", "ticket") ||     said("contribute", "ticket", "boy") ||     said("contribute", "boy", "ticket") ||     said("contribute", "coach", "ticket", "boy") ||     said("contribute", "boy", "coach", "ticket") ||     said("contribute", "coach", "ticket")))  {  [ get distance to midget  distance(ego, oMidget, vMidgetDist);  [ if close enough  if (vMidgetDist < 30)    {    [ if the midget has offered to help (and is waiting for    [ a reply)    if (vMidgetStatus == 4)      {      [ does Jerrod have a ticket?      if ((has("Cape Horn ticket") ||           has("Panama ticket") ||           has("Stage coach ticket")))        {        [ is it a stagecoach ticket?        if (has("Stage coach ticket"))          {          [ drop ticket from inventory          drop("Stage coach ticket");          [ response from midget depends on           [ whether rush is public knowledge          if (isset(RushIsPublic))            {            print.at("The midget says, \"So you've made up your mind to go for "                     "the gold! I hope you strike it rich!\"", 6, 10, 0);            }          else            {            print.at("The midget says, \"So you believe those rumors about the "                     "gold. I hope you strike it rich!\"", 6, 10, 0);            }          [ play score sound          sound(s.AddToScore, fSoundDone);          [ midget calls for the stagecoach          print.at("\"Hey! Harry! Bring that stage on over here!\"", 5, 8, 15);          [ score two points          currentScore  += 2;          [ begin moving the carriage          start.update(oHorse1);          start.update(oHorse2);          start.update(oCoach);          start.update(oWindow);          StagecoachPhase = SC_MOVE_PICKUP;          }        else          {          [ wrong ticket          print.at("The short man says, \"You cannot use that ticket here, "                   "Jerrod. You need to go to the ship dock!\"", 4, 8, 20);          }        }      else        {        [ no ticket        print.at("You don't even have a ticket!", 3, 4, 15);        }      }    else      {      [ midget not ready to talk yet      print.at("\"Hi, Jerrod. Please wait outside. I will be right out to help "               "you.\"", 3, 4, 15);      [ set flag to show midget has greeted Jerrod      set(fGreetings);      [ and midget starts moving outside to talk with Jerrod      vMidgetStatus = 1;      }    }  else    {    print("The stage driver says, \"You need to show it to the short man.\"");    }  }  [ enter stagecoach/get in stagecoachif ((said("enter", "coach") ||     said("open", "coach") ||     said("open", "door") ||     said("board", "coach") ||     said("enter") ||     said("go", "coach") ||     said("climb", "coach") ||     said("go", "door") ||     said("ride", "coach") ||     said("open", "coach", "door") ||     said("open", "door", "coach") ||     said("jump", "coach") ||     said("acquire", "coach") ||     said("hop", "coach")))  {  [ if stagecoach isn't ready to start its journey  if (StagecoachPhase == SC_NOT_STARTED)    {    print("This door is open only when the stage is ready to leave.");    }  [ if stagecoach is not i place and ready for Jerrod to  [ board yet  if ((StagecoachPhase == SC_WAIT_TICKET ||       StagecoachPhase == SC_MOVE_PICKUP ||       StagecoachPhase == SC_AT_PICKUP))    {    print("The stage driver lets you know, in no uncertain terms, that you had "          "better not do that just yet!");    }  [ if stagecoach is in place, waiting for Jerrod to board  if (StagecoachPhase == SC_WAIT_BOARD)    {    [ only if near the stagecoach    if (posn(ego, 109, 144, 122, 147))      {      [ play sound      sound(m.Travel, fCoachSoundDone);      [ move Jerrod to exact point needed to board      ignore.blocks(ego);      set.priority(ego, 15);      move.obj(ego, 118, 144, 1, fCoachDrMoved);      [ start the boarding sequence      vBoardPhase = 1;      }    else      {      print("Get closer!!");      }    }  }  [ look aroundif ((said("examine", "around") ||     said("examine") ||     said("examine", "building")))  {  print("This is the Brooklyn livery.");  }  [ look liveryif ((said("examine", "livery") ||     said("examine", "livery", "building") ||     said("examine", "brooklyn", "livery")))  {  print("There is usually a midget around the livery.");  }  [ look horseif ((said("examine", "horse") || said("examine", "animal")))  {  print("You are at the livery. You are going to see a few horses!");  }  [ talk to man[ notice that 'talk to midget' is a separate test, with [ only a few responses; not sure why they didn't include[ the midget hereif ((said("speak", "boy") || said("speak")))  {  [ get distance to midget  distance(ego, oMidget, vMidgetDist);  [ if coach trip han't started yet  if (StagecoachPhase == SC_NOT_STARTED)    {    [  if midget is close enough    if (vMidgetDist < 30)      {      [  and ready to talk      if (vMidgetStatus == 4)        {        print.at("\"What may I help you with today?\"", 4, 8, 15);        [ unblock Jerrod during the conversation, so he is        [ free to leave if he wants        unblock();        }      else        {        [ midget begins sequence to start conversation        print.at("\"Hi, Jerrod. Please wait outside. I will be right out to "                 "help you.\"", 3, 4, 15);        set(fGreetings);        vMidgetStatus = 1;        }      }    else      {      print("There is no one close enough.");      }    }  else    {    [ if stagecoach is here, but Jerrod hasn't boarded yet    if (StagecoachPhase > SC_NOT_STARTED &&         StagecoachPhase < SC_BOARDED)      {      [ if near the coach      if (posn(ego, 83, 130, 137, 155))        {        print("The stage driver has nothing to say!");        [ skip to the end        goto(Done);        }      [ if midget is close enough      if (vMidgetDist < 30)        {        [ and ready to talk        if (vMidgetStatus == 4)          {          print.at("\"What may I help you with today?\"", 4, 8, 15);          [ unblock Jerrod during the conversation, so he is          [ free to leave if he wants          unblock();          }        else          {          [ midget begins sequence to start conversation with Jerrod          print.at("\"Hi, Jerrod. Please wait outside. I will be right out to "                   "help you.\"", 3, 4, 15);          set(fGreetings);          vMidgetStatus = 1;          }        [ skip to the end        goto(Done);        }      print("There is no one close enough.");      }    else      {      print("You are in the stage by yourself!");      }    }  }  if (said("speak", "midget"))  {  [ get distance to midget  distance(ego, oMidget, vMidgetDist);  [ if close enough  if (vMidgetDist < 30)    {    [ and ready to talk    if (vMidgetStatus == 4)      {      print.at("\"What may I help you with today?\"", 4, 8, 15);      [ unblock Jerrod during the conversation, so he is free      [ to leave if he wants      unblock();      }    else      {      [ begin sequence to start conversation with Jerrod      print.at("\"Hi, Jerrod. Please wait outside. I will be right out to help "               "you.\"", 3, 4, 15);      set(fGreetings);      vMidgetStatus = 1;      }    }  else    {    print("The midget cannot hear you at this distance.");    }  }  [ talk to driverif ((said("speak", "driver") ||     said("speak", "coach", "driver") ||     said("speak", "boy", "coach")))  {  [ if stagecoach isn't here yet  if (StagecoachPhase == SC_NOT_STARTED)    {    print("There is no stage driver in sight!");    }  else    {    [ if coach is here, and Jerrod hasn't boarded yet    if (StagecoachPhase > SC_NOT_STARTED &&         StagecoachPhase < SC_BOARDED)      {      [ if Jerrod is close enough      if (posn(ego, 83, 130, 137, 155))        {        print("The stage driver has nothing to say!");        }      else        {        print("The stage driver cannot hear you from there.");        }      }    else      {      print("You are in the stage by yourself!");      }    }  }  [ look manif (said("examine", "boy"))  {  [ get distance to midget  distance(ego, oMidget, vMidgetDist);  [ if stagecoach isn't here, midget is only one to see  if (StagecoachPhase == SC_NOT_STARTED)    {    [ if midget is close enough    if (vMidgetDist < 30)      {      print("This man is so short it is unbelievable!");      }    else      {      print("There is no one close enough.");      }    }  else    {    [ if midget is close enough    if (vMidgetDist < 30)      {      print("This man is so short it is unbelievable!");      }    [ if stagecoach is here, and Jerrod hasn't boarded yet    if (StagecoachPhase > SC_NOT_STARTED &&         StagecoachPhase < SC_BOARDED)      {      [ if close enough to the stagecoach      if (posn(ego, 0, 118, 159, 167))        {        print("There is a man sitting on the stage.");        }      else        {        print("Just outside of the livery, there is a man sitting on the stage.");        }      }    else      {      [ Jerrod is IN the stagecoach      print("You are in the stage by yourself!");      }    }  }  [ look midgetif ((said("examine", "midget") || said("find", "midget")))  {  [ get distance to midget  distance(ego, oMidget, vMidgetDist);  [ if close enough  if (vMidgetDist < 30)    {    print("This man is so short it is unbelievable!");    }  else    {    print("The midget isn't close enough to get a good look.");    }  }  [ look at driverif ((said("examine", "driver") ||     said("examine", "coach", "driver") ||     said("examine", "boy", "coach")))  {  [ if stagecoach isn't here  if (StagecoachPhase == SC_NOT_STARTED)    {    print("There is no stage driver in sight!");    }  else    {    [ if stagecoach is here and Jerrod hasn't boarded yet    if (StagecoachPhase > SC_NOT_STARTED &&         StagecoachPhase < SC_BOARDED)      {      [ if Jerrod is close enough      if (posn(ego, 0, 118, 159, 167))        {        print("There is a man sitting on the stage.");        }      else        {        print("Just outside of the livery, there is a man sitting on the stage.");        }      }    else      {      print("You are in the stage by yourself!");      }    }  }  [ look stagecoachif ((said("examine", "coach") || said("examine", "cart")))  {  [ if stagecoach isn't here yet  if (StagecoachPhase == SC_NOT_STARTED)    {    print("There is no stage here now.");    }  else    {    print("This stage is state of the art!!");    }  }  [ ticketif (said("ticket"))  {  print("What about a ticket?");  }  [ look fence/look corralif ((said("examine", "fence") || said("examine", "corral")))  {  print("This fence keeps the horses from wandering all over Brooklyn.");  }  [ look windowif (said("examine", "glass"))  {  print("It is just a typical window.");  }  [ buy horse/get horseif ((said("buy", "horse") || said("acquire", "horse")))  {  print("These horses are not for sale!");  }  [ look roadif (said("examine", "path"))  {  print("This is Fulton Street!");  }  [ look down/look groundif ((said("examine", "down") ||     said("examine", "dirt") ||     said("examine", "deck")))  {  print("Around these stables you really need to watch your step!");  }  [ ride horseif (said("ride", "horse"))  {  print("The horse is not yours!");  }  Done:return();[ **************************************[ MESSAGES[ **************************************#message 1 "   The stage is set, \n You best get on it!! \n \n  CALIFORNIA GOLD!!"#message 2 "You are not able to read the poster from here."#message 3 "  The sign says \n\n\" EMPLOYEES ONLY! \""#message 4 "\"Hi, Jerrod. Please wait outside. I will be right out to help you.\""#message 5 "\"What may I help you with today?\""#message 8 "There is no stage here now."#message 9 "The midget says, \"So the gold in California is luring you away from Brooklyn. You surprise me, Jerrod!\""#message 10 "This door is open only when the stage is ready to leave."#message 11 "The stage driver lets you know, in no uncertain terms, that you had better not do that just yet!"#message 12 "Now what? %g69"#message 13 "Yes?"#message 14 "No?"#message 15 "Get closer!!"#message 16 "Sorry! "#message 17 "The midget says, \"So you've made up your mind to go for the gold! I hope you strike it rich!\""#message 18 "\"Hey! Harry! Bring that stage on over here!\""#message 19 "The short man says, \"You cannot use that ticket here, Jerrod. You need to go to the ship dock!\""#message 20 "You have determined that walking behind a horse is hazardous to your health."#message 21 "This is the Brooklyn livery."#message 22 "You are at the livery. You are going to see a few horses!"#message 23 "There is no one close enough."#message 24 "This man is so short it is unbelievable!"#message 25 "There is a man sitting on the stage."#message 26 "Just outside of the livery, there is a man sitting on the stage."#message 27 "You are in the stage by yourself!"#message 28 "The midget isn't close enough to get a good look."#message 29 "There is no stage driver in sight!"#message 30 "The stage driver has nothing to say!"#message 31 "The stage driver cannot hear you from there."#message 32 "The midget cannot hear you at this distance."#message 33 "The stage driver says, \"You need to show it to the short man.\""#message 34 "You don't even have a ticket!"#message 35 "This stage is state of the art!!"#message 36 "What about a ticket?"#message 37 "This fence keeps the horses from wandering all over Brooklyn."#message 38 "It is just a typical window."#message 39 "These horses are not for sale!"#message 40 "This is Fulton Street!"#message 41 "Around these stables you really need to watch your step!"#message 42 "The horse is not yours!"#message 43 "There is usually a midget around the livery."#message 44 "The midget says, \"So you believe those rumors about gold, Jerrod. You are a courageous young man!\""#message 47 "The midget says, \"So you believe those rumors about the gold. I hope you strike it rich!\""#message 48 "\"But anyway, Jerrod. I can't help you yet, I don't sell tickets\""#message 49 "\"I am thinking about heading West, but all I am giving up is a life of shoveling manure. You have something to lose!\""