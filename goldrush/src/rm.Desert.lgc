[***********************************************************[[ rm.Desert[[ In this short interactive room that happens just before [ Jerrod arrives in California, Jerrod has to find water[ and food or he will die in the desert. The room also is [ used to handle the dying animals if Jerrod got the young[ oxen in Independence.[[***********************************************************[ **************************************[ LOCAL DEFINES[ **************************************#define oWagon                       o1#define oTeam1                       o2#define oTeam2                       o3[ v220 and v221 are not used#define vDeadOxStatus              v222[ v223 and v224 are not used#define vOxTimer                   v225#define vDesertStatus              v226#define vMainTimer1                v227#define vMainTimer2                v228#define vStarveStatus              v229#define fWagonMoved                f220#define fTeam1Moved                f221#define fTeam2Moved                f222#define fDoneDying                 f223#define fAnimalsGone               f224#define fWagonGone                 f225#define fDrankWater                f226#define fAteFood                   f227#define fSndDone                   f228#define fWarningMsg                f229[ **************************************[ FIRST CYCLE ONLY[ **************************************if (isset(newRoom))  {  [ load main timing logic  load.logics(lgc.WagonTripTiming);    [ load picture for current room  load.pic(currentRoom);    [ load views used in room  load.view(vw.SickJerrodCA);  load.view(vw.DyingJerrodCA);  load.view(vw.GreenRiverArt);  load.view(vw.OldWagon);    [ load only sound used in the room  load.sound(s.AddToScore);    [ draw current picture  draw.pic(currentRoom);    [ if timing point is NOT at time for oxen to die  if (CurrentTripTime != YoungOxDeathTime)    {    [ add the old abandoned wagon to the picture as    [ background art    add.to.pic(vw.OldWagon, 0, 0, 21, 105, 4, 4);    }      [ Jerrod's wagon  animate.obj(oWagon);  set.view(oWagon, vw.GreenRiverArt);  set.loop(oWagon, 0);  fix.loop(oWagon);  position(oWagon, 126, 131);  [ only show if at normal time point; not if Jerrod's young  [ oxen are going to die  if (CurrentTripTime == TripPoint_14)    {    draw(oWagon);    }      [ animal team #1  animate.obj(oTeam1);  set.view(oTeam1, vw.GreenRiverArt);  set.loop(oTeam1, 2);  fix.loop(oTeam1);  position(oTeam1, 80, 131);  [ only show if at normal time point; not if Jerrod's young  [ oxen are going to die  if (CurrentTripTime == TripPoint_14)    {    draw(oTeam1);    }      [ animal team #2  animate.obj(oTeam2);  set.view(oTeam2, vw.GreenRiverArt);  set.loop(oTeam2, 2);  fix.loop(oTeam2);  position(oTeam2, 103, 132);  [ only show if at normal time point; not if Jerrod's young  [ oxen are going to die  if (CurrentTripTime == TripPoint_14)    {    draw(oTeam2);    }      [ show Jerrod as sick, in California attire (he's dying  [ from thirst)  animate.obj(ego);  set.view(ego, vw.SickJerrodCA);  set.loop(ego, 1);  position(ego, 153, 143);  egoDir = STOPPED;  draw(ego);    [ now show the picture  show.pic();  }  [ **************************************[ EVERY CYCLE[ **************************************[ if time for Jerrod's young oxen to dieif (CurrentTripTime == YoungOxDeathTime)  {  [ if at beginning of scene  if (vDeadOxStatus == 0)    {    [ advance to next stage    vDeadOxStatus = 1;        [ change game speed to a bit slower (I'm not sure why    [ they need to do this - it must be to make sure the    [ scene times out the way they intended, without being    [ affected by player's choice of animation speed)    animationInterval = 3;    print("You are alone and stranded in the middle of the desert.");    print("Those young oxen, lacking the stamina of mature oxen, died a few "          "miles into the desert.");    print("You have been walking for miles and are dying of starvation, thirst "          "and exhaustion.");    print("You can't go much further...");    }      [ if at stage 1  if (vDeadOxStatus == 1)    {    [ increment timer    ++vOxTimer;    [ after 120 cycles    if (vOxTimer == 120)      {      [ advance to end stage (stage 2 gets skipped - (maybe      [ there used to be something there, but it got      [ deleted?)      vDeadOxStatus = 3;      [ reset timer      vOxTimer = 0;      [ show Jerrod falling down dead      set.view(ego, vw.DyingJerrodCA);      [ (make sure to start with first cel)      set.cel(ego, 0);      end.of.loop(ego, fDoneDying);      }    }      [ after Jerrod falls down dead  if (isset(fDoneDying) && vDeadOxStatus == 3)    {    [ reset flag    reset(fDoneDying);    [ advance status to show scene is over    vDeadOxStatus = 4;    [ Jerrod is officially dead on the trail    EgoHealthStatus = 43;    [ load and call logic to handle the details    load.logics(lgc.DeathOnTrail);    call(lgc.DeathOnTrail);    }  }  [ if this is normal timing point (oxen not dying)if (CurrentTripTime == TripPoint_14)  {  [ if scene has just started  if (vDesertStatus == 0)    {    [ advance to next stage    vDesertStatus = 1;    print("You are suffering from severe thirst and starvation. Life as you "          "know it is nearly over...");    print("...unless you do something quick!");    [ wagon and animal teams slowly move across the scene    move.obj(oTeam1, 0, 131, 1, fTeam1Moved);    move.obj(oTeam2, 0, 132, 1, fTeam2Moved);    move.obj(oWagon, 0, 131, 1, fWagonMoved);    [ force game speed here; not sure why - probably to make    [ sure the timimng of the scene plays out as intended by    [ the programmers    animationInterval = 2;    }      [ when wagon reaches left edge  if (isset(fWagonMoved))    {    [ remove it from screen    reset(fWagonMoved);    erase(oWagon);    [ set flag to show wagon is gone    set(fWagonGone);    }      [ when team 1 reaches left edge  if (isset(fTeam1Moved))    {    [ remove it from screen    reset(fTeam1Moved);    erase(oTeam1);    }      [ when team 2 reaches left edge  if (isset(fTeam2Moved))    {    [ remove it from screen    reset(fTeam2Moved);    erase(oTeam2);    [ set flag to show animals are gone    set(fAnimalsGone);    }      [ if Jerrod reaches left edge and hasn't  [ been warned yet  if (edgeEgoHit == LEFT_EDGE && !isset(fWarningMsg))    {    [ this if block will never happen; when CurrentTripTime    [ can never equal TripPoint_14 and YoungOxDeathTime at    [ the same time because when YoungOxDeathTime gets set    [ to 11, TripPoint_14 is set to zero at same time (see    [ rm.LIJMSC_Corral logic)    if (CurrentTripTime == YoungOxDeathTime)      {      goto(CheckForDeath);      }          [ if Jerrod has found food and water    if (isset(fAteFood) && isset(fDrankWater))      {      [ change animation interval to 2 (I guess that's the      [ 'default' for the trip?)      animationInterval = 2;            [ Jerrod made it! continue on to California!      print("You are on your way again!");      set(ContinueJourney);      }    else      {      [ show message one time      set(fWarningMsg);      print("Your company wagon has no food or water. If you follow it you will "            "surely die.");      }    }    CheckForDeath:[ if Jerrod walks away from left edge and warning is[ currently set  if (posn(ego, 1, 20, 1, 167) && isset(fWarningMsg))    {    [ reset warning so it comes back if Jerrod goes to left    [ edge again    reset(fWarningMsg);    }      [ if Jerrod still needs to drink or eat  if ((!isset(fAteFood) || !isset(fDrankWater)))    {    [ increment main timer level 1    ++vMainTimer1;    [ when timer level 1 reaches 10 cycles    if (vMainTimer1 == 10)      {      [ reset timer level 1      vMainTimer1 = 0;      [ increment timer level 2      ++vMainTimer2;      [ when timer level 2 gets to 250       [ (that's 2500 cycles in total)      if (vMainTimer2 == 250)        {        [ Jerrod is going to die from starvation/thirst                [ stop motion, allow ego object to cycle at rest        stop.motion(ego);        set(CycleAtRest);        [ switch to dying view        set.view(ego, vw.DyingJerrodCA);        [ make sure to start at first cel        set.cel(ego, 0);        [ run thorugh loop one time        end.of.loop(ego, fDoneDying);        [ advance to next stage        vStarveStatus = 1;        }      }    }      [ after Jerrod is done dying due to starvation/thirst  if (isset(fDoneDying) && vStarveStatus == 1)    {    [ reset timer    reset(fDoneDying);    [ advance status to show he's gone    vStarveStatus = 2;    [ Jerrod dies in the desert    EgoHealthStatus = 200;    print("Your body is too weak to carry on. It gives up.");    [ call logic to handle deatils of death    call(lgc.DeathOnTrail);    }      [ even if Jerrod found food and water, he needs to get  [ moving to catch up with the wagon  if (isset(fAteFood) && isset(fDrankWater))    {    [ increment timer level 1    ++vMainTimer1;    [ after three cycles    if (vMainTimer1 == 3)      {      [ reset timer      vMainTimer1 = 0;      [ increment timer level 2      ++vMainTimer2;      [ when timer level 2 gets to 50 cycles      [ (that's 150 cycles total)      if (vMainTimer2 == 50)        {        [ Jerrod dies because he didn't get back to the        [ wagon in time                [ stop motion        stop.motion(ego);        [ allow ego object to cycle at rest        set(CycleAtRest);        [ switch to dying view        set.view(ego, vw.DyingJerrodCA);        [ make sure to start at cel 0        set.cel(ego, 0);        [ run through loop one time        end.of.loop(ego, fDoneDying);        [ advance to stage 2        vStarveStatus = 2;        }      }    }    [ after Jerrod finishes falling down dead  if (isset(fDoneDying) && vStarveStatus == 2)    {    [ reset flag    reset(fDoneDying);        [ this is a bug; it should be 3, but since the flag    [ 'fDoneDying' gets reset, it doesn't actually cause a    [ problem    vStarveStatus = 2;        [ Jerrod dies in the desert    EgoHealthStatus = 200;    print("You are too far behind your company wagon. You are left by yourself "          "to die in the desert.");    [ call logic to handle details of death    call(lgc.DeathOnTrail);    }  }  [ **************************************[ PROCESS PLAYER INPUT[ **************************************[ if player hasn't provided input no need to do said testsif (!isset(haveInput))  {  goto(Done);  }  [ look/look aroundif ((said("examine", "around") ||     said("examine", "desert") ||     said("examine")))  {  [ if young oxen are dead  if (CurrentTripTime == YoungOxDeathTime)    {    print("You are in the middle of a desert. There is nothing near you.");    }  else    {    print("There is an abandoned wagon near the desert trail. You see a barrel "          "on the side of the abandoned wagon.");    }  }  [ look road/look trailif ((said("examine", "path") || said("examine", "desert", "path")))  {  print("This is a desolate trail.");  }  [ look plantsif ((said("examine", "bush") || said("examine", "plant")))  {  print("There are a few bushes in sight, but they are very sparse.");  }  [ look hillsif (said("examine", "foot hill"))  {  print("You can see hills in the distance.");  }    [ look cactusif (said("examine", "cacti"))  {  print("Cactuses are a familiar sight in deserts, but there are none in sight.");  }  [ dig for waterif ((said("dig") || said("dig", "water")))  {  print("You have nothing to dig with.  Even if you did, this ground is soooo "        "dry, you'd never get a drop.");  }  [ get water/drink waterif ((said("acquire", "water") ||     said("anyword", "drink", "rol") ||     said("drink", "rol")))  {  [ if young oxen are dead  if (CurrentTripTime == YoungOxDeathTime)    {    print("There is no water anywhere around here.");    }  else    {    [ if Jerrod is near the water barrel    if (posn(ego, 33, 103, 58, 111))      {      [ if Jerrod has already drank the water      if (isset(fDrankWater))        {        print("There is no more water.");        }      else        {        [ play score sound        sound(s.AddToScore, fSndDone);        [ score four points        currentScore  += 4;        print("You drink all the water that remains in the water barrel.");        [ set flag        set(fDrankWater);        [ follow up message depends on whether Jerrod is        [ still starving or not        if (!isset(fAteFood))          {          print("But you still need something to eat or you will surely die!");          }        else          {          print("Now you must try to catch up with your company wagon.");          [ reset timers; Jerrod has to get moving          vMainTimer1 = 0;          vMainTimer2 = 0;          }        }      }    else      {      print("You can't see any water right here.");      }    }  }  [ look sandif (said("examine", "sand"))  {  print("There is sand all over this desert, but it is of no use to you.");  }  [ look animalsif ((said("examine", "animal") ||     said("examine", "ox") ||     said("examine", "ox", "team") ||     said("examine", "team") ||     said("examine", "animal", "team")))  {  [ if young oxen are dead  if (CurrentTripTime == YoungOxDeathTime)    {    print("The oxen are miles behind you lying in the desert dust.");    }  else    {    [ if animals have left the screen    if (isset(fAnimalsGone))      {      print("The animal team is leaving you in their dust!");      }    else      {      print("The animal team is barely alive, but continues westward.");      }    }  }  [ look wagonif (said("examine", "cart"))  {  [ if young oxen are dead  if (CurrentTripTime == YoungOxDeathTime)    {    print("There is no wagon in sight.");    }  else    {    print("There is an abandoned wagon near the desert trail. You see a barrel "          "on the side of the abandoned wagon.");    }  }  [ look in wagonif (said("examine", "in", "cart"))  {  [ if young oxen are dead  if (CurrentTripTime == YoungOxDeathTime)    {    print("There is no wagon in sight.");    }  else    {    [ if Jerrod is near the wagon    if (posn(ego, 26, 103, 63, 113))      {      [ if Jerrod has already eaten the food      if (isset(fAteFood))        {        print("You see nothing in the wagon.");        }      else        {        [ discarded meat is better than nothing        print("In the abandoned wagon you see some discarded meat.");        }      }    else      {      print("You can't see in the abandoned wagon from here.");      }    }  }  [ look horse/look muleif ((said("examine", "horse") || said("examine", "donkey")))  {  [ if young oxen are dead  if (CurrentTripTime == YoungOxDeathTime)    {    print("There are no animals in sight.");    }  else    {    [ if animals have left the screen    if (isset(fAnimalsGone))      {      print("The animal team is leaving you in their dust!");      }    else      {      print("These animals are oxen!");      }    }  }[ jump in cartif ((said("enter", "cart") || said("jump", "cart")))  {  [ if young oxen are dead  if (CurrentTripTime == YoungOxDeathTime)    {    print("There is no wagon in sight.");    }  else    {    [ if wagon is off the screen    if (isset(fWagonGone))      {      print("You don't have the strength.");      }    else      {      print("The animal team is barely strong enough to pull the wagon by "            "itself.  Any extra weight at all might do them in!");      }    }  }[ look barrelif ((said("examine", "barrel") ||     said("examine", "water", "barrel")))  {  [ if young oxen are dead  if (CurrentTripTime == YoungOxDeathTime)    {    print("There is no barrel in sight.");    }  else    {    [ if Jerrod is near the barrel    if (posn(ego, 33, 103, 58, 111))      {      print("This is no mirage, this is a barrel!");      }    else      {      print("From here you aren't sure if the barrel is real, or just a mirage.");      }    }  }  [ take barrelif ((said("acquire", "barrel") ||     said("acquire", "water", "barrel")))  {  [ if young oxen are dead  if (CurrentTripTime == YoungOxDeathTime)    {    print("There is no barrel in sight.");    }  else    {    print("You don't need to carry around a barrel.");    }  }  [ look canopyif (said("examine", "canopy"))  {  [ if young oxen are dead  if (CurrentTripTime == YoungOxDeathTime)    {    [ reset the haveMatch flag, and let the main logic    [ handle this input    reset(haveMatch);    }  else    {    print("The canopy is ripped, exposing part of the inside of the wagon.");    }  }  [ look wheelif ((said("examine", "wheel") ||     said("examine", "cart", "wheel")))  {  [ if young oxen are dead  if (CurrentTripTime == YoungOxDeathTime)    {    print("There is no wheel in sight.");    }  else    {    [ if wagon is gone    if (isset(fWagonGone))      {      print("The wheels of the abandoned wagon are half buried in sand.");      }    else      {      print("The wheels of your company wagon continue to move westward.");      }    }  }  [ look meatif ((said("examine", "meat") || said("examine", "food")))  {  [ if young oxen are dead  if (CurrentTripTime == YoungOxDeathTime)    {    [ reset the haveMatch flag, and let the main logic    [ handle this input    reset(haveMatch);    }  else    {    [ if Jerrod is near the wagon    if (posn(ego, 26, 103, 63, 113))      {      [ if Jerrod already ate the food      if (isset(fAteFood))        {        print("There is no more meat.");        }      else        {        print("The meat looks old, dry, stale, and walked on.");        }      }    else      {      print("You see no meat right here.");      }    }  }  [ eat meatif ((said("eat", "meat") ||     said("acquire", "meat") ||     said("eat", "food") ||     said("acquire", "food")))  {  [ if young oxen are dead  if (CurrentTripTime == YoungOxDeathTime)    {    print("There is no meat anywhere.");    }  else    {    [ if Jerrod is near the wagon    if (posn(ego, 33, 103, 58, 111))      {      [ if Jerrod already ate the meat      if (isset(fAteFood))        {        print("There is no more meat.");        }      else        {        [ play score sound        sound(s.AddToScore, fSndDone);        [ score four points        currentScore  += 4;        print("The meat looks repulsive, but you are so hungry, you eat every "              "bite.");        [ set the flag        set(fAteFood);                [ follow up response depends on whether Jerrod is        [ still thirsty or not        if (!isset(fDrankWater))          {          print("You still need to get something to drink or you will surely "                "die.");          }        else          {          print("Now you must try to catch up with your company wagon.");          [ reset timers; Jerrod needs to get moving          vMainTimer1 = 0;          vMainTimer2 = 0;          }        }      }    else      {      print("You can't see any meat.");      }    }  }  [ look in barrel/open barrelif ((said("examine", "in", "barrel") ||     said("examine", "in", "water", "barrel") ||     said("examine", "water") ||     said("open", "barrel") ||     said("open", "water", "barrel")))  {  [ if young oxen are dead  if (CurrentTripTime == YoungOxDeathTime)    {    print("There is no water anywhere around here.");    }  else    {    [ if Jerrod is near the barrel    if (posn(ego, 33, 103, 58, 111))      {      [ if Jerrod already drank the water      if (isset(fDrankWater))        {        print("There is no more water.");        }      else        {        print("You see some water in the bottom of the water barrel.");        }      }    else      {      print("You can't do that from here.");      }    }  }  Done:[ call main timing logiccall(lgc.WagonTripTiming);return();[ **************************************[ MESSAGES[ **************************************#message 1 "You are alone and stranded in the middle of the desert."#message 2 "Those young oxen, lacking the stamina of mature oxen, died a few miles into the desert."#message 3 "You have been walking for miles and are dying of starvation, thirst and exhaustion."#message 4 "You can't go much further..."#message 6 "The animals are very thirsty, but they aren't dying of thirst like you are!!"#message 7 "You are extremely weak from lack of food and the intense heat."#message 8 "The animals are also weak and hungry, but they are faring far better than you."#message 9 "You aren't sure how much longer you will be able to hang on to the already thin, and ever thinning, silver cord of life!!"#message 10 "You are in the middle of a desert. There is nothing near you."#message 11 "This is a desolate trail."#message 12 "There are a few bushes in sight, but they are very sparse."#message 13 "You can see hills in the distance."#message 14 "Cactuses are a familiar sight in deserts, but there are none in sight."#message 15 "You have nothing to dig with.  Even if you did, this ground is soooo dry, you'd never get a drop."#message 16 "There is no water anywhere around here."#message 17 "There is sand all over this desert, but it is of no use to you."#message 18 "The animal team is barely alive, but continues westward."#message 19 "There are no animals in sight."#message 20 "The animal team is leaving you in their dust!"#message 21 "In the abandoned wagon you see some discarded meat."#message 22 "These animals are oxen!"#message 24 "The animal team is barely strong enough to pull the wagon by itself.  Any extra weight at all might do them in!"#message 25 "There is an abandoned wagon near the desert trail. You see a barrel on the side of the abandoned wagon."#message 26 "You can't see any water right here."#message 27 "The oxen are miles behind you lying in the desert dust."#message 28 "There is no wagon in sight."#message 29 "From here you aren't sure if the barrel is real, or just a mirage."#message 30 "There is no barrel in sight."#message 31 "You don't need to carry around a barrel."#message 32 "You drink all the water that remains in the water barrel."#message 33 "But you still need something to eat or you will surely die!"#message 34 "Now you must try to catch up with your company wagon."#message 35 "Your company wagon has no food or water. If you follow it you will surely die."#message 36 "The canopy is ripped, exposing part of the inside of the wagon."#message 37 "There is no wheel in sight."#message 38 "The wheels of the abandoned wagon are half buried in sand."#message 39 "The wheels of your company wagon continue to move westward."#message 40 "You can't see in the abandoned wagon from here."#message 41 "There is no more meat."#message 42 "The meat looks old, dry, stale, and walked on."#message 43 "You see no meat right here."#message 44 "There is no more water."#message 45 "There is no meat anywhere."#message 46 "There is no more meat."#message 47 "The meat looks repulsive, but you are so hungry, you eat every bite."#message 48 "You still need to get something to drink or you will surely die."#message 49 "You can't see any meat."#message 50 "You don't have the strength."#message 51 "You see some water in the bottom of the water barrel."#message 52 "You are too far behind your company wagon. You are left by yourself to die in the desert."#message 53 "Your body is too weak to carry on. It gives up."#message 54 "You are suffering from severe thirst and starvation. Life as you know it is nearly over..."#message 55 "...unless you do something quick!"#message 56 "This is no mirage, this is a barrel!"#message 57 "You are on your way again!"#message 58 "You see nothing in the wagon."#message 59 "You can't do that from here."