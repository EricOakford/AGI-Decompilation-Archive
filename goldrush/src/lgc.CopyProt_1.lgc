[***********************************************************[[ lgc.CopyProt_1[[ first of three rooms that displays the cowboy and asks a[ trivia question to confirm ownership[[ if the player answers correctly, the game continues[ loading; if incorrect, then the gallows scene is shown and[ the game ends[[***********************************************************[ **************************************[ LOCAL DEFINES[ **************************************#define oCowboyMouth                 o1#define oCowboyEyes                  o2#define oCowboyHand                  o3#define vCharPos                   v220[ v221-v236 contain player entered input#define vDispChar                  v237#define vCheckSum                  v238#define vTmpPic                    v239#define vSpaceChar                 v240#define vTmpVal                    v241#define vMouthState                v242#define vMouthCounter              v243#define vBlinkCounter              v244#define vEyeState                  v245#define vMouthState2               v246[ v247 is not used#define vMouthCycle                v248#define vEyesCycle                 v249#define vHandCycle                 v250[ f220 is not used#define fAnswered                  f221#define fValidate                  f222#define fWrongAnswer               f223#define fAnswering                 f224#define fSkipCheck                 f225#define fDebugQuit                 f226#define fRightAnswer               f227#define fContinue                  f228[ **************************************[ FIRST CYCLE ONLY[ **************************************if (isset(newRoom))  {  [cycle times for cowboy animations  vMouthCycle = 10;  vEyesCycle = 8;  vHandCycle = 5;    [ for the security check, normal input is not used  reset(enableMenu);  prevent.input();  program.control();  status.line.off();    [ QuickStart is another debug flag; if it were set, the  [ game wouldn't even ask for copy protection check; it's   [ reset here, but it doesn't need to since at the start,  [ all flags are false by default  reset(QuickStart);    [ use pic.Start to show the 'Questioning Cowboy'  vTmpPic = pic.Start;  load.pic(vTmpPic);  draw.pic(vTmpPic);  discard.pic(vTmpPic);    [ this view has the animations used by the Questioning  [ Cowboy  load.view(vw.Startup);    [ add cowboy to the background image  add.to.pic(vw.Startup, 0, 0, 3, 167, 7, 7);    [ initialize the variables used to manage the  [ question/answer  vCharPos = 221;  lastChar = 0;  vCheckSum = 0;  CheckCol = 20;  CheckRow = 20;  vSpaceChar = 123;    [ add title to the background image  add.to.pic(vw.Startup, 0, 1, 0, 72, 7, 7);    [ Cowboy's mouth  animate.obj(oCowboyMouth);  set.view(oCowboyMouth, vw.Startup);  set.loop(oCowboyMouth, 3);  set.cel(oCowboyMouth, 0);  position(oCowboyMouth, 25, 141);  draw(oCowboyMouth);  stop.cycling(oCowboyMouth);  cycle.time(oCowboyMouth, vMouthCycle);    [ Cowboy's eyes  animate.obj(oCowboyEyes);  set.view(oCowboyEyes, vw.Startup);  set.loop(oCowboyEyes, 2);  set.cel(oCowboyEyes, 0);  position(oCowboyEyes, 24, 111);  set.priority(oCowboyEyes, 15);  draw(oCowboyEyes);  stop.cycling(oCowboyEyes);  cycle.time(oCowboyEyes, vEyesCycle);    [ Cowboy's hand (but don't show it yet)  animate.obj(oCowboyHand);  set.view(oCowboyHand, vw.Startup);  set.loop(oCowboyHand, 1);  set.cel(oCowboyHand, 0);  position(oCowboyHand, 58, 167);  cycle.time(oCowboyHand, vHandCycle);    [ now show the picture  show.pic();  }[ **************************************[ EVERY CYCLE:[ **************************************[ check for debug modeif (isset(DebugMode))  {  [ let user enter 'go' to start or enter 'bandit' for 50/50  [ chance of quitting  reset(haveMatch);  set(fSkipCheck);  }else  {  [ setting haveMatch to 'true' prevents said commands from  [ doing anything; there are none here, but there are some  [ in the Main Logic that could interfere with the  [ processing of the question/answer for copy check  set(haveMatch);  }  [ use a phase number and counter to manage the animation of[ the cowboy's mouth to roughly match the displayed text[ if 'speaking'if (vMouthCounter > 0)  {  [ increment counter    ++vMouthCounter;  }  [ first speaking part is the introductionif (vMouthState == 1)  {  [ start 'speaking' intro  vMouthState = 2;  start.cycling(oCowboyMouth);  vMouthCounter = 1;  }  [ after enough time 'speaking' the intro, stopif (vMouthCounter == 250 && vMouthState == 2)  {  [ stop 'speaking' intro  vMouthCounter = 0;  vMouthState = 3;  set.cel(oCowboyMouth, 0);  stop.cycling(oCowboyMouth);  }  [ after enough time 'speaking' the question, stopif (vMouthCounter == 200 && vMouthState == 5)  {  [ stop 'speaking' question  vMouthCounter = 0;  vMouthState = 6;  set.cel(oCowboyMouth, 0);  stop.cycling(oCowboyMouth);  }  [ if eye-blink state is at beginningif (vEyeState == 0)  {  [ choose a random interval  random(70, 120, vBlinkCounter);  [ I found in dosbox that the eyes blink too rapidly with  [ this range of interval; changing to this range seems to  [ help[  random(140, 240, vBlinkCounter);    [ advance to next stage  vEyeState = 1;  }[ if eyes are in pause period between blinksif (vEyeState == 1)  {  [ decrement blink count  --vBlinkCounter;  }  [ when count reaches zeroif (vBlinkCounter == 0 && vEyeState == 1)  {  [ advance to next stage (blinking)  vEyeState = 2;  start.cycling(oCowboyEyes);  [ blink for 15 cycles  vBlinkCounter = 15;  }  [ while eyes are blinkingif (vEyeState == 2)  {  [ decrement interval  --vBlinkCounter;  }  [ when eyes are done blinkingif (vEyeState == 2 && vBlinkCounter == 0)  {  [ start another cycle  vEyeState = 0;  stop.cycling(oCowboyEyes);  [ make sure eyes are open  set.cel(oCowboyEyes, 0);  }  [ first thing at the start, show the Cowboy's introduction[ and explanation for the quizif (isset(StartQuiz))  {  reset(StartQuiz);  set(leaveWindow);  print.at("\"Hey city slicker! Any varmit that tries to cross my claim better "           "be ready to pay the consequences! But I reckon I can let ya pass on "           "by if ya can answer a simple question from yer miner's manual, "           "\"California Gold\". Otherwise, I'll string ya up quicker than you "           "can say Winnemucca, Nevada!\"", 2, 17, 22);  [ mouth starts closed  vMouthState = 1;  lastChar = 0;  display(23, 0, "      Press return to continue!");  }  [ if during or after 'speaking' the intro (states 2 or 3),[ wait for any key to continue to next phaseif ((vMouthState == 2 || vMouthState == 3))  {  if (have.key())    {    [ move on to start speaking question    vMouthState = 5;    vMouthCounter = 1;    start.cycling(oCowboyMouth);    clear.lines(23, 23, BLACK);    set(fAnswering);    [ to allow input while the question is showing, set the    [ leaveWindow flag    set(leaveWindow);    [ now print the question that was selected in    [ lgc.InitQuiz    print.at.v(TestQuestion, 3, 17, 22);    lastChar = 0;    }  }  [ if a key was pressed, and getting answer, and not in debug[ mode, and not at the end of the input line, and not[ already answeredif ((lastChar != 0) &&     (!isset(DebugMode)) &&     (isset(fAnswering)) &&     (vCharPos < 236) &&     (!isset(fAnswered)))  {  [process the keypress    [ 8 = 'backspace' key; ignore if at beginning of line  if ((lastChar == 8) && (vCharPos > 221))    {    [ clear the character    lastChar = 0;    [decrement the input pointer and display column    --vCharPos;    --CheckCol;    [ draw a blank space to cover up the character    display.v(CheckRow, CheckCol, vSpaceChar);    }  else    {    [ 13 = 'enter' key    if (lastChar == 13)      {      [ back up one space (we don't need the trailing      [ carriage return)      --vCharPos;      [ answer has been entered      set(fAnswered);      [ no longer accepting input for the answer      reset(fAnswering);      }    else      {      [ for any other characters, only upper or lower case      [ alphabet characters are accepted            [ check lower case first      if ((lastChar > 96) && (lastChar < 123))        {        [ save the value as a pointer to the message with        [ the matching letter        vDispChar = lastChar;                [ clear the input        lastChar = 0;                [ display the charater on input line        display.v(CheckRow, CheckCol, vDispChar);        [ increment column position        ++CheckCol;                [ convert to upper case (all letters saved in the        [ input array are upper case to make the checksum        [ test easier)        vDispChar -= 32;        [ save it to the input array        *vCharPos = vDispChar;        ++vCharPos;        }      else        {        if ((lastChar > 64) && (lastChar < 91))          {          [ save the value as a pointer          vDispChar = lastChar;          [ but also add offset so it points to the correct          [ letter          vDispChar  += 32;                     [display the character         display.v(CheckRow, CheckCol, vDispChar);          ++CheckCol;                    [ save it to the input array (it's already upper          [ case)          *vCharPos = lastChar;          lastChar = 0;          ++vCharPos;          }        }      }    }  }else  {  [ if nothing is input, check to see if the text already  [ added is too long  if ((vCharPos > 234) &&       (!isset(DebugMode)) &&       (isset(fAnswering)) &&       (!isset(fAnswered)))    {    [ we know if answer is too long that it's just wrong    set(fWrongAnswer);    }  }[ if an answer was entered and it's at least one char long[ calculate a checksum to determine if it's right or wrongif ((isset(fAnswered)) && (vCharPos > 220))  {  [ this is a bit of an odd way to handle the checksum  [ calculation; normally this would be in a loop; but in  [ this case, the programmers just let the regular  [ logic cycle handle the calculation; in each cycle of the  [ interpreter, another character gets added, until  [ eventually the character position pointer gets back  [ to the beginning  vDispChar = *vCharPos;  vCheckSum  += vDispChar;  --vCharPos;  }else  {  [ eventually, the pointer gets back to zero;  if ((isset(fAnswered)) && (vCharPos < 221))    {    [ stop adding to the checksum and move on to validation    [ step     reset(fAnswering);    reset(fAnswered);    set(fValidate);    }  }  [ once check sump is done (assuming not in debug mode)if ((isset(fValidate)) && (!isset(DebugMode)))  {  [ validation only checked once  reset(fValidate);    [ compare the checksum to the correct value based on which  [ question was asked  if (TestQuestion == 1)    {    if (vCheckSum == 164)      {      set(fRightAnswer);      }    else      {      set(fWrongAnswer);      }    }  if (TestQuestion == 2)    {    if (vCheckSum == 91)      {      set(fRightAnswer);      }    else      {      set(fWrongAnswer);      }    }  if (TestQuestion == 3)    {    if (vCheckSum == 81)      {      set(fRightAnswer);      }    else      {      set(fWrongAnswer);      }    }  if (TestQuestion == 4)    {    if (vCheckSum == 178)      {      set(fRightAnswer);      }    else      {      set(fWrongAnswer);      }    }  if (TestQuestion == 5)    {    if (vCheckSum == 254)      {      set(fRightAnswer);      }    else      {      set(fWrongAnswer);      }    }  if (TestQuestion == 6)    {    if ((vCheckSum == 161 || vCheckSum == 244))      {      set(fRightAnswer);      }    else      {      set(fWrongAnswer);      }    }  if (TestQuestion == 7)    {    if ((vCheckSum == 181 || vCheckSum == 8))      {      set(fRightAnswer);      }    else      {      set(fWrongAnswer);      }    }  if (TestQuestion == 8)    {    if (vCheckSum == 74)      {      set(fRightAnswer);      }    else      {      set(fWrongAnswer);      }    }  if (TestQuestion == 9)    {    if (vCheckSum == 240)      {      set(fRightAnswer);      }    else      {      set(fWrongAnswer);      }    }  if (TestQuestion == 10)    {    if (vCheckSum == 237)      {      set(fRightAnswer);      }    else      {      set(fWrongAnswer);      }    }  if (TestQuestion == 11)    {    if (vCheckSum == 112)      {      set(fRightAnswer);      }    else      {      set(fWrongAnswer);      }    }  if (TestQuestion == 12)    {    if (vCheckSum == 102)      {      set(fRightAnswer);      }    else      {      set(fWrongAnswer);      }    }  if (TestQuestion == 13)    {    if (vCheckSum == 234)      {      set(fRightAnswer);      }    else      {      set(fWrongAnswer);      }    }  if (TestQuestion == 14)    {    if (vCheckSum == 118)      {      set(fRightAnswer);      }    else      {      set(fWrongAnswer);      }    }  if (TestQuestion == 15)    {    if (vCheckSum == 62)      {      set(fRightAnswer);      }    else      {      set(fWrongAnswer);      }    }  if (TestQuestion == 16)    {    if (vCheckSum == 131)      {      set(fRightAnswer);      }    else      {      set(fWrongAnswer);      }    }  if (TestQuestion == 17)    {    if (vCheckSum == 186)      {      set(fRightAnswer);      }    else      {      set(fWrongAnswer);      }    }  if (TestQuestion == 18)    {    if (vCheckSum == 107)      {      set(fRightAnswer);      }    else      {      set(fWrongAnswer);      }    }  if (TestQuestion == 19)    {    if (vCheckSum == 173)      {      set(fRightAnswer);      }    else      {      set(fWrongAnswer);      }    }  if (TestQuestion == 20)    {    if (vCheckSum == 14)      {      set(fRightAnswer);      }    else      {      set(fWrongAnswer);      }    }  if (TestQuestion == 21)    {    if (vCheckSum == 26)      {      set(fRightAnswer);      }    else      {      set(fWrongAnswer);      }    }  if (TestQuestion == 22)    {    if (vCheckSum == 76)      {      set(fRightAnswer);      }    else      {      set(fWrongAnswer);      }    }  if (TestQuestion == 23)    {    if (vCheckSum == 236)      {      set(fRightAnswer);      }    else      {      set(fWrongAnswer);      }    }  if (TestQuestion == 24)    {    if (vCheckSum == 27)      {      set(fRightAnswer);      }    else      {      set(fWrongAnswer);      }    }  if (TestQuestion == 25)    {    if (vCheckSum == 111)      {      set(fRightAnswer);      }    else      {      set(fWrongAnswer);      }    }  if (TestQuestion == 26)    {    if (vCheckSum == 16)      {      set(fRightAnswer);      }    else      {      set(fWrongAnswer);      }    }  if (TestQuestion == 27)    {    if (vCheckSum == 65)      {      set(fRightAnswer);      }    else      {      set(fWrongAnswer);      }    }  if (TestQuestion == 28)    {    if (vCheckSum == 39)      {      set(fRightAnswer);      }    else      {      set(fWrongAnswer);      }    }  if (TestQuestion == 29)    {    if (vCheckSum == 97)      {      set(fRightAnswer);      }    else      {      set(fWrongAnswer);      }    }  }[ fSkipCheck is never set; this appears to be debug code;[ the fSkipCheck flag was probably set to true during[ testing to allow the programmers to not bother with[ entering the answers to the questions; the line of code[ setting fSkipCheck was probably commented out for the[ game's releaseif (isset(fSkipCheck))  {  if (said("go"))    {    lastChar = 0;    new.room(rm.Title); [ ##LE001##    }  if (said("bandit"))    {    [ old debug code that doesn't do anything now    random(0, 1, vTmpVal);    if (vTmpVal > 0)      {      goto(Continue);      }    }  }  [ fDebugQuit flag is never set; this is presumably left over[ debug codeContinue:if (isset(fDebugQuit))  {  [ quit without warning  quit(1);  }  [ if a correct answer was enteredif (isset(fRightAnswer))  {  [ reset the flag; only check once for right answer  reset(fRightAnswer);  lastChar = 0;    [ set mouth state so cowboy can 'congrats'  vMouthState2 = 1;    [ erase the entered text  clear.text.rect(20, 20, 20, 38, BLACK);    [ display congratulatory text, and have cowboy's hand move  [ to 'wave/point'  set(leaveWindow);  print.at("Congrats partner!\n\nHave fun now!  I hope ya strike it rich!", 10, 17, 22);  draw(oCowboyHand);  end.of.loop(oCowboyHand, fContinue);  start.cycling(oCowboyMouth);  }  [ after hand animation is done, if (isset(fContinue) && vMouthState2 == 1)  {  [ move to next phase, which is having the cowboy 'speak'  [ the last message  reset(fContinue);  vMouthState2 = 2;  vMouthCounter = 0;  }  [ if cowboy is speaking last messageif (vMouthState2 == 2)  {  [ increment counter  ++vMouthCounter;  }[ after 70 cycles if (vMouthState2 == 2 && vMouthCounter > 70)  {  [ done speaking- continue the game  vMouthCounter = 0;  vMouthState2 = 0;  close.window();  set.cel(oCowboyEyes, 0);  set.cel(oCowboyMouth, 0);  force.update(oCowboyEyes);    [ go to the opening Title screen  new.room(rm.Title); [ ##LE002##  }  [ if a WRONG answer was enteredif (isset(fWrongAnswer))  {  [ don't really need to reset this flag, but they did  [ anyway  reset(fWrongAnswer);  lastChar = 0;  [ have cowboy open his mouth  set.cel(oCowboyMouth, 1);  force.update(oCowboyMouth);  [ to say 'gotcha!!  print.at("Gotcha!!", 12, 23, 0);    [ send the cheatin' player to the gallows  new.room(rm.Gallows); [ ##LE003##  }  return();[ **************************************[ MESSAGES[ **************************************#message 1 "What was James Wilson Marshall's occupation?\n\n\n\n\n%m173 2, %m174 first paragraph."#message 2 "Which route to California did some consider to be the most difficult, and popular?\n\n\n\n%m173 3, %m174 third paragraph."#message 3 "If someone experienced the excitement and lure of the California gold, they claimed to have seen one of these.\n\n\n\n%m173 8, %m174 second paragraph."#message 4 "Give the first name of a prominent journalist for the New York Tribune.\n\n\n\n\n%m173 9, %m174 second paragraph."#message 5 "No matter which route was taken to the land of gold, this disease was a deadly threat.\n\n\n\n%m173 10, %m174 fifth paragraph."#message 6 "On the way to riches was the first time many travelers tasted one of these.  They were advised to eat only the core.\n\n\n%m173 11, %m174 last paragraph."#message 7 "What is one type of lizard wildlife you might see in the Panamanian jungle?\n\n\n\n\n%m173 13, %m174 last paragraph."#message 8 "What is the last name of the Mexican governor ruling the territory of California when Sutter arrived?\n\n\n\n%m173 15, %m174 fifth paragraph."#message 9 "This type of shop assisted Sutter and Marshall in ascertaining whether the gold they found was real.\n\n\n%m173 16, %m174 fifth paragraph."#message 10 "By the end of 1849, this settlement had a population of 12,000 people.\n\n\n\n\n%m173 18, %m174 second paragraph."#message 11 "At the beginning of the gold rush, Coloma had none of this.\n\n\n%m173 23, %m174 first paragraph."#message 12 "The citizens of Dry Diggins changed the cities name to this.\n\n\n%m173 25, %m174 last paragraph."#message 13 "Give the last name of a man that made his fortune in the gold country working on wheelbarrows and then returned to Indiana.\n\n\n%m173 27, %m174 sixth paragraph."#message 14 "Give the nickname given to the mailman named Thompson.\n\n\n\n\n%m173 27, %m174 last paragraph."#message 15 "The nickname of a bandit called Dick was this.\n\n\n\n\n%m173 31, %m174 last paragraph."#message 16 "What is the last name of a well known writer that spent time in Angels Camp during the 1860's?\n\n\n%m173 41, %m174 last paragraph."#message 17 "Bennager was his first name, but what was the last name of the storekeeper that made a spectacular discovery in Angels Camp?\n\n\n%m173 41, %m174 second paragraph."#message 18 "Black Bart spent some time in one of these.\n\n\n\n\n%m173 46, %m174 third paragraph."#message 19 "This Hill was the county seat of Calaveras County prior to that honor being given to San Andreas.\n\n\n\n\n%m173 48, %m174 first paragraph."#message 20 "What was the last name of the man responsible for starting one of the most famous mines in America?\n\n\n\n%m173 53, %m174 second paragraph."#message 21 "On selected afternoons, one of these, accompanied by a bull, provided some rather distasteful entertainment.\n\n\n%m173 63, %m174 second paragraph."#message 22 "This building in Columbia was saved by the efforts of the towns children.\n\n\n\n%m173 68, %m174 first paragraph."#message 23 "A steady diet of salty provisions sometimes caused this disease.\n\n\n\n\n%m173 62, %m174 last paragraph."#message 24 "What is the last name of an early frontiersman who resigned from the army in 1847 and settled in the San Fransisco bay area?\n\n\n%m173 70, %m174 last paragraph."#message 25 "This present day National Park was once an indian stronghold.\n\n\n\n\n%m173 72, %m174 third paragraph."#message 26 "Give the last name of an investor in hardrock mining that reportedly made $50,000 a month from his mining interest.\n\n\n%m173 56, %m174 last paragraph."#message 27 "These diggins comprised the biggest hydraulic mine in the world.\n\n\n\n\n%m173 76, %m174 fourth paragraph."#message 28 "Sutter Creek is the location of the only water-powered one of these in the United States.\n\n\n\n%m173 58, %m174 second paragraph."#message 29 "Herbert Hoover, who spent some time in Nevada City, earned his degree at this university.\n\n\n\n%m173 79, %m174 second paragraph."#message 96 "\"Hey city slicker! Any varmit that tries to cross my claim better be ready to pay the consequences! But I reckon I can let ya pass on by if ya can answer a simple question from yer miner's manual, \"California Gold\". Otherwise, I'll string ya up quicker than you can say Winnemucca, Nevada!\""#message 97 "A"#message 98 "B"#message 99 "C"#message 100 "D"#message 101 "E"#message 102 "F"#message 103 "G"#message 104 "H"#message 105 "I"#message 106 "J"#message 107 "K"#message 108 "L"#message 109 "M"#message 110 "N"#message 111 "O"#message 112 "P"#message 113 "Q"#message 114 "R"#message 115 "S"#message 116 "T"#message 117 "U"#message 118 "V"#message 119 "W"#message 120 "X"#message 121 "Y"#message 122 "Z"#message 123 " "#message 172 "Gotcha!!"#message 173 "Here's a hint for ya!\n\nOn page"#message 174 "try readin' the"#message 176 "ascii value: %v238"#message 177 "Congrats partner!\n\nHave fun now!  I hope ya strike it rich!"#message 179 "      Press return to continue!"