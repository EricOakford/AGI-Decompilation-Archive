[***********************************************************[[ rm.SF_SouthGate[ [ This room includes the south gate of Sutters Fort as seen[ from inside the fort. The fort guards' quarters are here.[[***********************************************************[ **************************************[ LOCAL DEFINES[ **************************************#define oDoor1                       o1#define oDoor2                       o2#define oDoor3                       o3#define oHangman                     o4#define vTmpX                      v220#define fForcePriority             f220#define fDoor1Moved                f221#define fDoor1Open                 f222#define fDoor2Moved                f223#define fDoor2Open                 f224#define fDoor3Moved                f225#define fDoor3Open                 f226#define fBehindWindow              f227#define fSoundDone                 f238[ **************************************[ FIRST CYCLE ONLY[ **************************************if (isset(newRoom))  {  [ load, draw and discard picture for current room  load.pic(currentRoom);  draw.pic(currentRoom);  discard.pic(currentRoom);    [ load view with art used in this room  load.view(vw.SuttersFortArt);  [ add guard in chair next guards quarters  add.to.pic(vw.SuttersFortArt, 0, 0, 114, 93, 8, 0);  [ add furniture to guards quarters  add.to.pic(vw.SuttersFortArt, 0, 2, 130, 83, 5, 5);  [ done with this view  discard.view(vw.SuttersFortArt);    [ load mule logic  load.logics(lgc.Mule);    [ load views used in the room  load.view(vw.JerrodCA);  load.view(vw.Letter);  load.view(vw.SF_Doors1);  load.view(vw.WindowJerrod);    [ load sounds used in the room  load.sound(s.Effect1);  load.sound(s.Effect2);    [ man hanging from gallows at gate? yes, this is an easter  [ egg that shows up when talking to the guard  animate.obj(oHangman);  set.view(oHangman, vw.Letter);  set.loop(oHangman, 1);  set.cel(oHangman, 0);  ignore.objs(oHangman);  ignore.blocks(oHangman);  position(oHangman, 71, 59);  stop.cycling(oHangman);  set.priority(oHangman, 7);  [ door to left guardroom  animate.obj(oDoor1);  set.view(oDoor1, vw.SF_Doors1);  set.loop(oDoor1, 6);  set.cel(oDoor1, 0);  ignore.objs(oDoor1);  ignore.blocks(oDoor1);  set.priority(oDoor1, 5);  position(oDoor1, 5, 79);  draw(oDoor1);  stop.update(oDoor1);    [ door to guardroom 2  animate.obj(oDoor2);  set.view(oDoor2, vw.SF_Doors1);  set.loop(oDoor2, 6);  set.cel(oDoor2, 0);  ignore.objs(oDoor2);  ignore.blocks(oDoor2);  set.priority(oDoor2, 5);  position(oDoor2, 103, 84);  draw(oDoor2);  stop.update(oDoor2);    [ guard quarters door  animate.obj(oDoor3);  set.view(oDoor3, vw.SF_Doors1);  set.loop(oDoor3, 6);  set.cel(oDoor3, 0);  ignore.objs(oDoor3);  ignore.blocks(oDoor3);  set.priority(oDoor3, 5);  position(oDoor3, 143, 85);  draw(oDoor3);  stop.update(oDoor3);    [ Jerrod, in normal California attire  animate.obj(ego);  set.view(ego, vw.JerrodCA);  [ adjust position based on previous room  if (previousRoom == rm.SuttersFortSouth)    {    egoDir = STOPPED;    set.loop(ego, 2);    }  if (previousRoom == rm.SF_Admin)    {    egoDir = UP;    set.loop(ego, 3);    }  [ add Jerrod to screen  draw(ego);    [ if Jerrod has a mule  if ((has(LazyMule) || has("James' ol' mule")))    {    [ do mule initialization    call(lgc.Mule);    }      [ now show the picture  show.pic();    [ no need to reset this; AGI does it automatically  reset(newRoom);  }  [ **************************************[ EVERY CYCLE[ **************************************[ if Jerrod is on an alarm line, and not showing window viewif (isset(egoHitSpecial) && !isset(fBehindWindow))  {  [ Jerrod is behind the window in the guards quarters  set(fBehindWindow);  set.view(ego, vw.WindowJerrod);  }  [ if Jerrod is not on alarm line, and is showing[ window viewif (!isset(egoHitSpecial) && isset(fBehindWindow))  {  [ no longer behind window  reset(fBehindWindow);  [ switch back to normal view  set.view(ego, vw.JerrodCA);  }  [ if Jerrod is directly in front of left guard room, and[ priority is not setif (posn(ego, 0, 82, 21, 85) && !isset(fForcePriority))  {  [ force priority to 9 so Jerrod shows up in front of the  [ guard room wall  set(fForcePriority);  set.priority(ego, 9);  }  [ if Jerrod is not directly in front of left guard room, and[ priority is setif (!posn(ego, 0, 82, 21, 85) && isset(fForcePriority))  {  [ restore priority to automatic  reset(fForcePriority);  release.priority(ego);  }  [ if Jerrod is near the left guard room door and door is not[ openif (posn(ego, 5, 70, 15, 81) && !isset(fDoor1Open))  {  [ play door-open sound  sound(s.Effect1, fSoundDone);  [ open the door  start.update(oDoor1);  [ Jerrod is temporarily halted while door opens  stop.update(ego);  end.of.loop(oDoor1, fDoor1Moved);  set(fDoor1Open);  }  [ if not by the left guard room door and the door is openif (!posn(ego, 5, 70, 15, 81) && isset(fDoor1Open))  {  [ close the door  start.update(oDoor1);  reverse.loop(oDoor1, fDoor1Moved);  reset(fDoor1Open);  }  [ when left guard room door finishes movingif (isset(fDoor1Moved))  {  [ door stops moving  stop.update(oDoor1);  [ Jerrod is allowed to move  start.update(ego);  [ reset flag  reset(fDoor1Moved);  [ if door is now closed  if (!isset(fDoor1Open))    {    [ play close-door sound effect    sound(s.Effect2, fSoundDone);    }  }  [ if Jerrod is by right guard room door and door is not openif (posn(ego, 100, 74, 121, 85) && !isset(fDoor2Open))  {  [ play open-door sound  sound(s.Effect1, fSoundDone);  [ open the door  start.update(oDoor2);  [ Jerrod is temporarily halted while door opens  stop.update(ego);  end.of.loop(oDoor2, fDoor2Moved);  set(fDoor2Open);  }  [ if not by the right guard room door and the door is openif (!posn(ego, 100, 74, 121, 85) && isset(fDoor2Open))  {  [ close the door  start.update(oDoor2);  reverse.loop(oDoor2, fDoor2Moved);  reset(fDoor2Open);  }[ when right guard room door finishes movingif (isset(fDoor2Moved))  {  [ door stops  stop.update(oDoor2);  [ Jerrod is allowed to move   start.update(ego);  [ reset flag  reset(fDoor2Moved);  [ if door is now closed  if (!isset(fDoor2Open))    {    [ play close-door sound effect    sound(s.Effect2, fSoundDone);    }  }  [ if Jerrod is by guard quarters door and door is not openif (posn(ego, 122, 75, 152, 87) && !isset(fDoor3Open))  {  [ play open-door sound  sound(s.Effect1, fSoundDone);  [open the door  start.update(oDoor3);  [ Jerrod is temporarily halted while the door opens  stop.update(ego);  end.of.loop(oDoor3, fDoor3Moved);  set(fDoor3Open);  }  [ if not by the guard quarters door and the door is openif (!posn(ego, 122, 75, 152, 87) && isset(fDoor3Open))  {  [ close the door  start.update(oDoor3);  reverse.loop(oDoor3, fDoor3Moved);  reset(fDoor3Open);  }  [ when guard quarters door finishes movingif (isset(fDoor3Moved))  {  [ door stops  stop.update(oDoor3);  [ Jerrod is allowed to move  start.update(ego);  [ reset flag  reset(fDoor3Moved);  [ if door is now closed  if (!isset(fDoor3Open))    {    [ play close-door sound effect    sound(s.Effect2, fSoundDone);    }  }  [ **************************************[ CHECK FOR AN EXIT CONDITION[ **************************************[ blacksmith shop is to the rightif (posn(ego, 152, 89, 152, 96))  {  [ adjust Jerrod's position for new room  position(ego, 2, 97);  new.room(rm.SF_Blacksmith); [ ##LE001##  }[ if closer to bottom, blacksmith shop is still to right,[ but put Jerrod closer to the bottom in new roomif (posn(ego, 152, 97, 152, 167))  {  [ adjust Jerrod's position for new room  vTmpX = 2;  position.v(ego, vTmpX, EgoY);  new.room(rm.SF_Blacksmith); [ ##LE002##  }[ workshops are to leftif (posn(ego, 1, 82, 1, 96))  {  [ adjust Jerrod's position for new room  position(ego, 151, 97);  new.room(rm.SF_Workshops); [ ##LE003##  }[ if closer to bottom, workshops are still to left, but put[ Jerrod closer to the bottom in new roomif (posn(ego, 1, 97, 1, 156))  {  [ adjust Jerrod's position for new room  vTmpX = 151;  position.v(ego, vTmpX, EgoY);  new.room(rm.SF_Workshops); [ ##LE004##  }[ left edge near bottom is the administrative officesif (posn(ego, 1, 157, 1, 167))  {  [ adjust Jerrod's position for new room  position(ego, 151, 111);  new.room(rm.SF_Admin); [ ##LE005##  }[ bottom near left edge also goes to administative officesif (posn(ego, 0, 166, 66, 166))  {  [ adjust Jerrod's position for new room  position(ego, 151, 131);  new.room(rm.SF_Admin); [ ##LE006##  }[ bottom-center to bottom-right goes to administrative[ offices, but puts Jerrod in lower right corner in new roomif (posn(ego, 67, 166, 152, 166))  {  [ adjust Jerrod's position for new room  position(ego, 151, 157);  new.room(rm.SF_Admin); [ ##LE007##  }[ out the gate is Sutters Fort south sceneif (posn(ego, 48, 71, 80, 71))  {  [ adjust Jerrod's position for new room  position(ego, 88, 114);  new.room(rm.SuttersFortSouth); [ ##LE008##  }  [ **************************************[ PROCESS PLAYER INPUT[ **************************************[ if player hasn't provided input no need to do said testsif (!isset(haveInput))  {  goto(Done);  }  [ look around/lookif ((said("examine", "around") || said("examine")))  {  [ response depends on Jerrod's location  if ((posn(ego, 100, 74, 121, 85) ||       posn(ego, 5, 70, 15, 81) ||       posn(ego, 122, 74, 152, 87)))    {    [ near one of the guard shacks    if ((posn(ego, 100, 74, 121, 85) ||         posn(ego, 5, 70, 15, 81)))      {      print("This is just an empty room. The guards watch the gate from here "            "when it's rainin'.");      print("You don't need anything here!");      }    [ near guards quarters    if (posn(ego, 122, 74, 152, 87))      {      print("These are the guards livin' quarters. A quick look at this mess "            "and you've seen enough!");      print("You don't need anything here!");      }    }  else    {    print("Through the south gate ya see the gate to the fort's main corral.");    }  }  [ talk to guardif ((said("speak", "boy") ||     said("speak", "guard") ||     said("speak")))  {  [ if Jerrod is near the lazy guard  if (posn(ego, 87, 87, 159, 124))    {    [ get welcome speech from lazy guard    print.at("The lazy guard takes one look at you and says, \"You look as "             "green as grass, stranger! I imagin' ya just pulled into the fort. "             "Let me give ya a few pointers.\"", 2, 5, 0);    [ interesting little easter egg! a hangman is drawn    [ during the guard's speech, but it's mostly hidden     [ behind the message windows; not sure if it's an     [ intentional easter egg, or a bug (maybe the messages    [ were supposed to be positioned lower so the hangman    [ could be seen)    draw(oHangman);    force.update(oHangman);    print.at("\"Yer welcome to take a tour of the fort, but there are only a "              "few folks still hangin' 'round here.\"", 2, 5, 0);    print.at("\"Most folks have gone to the hills to look fer gold! They "             "hurried off and left their belongin's unattended, but ya ain't "             "gonna find nothin' useful.\"", 2, 5, 0);    erase(oHangman);    force.update(oHangman);    print.at("\"Seems like the only things of any use these days is a gold pan, "             "a shovel, a lantern, and a trusty mule.\"", 2, 5, 0);    }  else    {    print("Yer gonna hafta get a little closer!");    }  }  [ look guardif ((said("examine", "boy") || said("examine", "guard")))  {  [ if near the lazy guard  if (posn(ego, 102, 87, 128, 100))    {    print("If this critter is supposed to be a guard, he's a poor excuse for "          "one!!  It looks like he's nearly asleep!");    }  else    {    print("There's a guard sittin' in a chair by the door.");    }  }  [ look fort/look wallsif ((said("examine", "fort") || said("examine", "wall")))  {  print("This is the famous Sutter's Fort!");  }  [ look ground/look grasif ((said("examine", "dirt") || said("examine", "grass")))  {  print("Sutter's grass is green as can be!");  }  [ look windowif (said("examine", "glass"))  {  print("There's nothin' special 'bout these windows!");  }  [ get gunif (said("acquire", "gun"))  {  print("Not a real bright idea.  If ya tried that, he'd probably have ya "        "strung up!");  }  [ look doorif (said("examine", "door"))  {  print("It's just a normal door!");  }  [ look gateif (said("examine", "gate"))  {  print("As ya look through the open south gate, ya see the gate to the fort's "        "main corral.");  }  [ look outsideif ((said("examine", "outside") ||     said("examine", "out", "side")))  {  print("Ya can see the area to the south through the gate.");  }  [ open gate/close gateif ((said("open", "gate") || said("close", "gate")))  {  print("Ya cain't!  It takes a whole bunch of guards to move those gate doors!");  }  [ look anythingif (said("examine", "anyword"))  {  [ if in the guards quarters  if (posn(ego, 122, 74, 152, 87))    {    print("The guard outside the door don't take kindly to yer snoopin' in his "          "quarters.");    }  else    {    [ reset haveMatch so main logic can handle the input    reset(haveMatch);    }  }  [ look corralif ((said("examine", "corral") ||     said("examine", "fort", "corral") ||     said("examine", "corral", "fort") ||     said("examine", "fort", "main", "corral") ||     said("examine", "main", "corral", "fort")))  {  print("The walls of the fort's main corral are visible through the south "        "gate.");  }  [ use shovel/dig for goldif ((said("use", "shovel") ||     said("dig", "gold") ||     said("dig") ||     said("dig", "hole")))  {  [ if Jerrod has a shovel  if (has("Shovel"))    {    print("Diggin' ain't allowed here!  Do that somewhere else!!");    }  else    {    print("No shovel, no diggin'!");    }  }  [ use pan/pan for goldif ((said("use", "pan") ||     said("pan", "gold") ||     said("pan")))  {  print("Ya needs to be in the water!");  }  [ open doorif (said("open", "door"))  {  print("Just walk up to it!");  }  Done:[ if Jerrod has a muleif ((has(LazyMule) || has("James' ol' mule")))  {  [ call mule logic to handle mule related commands  call(lgc.Mule);  }  return();[ **************************************[ MESSAGES[ **************************************#message 1 "If this critter is supposed to be a guard, he's a poor excuse for one!!  It looks like he's nearly asleep!"#message 2 "Yer gonna hafta get a little closer!"#message 3 "\"Yer welcome to take a tour of the fort, but there are only a few folks still hangin' 'round here.\""#message 4 "There's a guard sittin' in a chair by the door."#message 5 "Through the south gate ya see the gate to the fort's main corral."#message 6 "This is just an empty room. The guards watch the gate from here when it's rainin'."#message 8 "These are the guards livin' quarters. A quick look at this mess and you've seen enough!"#message 9 "This is the famous Sutter's Fort!"#message 10 "Sutter's grass is green as can be!"#message 11 "There's nothin' special 'bout these windows!"#message 12 "Not a real bright idea.  If ya tried that, he'd probably have ya strung up!"#message 13 "It's just a normal door!"#message 14 "As ya look through the open south gate, ya see the gate to the fort's main corral."#message 15 "Ya can see the area to the south through the gate."#message 16 "Ya cain't!  It takes a whole bunch of guards to move those gate doors!"#message 17 "\"Most folks have gone to the hills to look fer gold! They hurried off and left their belongin's unattended, but ya ain't gonna find nothin' useful.\""#message 18 "\"Seems like the only things of any use these days is a gold pan, a shovel, a lantern, and a trusty mule.\""#message 19 "The guard outside the door don't take kindly to yer snoopin' in his quarters."#message 20 "The walls of the fort's main corral are visible through the south gate."#message 21 "You don't need anything here!"#message 22 "The lazy guard takes one look at you and says, \"You look as green as grass, stranger! I imagin' ya just pulled into the fort. Let me give ya a few pointers.\""#message 40 "Diggin' ain't allowed here!  Do that somewhere else!!"#message 41 "No shovel, no diggin'!"#message 42 "Ya needs to be in the water!"#message 43 "Just walk up to it!"