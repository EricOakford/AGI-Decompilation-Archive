[***********************************************************[[ cs.GoldMine[[ This is the final room - the gold mine that Jerrod and [ Jake find after all their searching. After this room is [ shown, the game ends in success![[***********************************************************[ **************************************[ LOCAL DEFINES[ **************************************#define oJake                        o1#define oHat                         o2#define vOverlay                   v220#define vTempVal                   v221#define vTmpY                      v222[ v223 is not used#define vJerrodPhase               v224#define vJakePhase                 v225#define vHatPhase                  v226#define vJerrodTimer               v227#define vJakeTimer                 v228#define vMsgTimer                  v229#define vMsgPhase                  v230#define fJerrodMoved               f220#define fJakeMoved                 f221#define fHatMoved                  f222[ **************************************[ FIRST CYCLE ONLY[ **************************************if (isset(newRoom))  {  [ no more player input; play the win-game cut scene  prevent.input();    [ the GoldRush overlay will be displayed at the end of the  [ game  vOverlay = ovl.GOLDRUSH;    [ load the current room and the overlay  load.pic(currentRoom);  load.pic(vOverlay);    [ load the views used in the room  load.view(vw.WideJerrodCA);  load.view(vw.Jake2D);  load.view(vw.JakeAndJerrod);    [ load the victory music  load.sound(m.Victory);    [draw the current room  draw.pic(currentRoom);    [ add Jake  animate.obj(oJake);  set.view(oJake, vw.Jake2D);  position(oJake, 18, 161);  draw(oJake);  stop.cycling(oJake);    [ Jerrod's hat (don't show it yet)  animate.obj(oHat);  set.view(oHat, vw.JakeAndJerrod);  set.loop(oHat, 8);  position(oHat, 35, 85);  ignore.blocks(oHat);  ignore.objs(oHat);  set.priority(oHat, 8);    [ Jerrod uses the wide version of his California view  animate.obj(ego);  set.view(ego, vw.WideJerrodCA);  set.loop(ego, 3);  position(ego, 12, 160);  ignore.objs(ego);  draw(ego);    [ allow ego object to cycle when not moving  set(CycleAtRest);  [ program control; no player input or control anymore  program.control();  stop.cycling(ego);    [ show the picture  show.pic();  }  [ **************************************[ EVERY CYCLE[ **************************************[ if intro message not shown yetif (vMsgPhase == 0)  {  [ increment sequence counter  ++vMsgPhase;  print.at("For a moment, you and James stand in awe of what you have found. "           "The silence is broken only by echos of the splashing stream winding "           "through the cavern. The light of the lantern reflects a golden "           "glimmer all around you. This must be a dream...", 2, 5, 0);  [ start the timer  vMsgTimer = 1;  }  [ after showing initial messageif (vMsgPhase == 1)  {  [ increment the timer  ++vMsgTimer;  [ after 65 cycles,   if (vMsgTimer == 65)    {    [ reset the timer    vMsgTimer = 0;    ++vMsgPhase;    [ close the message window    close.window();    }  }  [ begin a choreographed sequence showing Jake and Jerrod[ moving around the room; using separate sequencers for[ each, with separate timers, they have to be very carefully[ syncronized so they show up at the right places at the[ right time for the different views to show correctly  [ if Jerrod hasn't started his sequence yetif (vJerrodPhase == 0)  {  [ increment timer  ++vJerrodTimer;  if (vJerrodTimer == 55)    {    [ wait 55 cycles before moving    vJerrodTimer = 0;    ++vJerrodPhase;    }  }  [ after a pause, move Jerrod to first pointif (vJerrodPhase == 1)  {  ++vJerrodPhase;  move.obj(ego, 0, 132, 1, fJerrodMoved);  start.cycling(ego);  vTempVal = 2;  step.time(ego, vTempVal);  cycle.time(ego, vTempVal);  }[ when Jerrod gets to first pointif (isset(fJerrodMoved) && vJerrodPhase == 2)  {  reset(fJerrodMoved);  [ he looks right, then left  ++vJerrodPhase;  [ change to loop with Jerrod looking around  set.view(ego, vw.JakeAndJerrod);  set.loop(ego, 1);  set.cel(ego, 0);  [ cycle slowly while looking  vTempVal = 15;  cycle.time(ego, vTempVal);  stop.motion(ego);  end.of.loop(ego, fJerrodMoved);  }  [ after Jerrod looks right and left,if (isset(fJerrodMoved) && vJerrodPhase == 3)  {  [ increment timer  ++vJerrodTimer;  [ after short delay  if (vJerrodTimer == 15)    {    reset(fJerrodMoved);    [ next phase    ++vJerrodPhase;    vJerrodTimer = 0;    [ change view back, and move Jerrod to next point    set.view(ego, vw.WideJerrodCA);    set.loop(ego, 3);    vTempVal = 2;    step.time(ego, vTempVal);    cycle.time(ego, vTempVal);    move.obj(ego, 12, 120, 1, fJerrodMoved);    start.cycling(ego);    }  }  [ after Jerrod gets to second pointif (isset(fJerrodMoved) && vJerrodPhase == 4)  {  [ Jerrod looks right and left again  reset(fJerrodMoved);  ++vJerrodPhase;  set.view(ego, vw.JakeAndJerrod);  set.loop(ego, 1);  set.cel(ego, 0);  vTempVal = 15;  cycle.time(ego, vTempVal);  stop.motion(ego);  end.of.loop(ego, fJerrodMoved);  }  [ after Jerrod looks left/right a second timeif (isset(fJerrodMoved) && vJerrodPhase == 5)  {  [ wait for 15 cycles  ++vJerrodTimer;  if (vJerrodTimer == 15)    {    [ then move to next point    reset(fJerrodMoved);    ++vJerrodPhase;    vJerrodTimer = 0;    set.view(ego, vw.WideJerrodCA);    set.loop(ego, 3);    vTempVal = 2;    step.time(ego, vTempVal);    cycle.time(ego, vTempVal);    move.obj(ego, 17, 120, 1, fJerrodMoved);    start.cycling(ego);    }  }  [ after Jerrod moves to third pointif (isset(fJerrodMoved) && vJerrodPhase == 6)  {  [ he moves to fourth point  reset(fJerrodMoved);  ++vJerrodPhase;  set.view(ego, vw.WideJerrodCA);  vTempVal = 2;  step.time(ego, vTempVal);  cycle.time(ego, vTempVal);  move.obj(ego, 29, 132, 1, fJerrodMoved);  start.cycling(ego);  }  [ after Jerrod gets to fourth point, if (isset(fJerrodMoved) && vJerrodPhase == 7)  {  [ he stops  reset(fJerrodMoved);  ++vJerrodPhase;  stop.cycling(ego);  stop.motion(ego);  [ Jerrod doesn't get to next phase until after Jake  [ finishes talking  }  [ when Jake finishes talking and jumping up and downif (vJerrodPhase == 10)  {  [ Jerrod throws his hat into the air  ++vJerrodPhase;  [ change view/loop to Jerrod throwing his hat  set.view(ego, vw.JakeAndJerrod);  set.loop(ego, 4);  set.cel(ego, 0);  vTempVal = 1;  step.time(ego, vTempVal);  cycle.time(ego, vTempVal);  start.cycling(ego);  end.of.loop(ego, fJerrodMoved);  }  [ after Jerrod tosses his hatif (isset(fJerrodMoved) && vJerrodPhase == 11)  {  [ Jerrod begins dancing  reset(fJerrodMoved);  ++vJerrodPhase;  [ initiate the hat toss phase  vHatPhase = 1;  set.loop(ego, 7);  [ and moving to fifth point  move.obj(ego, 18, 156, 1, fJerrodMoved);  start.cycling(ego);  }  [ after moving to fifth pointif (isset(fJerrodMoved) && vJerrodPhase == 12)  {  [ Jerrod moves to sixth point  reset(fJerrodMoved);  ++vJerrodPhase;  move.obj(ego, 18, 156, 1, fJerrodMoved);  }[ after moving to sixth pointif (isset(fJerrodMoved) && vJerrodPhase == 13)  {  [ Jerrod moves to seventh point  reset(fJerrodMoved);  ++vJerrodPhase;  move.obj(ego, 1, 133, 1, fJerrodMoved);  }[ after moving to seventh pointif (isset(fJerrodMoved) && vJerrodPhase == 14)  {  [ Jerrod moves to eighth point  reset(fJerrodMoved);  ++vJerrodPhase;  move.obj(ego, 19, 120, 1, fJerrodMoved);  }[ after moving to eighth pointif (isset(fJerrodMoved) && vJerrodPhase == 15)  {  [ Jerrod stops dancing  reset(fJerrodMoved);  ++vJerrodPhase;  [ change back to walking view  set.view(ego, vw.WideJerrodCA);  set.loop(ego, 0);  [ and move to ninth point  move.obj(ego, 24, 131, 1, fJerrodMoved);    [ Jake also stops jumping around   vJakePhase = 20;  }  [ after Jerrod gets to ninth pointif (isset(fJerrodMoved) && vJerrodPhase == 16)  {  [ Jerrod stops (he's done his sequence)  reset(fJerrodMoved);  ++vJerrodPhase;  set.loop(ego, 0);  stop.cycling(ego);  stop.motion(ego);  [ Jake and Jerrod exchange high fives  vJakePhase = 30;  }[ if Jake hasn't started his sequence yetif (vJakePhase == 0)  {  [ increment timer  ++vJakeTimer;  if (vJakeTimer == 35)    {    [ after 35 cycles, move to next phase    vJakeTimer = 0;    ++vJakePhase;    }  }  [ after pause is over,if (vJakePhase == 1)  {  [ move Jake to first point  ++vJakePhase;  move.obj(oJake, 33, 161, 1, fJakeMoved);  start.cycling(oJake);  vTempVal = 2;  step.time(oJake, vTempVal);  cycle.time(oJake, vTempVal);  }  [ when Jake gets to first pointif (isset(fJakeMoved) && vJakePhase == 2)  {  [ move Jake to second point  reset(fJakeMoved);  ++vJakePhase;  move.obj(oJake, 48, 146, 1, fJakeMoved);  }  [ when Jake gets to second pointif (isset(fJakeMoved) && vJakePhase == 3)  {  [ Jake looks around  reset(fJakeMoved);  ++vJakePhase;  [ use the JakeandJerrod view  set.view(oJake, vw.JakeAndJerrod);  set.loop(oJake, 0);  set.cel(oJake, 0);  vTempVal = 15;  cycle.time(oJake, vTempVal);  end.of.loop(oJake, fJakeMoved);  }[ after Jake finishes looking aroundif (isset(fJakeMoved) && vJakePhase == 4)  {  ++vJakeTimer;  if (vJakeTimer == 15)    {    [ Jake moves to third point    reset(fJakeMoved);    ++vJakePhase;    vJakeTimer = 0;    [ restore view of Jake walking    set.view(oJake, vw.Jake2D);    set.loop(oJake, 1);    vTempVal = 2;    step.time(oJake, vTempVal);    cycle.time(oJake, vTempVal);    move.obj(oJake, 63, 138, 1, fJakeMoved);    start.cycling(oJake);    }  }  [ when Jake gets to third pointif (isset(fJakeMoved) && vJakePhase == 5)  {  [ Jake looks around again  reset(fJakeMoved);  ++vJakePhase;  set.view(oJake, vw.JakeAndJerrod);  set.loop(oJake, 0);  set.cel(oJake, 0);  vTempVal = 15;  cycle.time(oJake, vTempVal);  end.of.loop(oJake, fJakeMoved);  }  [ after second time looking aroundif (isset(fJakeMoved) && vJakePhase == 6)  {  ++vJakeTimer;  if (vJakeTimer == 15)    {    [ Jake moves to fourth point    reset(fJakeMoved);    ++vJakePhase;    vJakeTimer = 0;    set.view(oJake, vw.Jake2D);    set.loop(oJake, 1);    vTempVal = 2;    step.time(oJake, vTempVal);    cycle.time(oJake, vTempVal);    move.obj(oJake, 36, 132, 1, fJakeMoved);    start.cycling(oJake);    }  }  [ when Jake gets to fourth pointif (isset(fJakeMoved) && vJakePhase == 7)  {  [ Jake stops moving  reset(fJakeMoved);  ++vJakePhase;  stop.cycling(oJake);  }[ after Jake gets to fourth pointif (vJakePhase == 8)  {  [ increment timer  ++vJakeTimer;  [ after 20 cycles  if (vJakeTimer == 20)    {    [ Jake speaks to Jerrod    ++vJakePhase;    vJakeTimer = 0;    [ use view showing both Jake and Jerrod    set.view(oJake, vw.JakeAndJerrod);    set.loop(oJake, 2);    start.cycling(oJake);    set(leaveWindow);    print.at("\"What we've found here\nisn't fools GOLD!\"", 6, 8, 30);    }  }[ after Jerrod starts speakingif (vJakePhase == 9)  {  [ increment timer  ++vJakeTimer;  [ after 35 cycles of speaking  if (vJakeTimer == 35)    {    [ Jerrod then speaks again    ++vJakePhase;    vJakeTimer = 0;    set(leaveWindow);    print.at("\"This is GOLD!!\"", 6, 8, 0);    }  }  [ after saying 'This is gold!!'if (vJakePhase == 10)  {  [ increment timer  ++vJakeTimer;  [ after 25 cycles of speaking  if (vJakeTimer == 25)    {    [ Jake says the next phrase    ++vJakePhase;    vJakeTimer = 0;    set(leaveWindow);    print.at("\"PURE GOLD!!!\"", 6, 8, 0);    [ set view to Jake, jumping around    set.view(oJake, vw.JakeAndJerrod);    set.loop(oJake, 3);    vTempVal = 1;    step.time(oJake, vTempVal);    cycle.time(oJake, vTempVal);    [ and move to fifth point    move.obj(oJake, 60, 138, 1, fJakeMoved);    start.cycling(oJake);    [ begin the victory music    sound(m.Victory, DoneNoAction);    }  }  [ after Jake begins jumping aroundif (vJakePhase == 11)  {  [ increment timer  ++vJakeTimer;  [ after 25 cycles  if (vJakeTimer == 25)    {    ++vJakePhase;    vJakeTimer = 0;    close.window();    [ Jerrod then continues his sequence    vJerrodPhase = 10;    }  }  [ after Jake reaches fifth pointif (isset(fJakeMoved) && vJakePhase == 12)  {  [ he moves to sixth point  reset(fJakeMoved);  ++vJakePhase;  move.obj(oJake, 52, 138, 1, fJakeMoved);  }  [ after Jake gets to sixth point  if (isset(fJakeMoved) && vJakePhase == 13)  {  [ he moves to seventh point  reset(fJakeMoved);  ++vJakePhase;  move.obj(oJake, 42, 156, 1, fJakeMoved);  }  [ after Jake gets to seventh point  if (isset(fJakeMoved) && vJakePhase == 14)  {  [ he moves to eighth point  reset(fJakeMoved);  ++vJakePhase;  move.obj(oJake, 36, 131, 1, fJakeMoved);  }  [ after Jerrod finishs dancing  if (vJakePhase == 20)  {  [ Jerrod also stops  ++vJakePhase;  set.view(oJake, vw.Jake2D);  set.loop(oJake, 1);  stop.cycling(oJake);  }  [ when Jerrod finishes, Jake begins final sequence[ of the two of them together  if (vJakePhase == 30)  {  ++vJakeTimer;  if (vJakeTimer == 10)    {    vJakeTimer = 0;    ++vJakePhase;    [ use the loop showing Jake and Jerrod giving high fives    set.view(oJake, vw.JakeAndJerrod);    set.loop(oJake, 5);    set.cel(oJake, 0);    [ adjust position so characters appear on screen in same    [ position after changing the view    vTempVal = -1; [ 255;    vTmpY = 1;    reposition(oJake, vTempVal, vTmpY);    [ erase Jerrod from the screen; he's included in the     [ oJake object    erase(ego);    end.of.loop(oJake, fJakeMoved);    [ not sure why points are awarded at end, but whatever...    if (TicketChoice == TKT_COACH)      {      [ coming by stagecoach is worth one point more than      [ coming by boat      currentScore  += 7;      }    else      {      currentScore  += 6;      }    }  }  [ after the high fivesif (isset(fJakeMoved) && vJakePhase == 31)  {  [ Jake and Jerrod face the screen  reset(fJakeMoved);  ++vJakePhase;  set.loop(oJake, 6);  set.cel(oJake, 0);  [ adjust position so the change in loop looks correct  vTempVal = -1; [ 255;  vTmpY = 0;  reposition(oJake, vTempVal, vTmpY);  [ they raise their arms in triumph  end.of.loop(oJake, fJakeMoved);  }  [ after raising their arms if (isset(fJakeMoved) && vJakePhase == 32)  {  [ move to next phase  reset(fJakeMoved);  ++vJakePhase;  [ this is actually uncessary; input was already disabled  [ at the start of the logic, but the programmers added it  [ again here  prevent.input();  }  [ the last phase in the sequenceif (vJakePhase == 33)  {  [ increment timer  ++vJakeTimer;  [ after 12 cycles  if (vJakeTimer == 12)    {    [ game is over!    vJakeTimer = 0;    ++vJakePhase;    print.at("Your courage, commitment and perseverance have made your dream "             "come true; infinitely beyond your highest hopes or aspirations!", 2, 5, 0);    print.at("Thank you for playing...", 4, 7, 0);    [ add the 'GoldRush' overlay    overlay.pic(vOverlay);    show.pic();    [ this adds the $8 million dollar gold value (the one    [ with the error) presumably so player could use the    [ inventory option at end of the game and see how much    [ gold Jerrod and Jake had at the end)    call(lgc.AdjustGold);    }  } [ once Jerrod's hat has been tossed if (vHatPhase == 1)  {  ++vHatPhase;  [ add it as its own object  draw(oHat);  [ begin moving it across the screen  move.obj(oHat, 35, 59, 3, fHatMoved);  }  [ after hat gets to first positionif (isset(fHatMoved) && vHatPhase == 2)  {  [ move it to second position  reset(fHatMoved);  ++vHatPhase;  move.obj(oHat, 25, 51, 3, fHatMoved);  }[ after hat gets to second positionif (isset(fHatMoved) && vHatPhase == 3)  {  [ move it to third position  reset(fHatMoved);  ++vHatPhase;  move.obj(oHat, 17, 59, 3, fHatMoved);  }  [ after hat gets to third positionif (isset(fHatMoved) && vHatPhase == 4)  {  [ move it to final position  reset(fHatMoved);  ++vHatPhase;  move.obj(oHat, 17, 114, 3, fHatMoved);  }  [ after hat gets to last positionif (isset(fHatMoved) && vHatPhase == 5)  {  [ remove it from the screen  reset(fHatMoved);  ++vHatPhase;  erase(oHat);  }  [ this boilerlate code could have been removedif (!isset(haveInput))  {  goto(Done);  }Done:return();[ **************************************[ MESSAGES[ **************************************#message 11 "For a moment, you and James stand in awe of what you have found. The silence is broken only by echos of the splashing stream winding through the cavern. The light of the lantern reflects a golden glimmer all around you. This must be a dream..."#message 22 "\"What we've found here\nisn't fools GOLD!\""#message 23 "\"This is GOLD!!\""#message 24 "\"PURE GOLD!!!\""#message 25 "Your courage, commitment and perseverance have made your dream come true; infinitely beyond your highest hopes or aspirations!"#message 26 "Thank you for playing..."