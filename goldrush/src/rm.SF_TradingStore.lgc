[***********************************************************[[ rm.SF_TradingStore[ [ This room has the trading store, bakery, weaving room and[ cabinet shop. The only room that Jerrod needs to interact [ with is the trading store, where Jerrod can buy a shovel [ and pan for prospecting. To get to the trading store, [ Jerrod needs to enter through the door that is in[ rm.SF_Offices and mvoe to the right.[[***********************************************************[ **************************************[ LOCAL DEFINES[ **************************************#define oDoor1                       o1#define oDoor2                       o2#define oDoor3                       o3#define oWall                        o4#define vTmpY                      v220#define vChatStatus                v221  #define NOT_STARTED           0  [ Jerrod is not talking to store clerk  #define STARTED               1  [ Jerrod has begun a conversation with the clerk  #define WAIT_PAYMENT          2  [ clerk is waiting for Jerrod to confirm payment#define vWallStatus                v222#define vTmpVal                    v223#define fCornerPri                 f220#define fDoor1Moved                f221#define fDoor1Open                 f222#define fDoor2Moved                f223#define fDoor2Open                 f224#define fDoor3Moved                f225#define fDoor3Open                 f226#define fStorePri                  f227#define fSoundDone                 f228#define fBehindWindow              f229#define fBuyShovel                 f230#define fBuyPan                    f231#define fBuyLantern                f232#define fWallGone                  f233#define fBlocked                   f234[ f235 through f237 are not used#define fEffectDone                f238[ **************************************[ FIRST CYCLE ONLY[ **************************************if (isset(newRoom))  {  [ load, draw and discard current room picture  load.pic(currentRoom);  draw.pic(currentRoom);  discard.pic(currentRoom);    [ load mule logic  load.logics(lgc.Mule);    [load views used in the room  load.view(vw.JerrodCA);  load.view(vw.Letter);  load.view(vw.SF_Doors2);  load.view(vw.SuttersFortArt2);  load.view(vw.WindowJerrod);    [ load sounds used in the room  load.sound(m.FoundGold);  load.sound(m.LoseGold);  load.sound(s.Effect1);  load.sound(s.Effect2);    [ add some cabinets in front of the cabinet shop  add.to.pic(vw.SuttersFortArt2, 3, 0, 123, 92, 8, 8);  [ add some detail to the weaving room  add.to.pic(vw.SuttersFortArt2, 3, 1, 81, 68, 6, 6);    [ door to bakery  animate.obj(oDoor1);  set.view(oDoor1, vw.SF_Doors2);  set.loop(oDoor1, 2);  set.cel(oDoor1, 0);  ignore.objs(oDoor1);  ignore.blocks(oDoor1);  set.priority(oDoor1, 7);  position(oDoor1, 52, 85);  draw(oDoor1);  stop.update(oDoor1);    [ door to weaving room  animate.obj(oDoor2);  set.view(oDoor2, vw.SF_Doors2);  set.loop(oDoor2, 3);  set.cel(oDoor2, 0);  ignore.objs(oDoor2);  ignore.blocks(oDoor2);  set.priority(oDoor2, 6);  position(oDoor2, 75, 81);  draw(oDoor2);  stop.update(oDoor2);    [ door to cabinet shop  animate.obj(oDoor3);  set.view(oDoor3, vw.SF_Doors2);  set.loop(oDoor3, 4);  set.cel(oDoor3, 0);  ignore.objs(oDoor3);  ignore.blocks(oDoor3);  set.priority(oDoor3, 6);  position(oDoor3, 137, 83);  draw(oDoor3);  stop.update(oDoor3);    [ Jerrod, with normal California attire  animate.obj(ego);  set.view(ego, vw.JerrodCA);  [ if coming from Sutters Fort-North  if (previousRoom == rm.SuttersFortNorth)    {    [ make sure Jerrod is not moving; he will start inside    [ the cabinet shop    egoDir = STOPPED;    set.loop(ego, 1);    }      [ if coming from offices into the trading store, position  [ Jerrod inside the store, stopped   if (posn(ego, 1, 89, 4, 92))    {    position(ego, 4, 90);    egoDir = STOPPED;    [ initialize wall status so it will dissolve (so Jerrod    [ can be seen inside the trading store)    vWallStatus = 1;    [ force priority while in the store    set.priority(ego, 7);    }      [ add Jerrod to screen  draw(ego);    [ if in or around the store  if (!posn(ego, 0, 76, 46, 107))    {    [ Jerrod needs to observe the conditional line that acts    [ as part of the wall to the store     set(fBlocked);    }      [ if wall needs to be dissolved  if (vWallStatus == 1)    {    [ add store details to background image    add.to.pic(vw.Letter, 1, 1, 0, 80, 6, 6);    [ add store clerk to background image    add.to.pic(vw.Letter, 1, 2, 19, 86, 8, 8);        [ dissolving wall    animate.obj(oWall);    set.view(oWall, vw.Letter);    [ start with wall fully visible    set.loop(oWall, 2);    fix.loop(oWall);    set.cel(oWall, 0);    set.priority(oWall, 8);    ignore.blocks(oWall);    position(oWall, 0, 92);    [ cycle time is as fast as possible    vTmpVal = 1;    cycle.time(oWall, vTmpVal);    draw(oWall);    }  else    {    [ add wall permanently to background image    add.to.pic(vw.Letter, 2, 0, 0, 92, 8, 8);    }      [ if Jerrod has a mule  if ((has(LazyMule) || has("James' ol' mule")))    {    [ do mule initialization stuff    call(lgc.Mule);    }      [ now show the picture  show.pic();    [ not necessary to reset this flag; AGI resets it  [ automatically  reset(newRoom);  }  [ **************************************[ EVERY CYCLE[ **************************************[ if in the trading store, and mule was left behind in[ offices roomif (posn(ego, 1, 89, 4, 92) && isset(LeftMuleUnattended))  {  [ mule is gone now  print("Ya left yer mule outside without tyin' it up. Now yer mule is gone!");  reset(LeftMuleUnattended);  }  [ if Jerrod is in or near the store, and is not observing[ blocksif (posn(ego, 0, 76, 46, 107) && !isset(fBlocked))  {  [ set flag and observe blocks  set(fBlocked);  observe.blocks(ego);  }  [ if Jerrod is not in or near the store and is[ observing blocksif (!posn(ego, 0, 76, 46, 107) && isset(fBlocked))  {  [ Jerrod needs to ignore blocks in rest of room  [ ( so he can go into the corner near the cabinet  [ shop)  reset(fBlocked);  ignore.blocks(ego);  }  [ if wall needs to dissolveif (vWallStatus == 1)  {  [ advance to next stage  vWallStatus = 2;  [ cycle wall so it dissappears  end.of.loop(oWall, fWallGone);  }  [ when wall disappearsif (isset(fWallGone) && vWallStatus == 2)  {  [ reset the flag  reset(fWallGone);  [ advance to next stage (normal stage)  vWallStatus = 3;  }[ if Jerrod goes to edge (leaving the store, going back to[ offices room) while in the normal stateif (posn(ego, 1, 80, 1, 92) && vWallStatus == 3)  {  [ Jerrod stops while the wall is redrawn  stop.motion(ego);  reverse.loop(oWall, fWallGone);  [ advance to next stage  vWallStatus = 4;  }  [ if wall is finished redrawingif (isset(fWallGone) && vWallStatus == 4)  {  [ Jerrod can continue moving  start.motion(ego);  [ position him to appear in correct spot in the offices  [ room  position(ego, 149, 94);  new.room(rm.SF_Offices); [ ##LE001##  }  [ if Jerrod is on a signal line but not marked as behind a[ windowif (isset(egoHitSpecial) && !isset(fBehindWindow))  {  [ Jerrod is now behind a window  set(fBehindWindow);  set.view(ego, vw.WindowJerrod);  }  [ if Jerrod is not on a signal line but is marked as behind[ a windowif (!isset(egoHitSpecial) && isset(fBehindWindow))  {  [ no longer behind a window  reset(fBehindWindow);  [ restore normal view  set.view(ego, vw.JerrodCA);  }  [ if Jerrod is in the corner by the cabinet shopif ((posn(ego, 88, 82, 104, 84) ||     posn(ego, 105, 79, 131, 84) ||     posn(ego, 132, 81, 135, 84)))  {  [ if not forcing priority  if (!isset(fCornerPri))    {    [ need to force priority so Jerrod shows up in front of    [ the walls while in the corner    set(fCornerPri);    set.priority(ego, 8);    }  }  [ if Jerrod is not in the corner by the cabinet shop and[ priority is being forcedif (!posn(ego, 88, 82, 104, 84) &&     !posn(ego, 105, 79, 131, 84) &&     !posn(ego, 132, 81, 135, 84) &&     isset(fCornerPri))  {  [ restore automatic priority assignment  reset(fCornerPri);  release.priority(ego);  }  [ if Jerrod is in the store or in the left side of bakery[ behind the wallif ((posn(ego, 0, 83, 28, 92) ||     posn(ego, 29, 83, 51, 88)))  {  [ if priority is not being forced  if (!isset(fStorePri))    {    [ need to force priority here so Jerrod appears    [ correctly behind the store wall    set(fStorePri);    set.priority(ego, 7);    }  }  [ if Jerrod is not in the store or in the left side of[ bakery behind the wall and priority is forcedif (!posn(ego, 0, 83, 28, 92) &&     !posn(ego, 29, 83, 51, 88) &&     isset(fStorePri))  {  [ restore automatic priority assignment  reset(fStorePri);  release.priority(ego);  }  [ if Jerrod is in or near the door of the bakery and the[ door is not openif (posn(ego, 28, 74, 58, 88) && !isset(fDoor1Open))  {  [ play door-open sound  sound(s.Effect1, fEffectDone);  [ allow door #1 to update  start.update(oDoor1);  [ temporarily halt Jerrod while door #1 opens  stop.update(ego);  [ open door #1  end.of.loop(oDoor1, fDoor1Moved);  set(fDoor1Open);  }  [ if Jerrod is not in or near the door of the bakery and the[ door is openif (!posn(ego, 28, 74, 58, 88) && isset(fDoor1Open))  {  [ allow door #2 to update  start.update(oDoor1);  [ close door #1  reverse.loop(oDoor1, fDoor1Moved);  reset(fDoor1Open);  }  [ if bakery door is done cyclingif (isset(fDoor1Moved))  {  [ stop updating door #1  stop.update(oDoor1);  [ allow Jerrod to continue moving  start.update(ego);  [ reset the movement flag  reset(fDoor1Moved);  [ if door is now closed  if (!isset(fDoor1Open))    {    [ play door-closed sound    sound(s.Effect2, fEffectDone);    }  }  [ if weaving room door is not open and Jerrod is in or near[ the weaving roomif (!isset(fDoor2Open) &&     (posn(ego, 60, 68, 87, 83) ||     posn(ego, 88, 68, 110, 80) ||     posn(ego, 111, 68, 117, 77)))  {  [ play door-open sound  sound(s.Effect1, fEffectDone);  [ allow door #2 to update  start.update(oDoor2);  [ temporarily halt Jerrod while door #2 opens  stop.update(ego);  [ open door #2  end.of.loop(oDoor2, fDoor2Moved);  set(fDoor2Open);  }  [ if the weaving room door is open and Jerrod is not in or[ near the weaving roomif (!posn(ego, 60, 68, 87, 83) &&     !posn(ego, 88, 68, 110, 80) &&     !posn(ego, 111, 68, 117, 77) &&     isset(fDoor2Open))  {  [ allow door #2 to update  start.update(oDoor2);  [ close door #2  reverse.loop(oDoor2, fDoor2Moved);  reset(fDoor2Open);  }  [ if weaving room door is done cyclingif (isset(fDoor2Moved))  {  [ stop updating door #2  stop.update(oDoor2);  [ allow Jerrod to continue moving  start.update(ego);  [ reset the movement flag  reset(fDoor2Moved);  [ if door #2 is now closed  if (!isset(fDoor2Open))    {    [ play door-closed sound    sound(s.Effect2, fEffectDone);    }  }  [ if cabinet shop door is not open and Jerrod is in or near[ the cabinet shopif (!isset(fDoor3Open) &&     (posn(ego, 118, 65, 129, 77) ||     posn(ego, 130, 67, 159, 87)))  {  [ play door-open sound  sound(s.Effect1, fEffectDone);  [ allow door #3 to update  start.update(oDoor3);  [ temporarily halt Jerrod while door #3 opens  stop.update(ego);  [ open door #3  end.of.loop(oDoor3, fDoor3Moved);  set(fDoor3Open);  }[ if cabinet shop door is open and Jerrod is not in or near[ the cabinet shopif (!posn(ego, 118, 65, 129, 77) &&     !posn(ego, 130, 67, 159, 87) &&     isset(fDoor3Open))  {  [ allow door #3 to update  start.update(oDoor3);  [ close door #3  reverse.loop(oDoor3, fDoor3Moved);  reset(fDoor3Open);  }  [ if cabinet shop door is done cyclingif (isset(fDoor3Moved))  {  [ stop updating door #3  stop.update(oDoor3);  [ allow Jerrod to continue moving  start.update(ego);  [ reset the movement flag  reset(fDoor3Moved);  [ if door #3 is now closed  if (!isset(fDoor3Open))    {    [ play door-closed sound    sound(s.Effect2, fEffectDone);    }  }  [ **************************************[ CHECK FOR AN EXIT CONDITION[ **************************************[ the offices room is to the leftif (posn(ego, 1, 97, 1, 166))  {  [ position ego at right edge of offices room  vTmpY = 151;  position.v(ego, vTmpY, EgoY);  [ dismiss any message window that might be present  close.window();  new.room(rm.SF_Offices); [ ##LE002##  }  [ cemetery gate is to the rightif (posn(ego, 152, 96, 152, 166))  {  [ position Jerrod on left edge of cemetery gate room  vTmpY = 2;  position.v(ego, vTmpY, EgoY);  new.room(rm.SF_CemeteryGate); [ ##LE003##  }  [ the cemetery gate room is also belowif (posn(ego, 1, 166, 152, 166))  {  [ position Jerrod at bottom right in the cemetery gate room  position(ego, 2, 140);  [ and change loop and direction  set.loop(ego, 0);  egoDir = RIGHT;  new.room(rm.SF_CemeteryGate); [ ##LE004##  }  [ if going out back door of cabinet shopif ((posn(ego, 152, 69, 152, 78) ||     posn(ego, 140, 68, 153, 69)))  {  [ position Jerrod outside the cabinet shop  position(ego, 38, 88);  set.priority(ego, 9);  new.room(rm.SuttersFortNorth); [ ##LE005##  }  [ **************************************[ PROCESS PLAYER INPUT[ **************************************[ if player hasn't provided input no need to do said testsif (!isset(haveInput))  {  goto(Done);  }  [ look aroundif ((said("examine", "around") ||     said("examine", "shelf") ||     said("examine")))  {  [ response depends on Jerrod's position  if ((posn(ego, 1, 77, 22, 92) ||       posn(ego, 25, 73, 51, 88) ||       posn(ego, 52, 73, 54, 85) ||       posn(ego, 55, 69, 77, 82) ||       posn(ego, 78, 69, 104, 81) ||       posn(ego, 105, 68, 110, 68) ||       posn(ego, 105, 69, 118, 78) ||       posn(ego, 118, 66, 152, 78) ||       posn(ego, 132, 79, 152, 82) ||       posn(ego, 136, 83, 152, 83)))    {    if (posn(ego, 1, 77, 22, 92))      {      print("This is the tradin' store at Sutter's Fort. The shelves are "            "gettin' bare but there's still some good stuff here, like gold "            "pans, shovels, and lanterns. There's also a clerk here.");      }    if ((posn(ego, 25, 73, 51, 88) ||         posn(ego, 52, 73, 54, 85)))      {      print("This is the fort's bakery.");      print("You don't need anything here!");      }    if (posn(ego, 55, 69, 77, 82))      {      print("This is the entryway to the weavin' room.");      print("You don't need anything here!");      }    if ((posn(ego, 78, 69, 104, 81) ||         posn(ego, 105, 68, 110, 68) ||         posn(ego, 105, 69, 118, 78)))      {      print("This is where all the weavin' is done. The room is filled with "            "looms.");      print("You don't need anything here!");      }    if ((posn(ego, 118, 66, 152, 78) ||         posn(ego, 132, 79, 152, 82) ||         posn(ego, 136, 83, 152, 83)))      {      print("This is the cabinet shop. Cabinets of every size and shape are "            "made here!");      print("You don't need anything here!");      }    }  else    {    print("Yer keen eye notices a sign attached to the wall.");    }  }  [ look bakeryif (said("examine", "bakery"))  {  [ if in the bakery  if (posn(ego, 25, 73, 51, 88))    {    print("The bakery is empty. Everyone must be lookin' for gold.");    }  else    {    print("There's a bakery close by.");    }  }  [ look shop (the same said test is entered twice!)if ((said("examine", "shop") || said("examine", "shop")))  {  [ if in the shop  if (posn(ego, 1, 77, 22, 92))    {    print("This is the tradin' store at Sutter's Fort. The shelves are gettin' "          "bare but there's still some good stuff here, like gold pans, "          "shovels, and lanterns. There's also a clerk here.");    }  else    {    print("There's a store close by.");    }  }  [ talk to man/talk to clerkif ((said("speak", "boy") ||     said("speak", "clerk") ||     said("speak", "girl") ||     said("speak")))  {  [ if Jerrod is in the store  if (posn(ego, 1, 77, 22, 92))    {    [ if clerk is waiting for payment    if (vChatStatus == WAIT_PAYMENT)      {      [ tell Jerrod again to give up some gold      print.at("\"Yer gonna hafta give me some gold in one form or another if "               "ya want to take anything outta this store!\"", 2, 10, 28);      }    [ if not waiting for payment    if ((vChatStatus == NOT_STARTED ||         vChatStatus == STARTED))      {      [ clerk greets Jerrod and begins conversation      print.at("The clerk grins and says, \"I can tell by the way ya talk, yer "               "new to these parts!\"", 2, 10, 28);      print.at("\"What can I do for ya?\"", 2, 10, 28);      vChatStatus = STARTED;      }    }  else    {    print("There's no one right here!");    }  }  [ look man/look clerkif ((said("examine", "boy") ||     said("examine", "clerk") ||     said("examine", "girl")))  {  [ if in the store  if (posn(ego, 1, 77, 22, 92))    {    print("There's a clerk standin' in the store.");    }  else    {    print("There's no one right here!");    }  }  [ get shovel/buy shovelif ((said("acquire", "shovel") ||     said("buy", "shovel") ||     said("want", "shovel")))  {  [ if Jerrod has a shovel  if (has("Shovel"))    {    [ if Jerrod is in the store    if (posn(ego, 1, 77, 22, 92))      {      print.at("The clerk, with a puzzled look on his face, says, \"Why? You've "               "already got a shovel.\"", 2, 10, 28);      }    else      {      print("Ya already have a shovel.");      }    }  else    {    [ Jerrod doesn't have a shovel - if Jerrod is in the    [ store    if (posn(ego, 1, 77, 22, 92))      {      [ this if test will always return true; the only      [ values that vChatStatus can be are these three      if ((vChatStatus == NOT_STARTED ||           vChatStatus == STARTED ||           vChatStatus == WAIT_PAYMENT))        {        [ Jerrod is not trying to buy a gold pan or lantern        reset(fBuyPan);        reset(fBuyLantern);        [ Jerrod is trying to buy a shovel        set(fBuyShovel);        print.at("The clerk says, \"I don't know where yer from, sonny, but "                 "shovels ain't free here!\"", 2, 10, 28);        print.at("\"Yer gonna hafta give me some gold in one form or another if "                 "ya want to take anything outta this store!\"", 2, 10, 28);        [ clerk is waiting for gold as payment        vChatStatus = WAIT_PAYMENT;        }      }    else      {      print("There ain't no %w2 right here!");      }    }  }  [ look shovelif (said("examine", "shovel"))  {  [ if Jerrod does not have a shovel  if (!has("Shovel"))    {    [ if Jerrod is in the store    if (posn(ego, 1, 77, 22, 92))      {      print("The shovels are leanin' against the wall.");      }    else      {      print("There ain't no %w2 right here!");      }    }  }[ get gold pan/buy gold panif ((said("acquire", "gold", "pan") ||     said("acquire", "pan") ||     said("buy", "gold", "pan") ||     said("buy", "pan") ||     said("want", "gold", "pan") ||     said("want", "pan")))  {  [ if Jerrod has a gold pan  if (has("Gold pan"))    {    [ if Jerrod is in the store    if (posn(ego, 1, 77, 22, 92))      {      print.at("The clerk says, \"I know yer excited about findin' lots of "               "gold, and it's not that I don't wanna sell ya another pan, but "               "you'll find that one pan is enough!\"", 2, 10, 28);      }    else      {      print("Ya already have a gold pan.");      }    }  else    {    [ Jerrod doesn't have a gold pan - if Jerrod is in the    [ store    if (posn(ego, 1, 77, 22, 92))      {      [ this if test will always return true; the only      [ values that vChatStatus can be are these three      if ((vChatStatus == NOT_STARTED ||           vChatStatus == STARTED ||           vChatStatus == WAIT_PAYMENT))        {        [ Jerrod is not trying to buy a shovel or lantern        reset(fBuyShovel);        reset(fBuyLantern);        [ Jerrod is trying to buy a gold pan        set(fBuyPan);        print.at("The clerk looks at the shelves, then says, \"There are a few "                 "pans left but I'm not givin' 'em away!\"", 2, 10, 28);        print.at("\"Yer gonna hafta give me some gold in one form or another if "                 "ya want to take anything outta this store!\"", 2, 10, 28);        [ clerk is waiting for gold payment        vChatStatus = WAIT_PAYMENT;        }      }    else      {      print("There's no gold pan right here.");      }    }  }  [ look gold panif ((said("examine", "gold", "pan") || said("examine", "pan")))  {  [ if Jerrod doesn't have a gold pan  if (!has("Gold pan"))    {    [ if Jerrod is in the store    if (posn(ego, 1, 77, 22, 92))      {      print("There are still some gold pans on the shelf!");      }    else      {      print("There's no gold pan right here.");      }    }  }  [ get lantern/buy lanternif ((said("acquire", "lantern") ||     said("buy", "lantern") ||     said("want", "lantern")))  {  [ if Jerrod has a lantern  if (has("Lantern"))    {    [ if Jerrod is in the store    if (posn(ego, 1, 77, 22, 92))      {      print.at("The clerk says, \"No, no, sonny. You'll just overload yer self "               "carryin' more than one lantern 'round. Believe me!\"", 2, 10, 28);      }    else      {      print("Ya already got a lantern.");      }    }  else    {    [ Jerrod doesn't have a lantern - if Jerrod is in the    [ store    if (posn(ego, 1, 77, 22, 92))      {      [ this if test will always return true; the only      [ values that vChatStatus can be are these three      if ((vChatStatus == NOT_STARTED ||           vChatStatus == STARTED ||           vChatStatus == WAIT_PAYMENT))        {        [ Jerrod is not trying to buy a shovel or gold pan        reset(fBuyShovel);        reset(fBuyPan);        [ Jerrod is trying to buy a lantern        set(fBuyLantern);        print.at("The clerk exclaims, \"I'm not in this business fer my health, "                 "and lanterns are gettin' scarce!\"", 2, 10, 28);        print.at("\"Yer gonna hafta give me some gold in one form or another if "                 "ya want to take anything outta this store!\"", 2, 10, 28);        [ clerk is waiting for gold payment        vChatStatus = WAIT_PAYMENT;        }      }    else      {      print("There ain't no %w2 right here!");      }    }  }  [ look lanternif ((said("examine", "lantern") || said("examine", "lamp")))  {  [ if Jerrod doesn't have a lantern  if (!has("Lantern"))    {    [ if Jerrod is in the store    if (posn(ego, 1, 77, 22, 92))      {      print("There are just a few lanterns left!");      }    else      {      print("There ain't no %w2 right here!");      }    }  }  [ look loomif (said("examine", "loom"))  {  [ if Jerrod is in the weaving rooom  if ((posn(ego, 78, 69, 104, 81) ||       posn(ego, 105, 68, 110, 68) ||       posn(ego, 105, 69, 118, 78)))    {    print("The looms are filled with partially woven cloth.");    }  else    {    print("There ain't no loom right here!");    }  }  [ open doorif (said("open", "door"))  {  print("Just walk  up to it.");  }  [ use shovel/dig for goldif ((said("use", "shovel") ||     said("dig", "gold") ||     said("dig") ||     said("dig", "hole")))  {  [ if Jerrod has a shovel  if (has("Shovel"))    {    print("Diggin' ain't allowed here! Do that somewhere else!!");    }  else    {    print("No shovel, no diggin'!");    }  }  [ use pan/pan for goldif ((said("use", "pan") ||     said("pan", "gold") ||     said("pan")))  {  print("Ya need to be in the water!");  }  [ look ground/look grassif ((said("examine", "dirt") ||     said("examine", "grass")))  {  print("The grass is kept short by all the animals!");  }  [ look doorif (said("examine", "door"))  {  print("Nothin' special 'bout these doors.");  }  [ pay/pay man/pay clerkif ((said("pay") ||     said("pay", "boy") ||     said("pay", "clerk")))  {  print("Ya need to be a little more specific.");  }  [ pay with gold disk if ((said("use", "gold", "disk") ||     said("use", "disk") ||     said("contribute", "gold", "disk") ||     said("contribute", "disk") ||     said("pay", "gold", "disk") ||     said("pay", "disk") ||     said("contribute", "anyword", "disk") ||     said("contribute", "disk", "anyword") ||     said("contribute", "anyword", "gold", "disk") ||     said("contribute", "gold", "disk", "anyword") ||     said("pay", "anyword", "disk") ||     said("pay", "disk", "anyword") ||     said("pay", "anyword", "gold", "disk") ||     said("pay", "gold", "disk", "anyword")))  {  [ if Jerrod is in the store  if (posn(ego, 1, 77, 22, 92))    {    [ if Jerrod has the gold disk    if (has("Gold disk"))      {      [ if not waiting for payment      if ((vChatStatus == NOT_STARTED ||           vChatStatus == STARTED))        {        print.at("The clerk's eyes open wide. After a moment of silence, the "                 "clerk says, \"I've never seen anything like that before! Hang "                 "onto it fer just a second!\"", 2, 10, 28);        print.at("\"What can I do for ya?\"", 2, 10, 28);        [ conversation has started        vChatStatus = STARTED;        }            [ if clekrk is waiting for payment      if (vChatStatus == WAIT_PAYMENT)        {        [ reset conversation status        vChatStatus = STARTED;        [ play lose points sound        sound(m.LoseGold, fSoundDone);        [ lose the gold disk        drop("Gold disk");        print.at("The clerk stands in a state of stupor as you hand over the "                 "gold disk. Finally the clerk says, \"It's a pleasure doin' "                 "business with ya!\"", 2, 10, 28);        [ lose two points        currentScore -= 2;                [ if buying a shovel        if (isset(fBuyShovel))          {          [ complete the sale          reset(fBuyShovel);          print.at("\"Here's yer shovel. Don't break it, it's priceless!\"", 2, 10, 28);          [ get the shovel          get("Shovel");          }                  [ if buying a gold pan        if (isset(fBuyPan))          {          [ complete the sale          reset(fBuyPan);          print.at("\"Here's yer gold pan. Yer always welcome here!\"", 2, 10, 28);          [ get the pan          get("Gold pan");          }                  [ buy lantern        if (isset(fBuyLantern))          {          [ complete the sale          reset(fBuyLantern);          print.at("\"Here's yer lantern. Don't drop it, its priceless!\"", 2, 10, 28);          [ get the lantern          get("Lantern");          }        }      }    else      {      print.at("The clerk says, \"Sonny, you don't have a gold disk!\"", 2, 10, 28);      }    }  else    {    print("There's no one right here!");    }  }  [ pay with gold coinif ((said("use", "coin") ||     said("use", "gold", "coin") ||     said("contribute", "coin") ||     said("contribute", "gold", "coin") ||     said("contribute", "boy", "coin") ||     said("contribute", "coin", "boy") ||     said("contribute", "anyword", "coin") ||     said("contribute", "coin", "anyword") ||     said("contribute", "anyword", "gold", "coin") ||     said("contribute", "gold", "coin", "anyword") ||     said("pay", "coin") ||     said("pay", "gold", "coin") ||     said("pay", "anyword", "coin") ||     said("pay", "coin", "anyword") ||     said("pay", "anyword", "gold", "coin") ||     said("pay", "gold", "coin", "anyword")))  {  [ if Jerrod is in the store  if (posn(ego, 1, 77, 22, 92))    {    [ if Jerrod has the gold coin    if (has("Gold coin"))      {      [ if not waiting for payment      if ((vChatStatus == NOT_STARTED ||           vChatStatus == STARTED))        {        print.at("The clerk says, \"That's a nice gold coin, but hang on to it "                 "fer just a second.\"", 2, 10, 28);        print.at("\"What can I do for ya?\"", 2, 10, 28);        [ conversation has started        vChatStatus = STARTED;        }            [ if waiting for payment      if (vChatStatus == WAIT_PAYMENT)        {        [ reset conversation status        vChatStatus = STARTED;        [ play score sound        sound(m.FoundGold, fSoundDone);        [ lose the gold coin        drop("Gold coin");        [ gain a point        currentScore  += 1;                [ if buying shovel        if (isset(fBuyShovel))          {          [ complete the sale          reset(fBuyShovel);          print.at("The clerk says, \"That's a fair deal. A gold coin fer a "                   "shovel.  Here's yer shovel.\"", 2, 10, 28);          [ get the shovel          get("Shovel");          }        if (isset(fBuyPan))          {          [ complete the sale          reset(fBuyPan);          print.at("The clerk says, \"Okay, I'll take that gold coin and here's "                   "yer gold pan. I wish ya the best of luck!\"", 2, 10, 28);          [ get the gold pan          get("Gold pan");          }        if (isset(fBuyLantern))          {          [ complete the sale          reset(fBuyLantern);          print.at("The clerk says, \"Here's yer lantern. Thanks fer doin' yer "                   "business here and welcome to California!\"", 2, 10, 28);          [ get the lantern          get("Lantern");          }        }      }    else      {      print.at("The clerk says, \"Ya don't have a gold coin!\"", 2, 10, 28);      }    }  else    {    print("There's no one right here!");    }  }  [ pay with gold flakeif ((said("use", "flake") ||     said("use", "gold", "flake") ||     said("contribute", "flake") ||     said("contribute", "gold", "flake") ||     said("contribute", "anyword", "flake") ||     said("contribute", "anyword", "gold", "flake") ||     said("contribute", "flake", "anyword") ||     said("contribute", "gold", "flake", "anyword") ||     said("pay", "flake") ||     said("contribute", "gold", "flake") ||     said("pay", "anyword", "flake") ||     said("pay", "anyword", "gold", "flake") ||     said("pay", "flake", "anyword") ||     said("pay", "gold", "flake", "anyword")))  {  [ if in the store  if (posn(ego, 1, 77, 22, 92))    {    [ if Jerrod has the gold flake    if (has("Gold flake"))      {      [ this if test will always return true; the only      [ values that vChatStatus can be are these three      if ((vChatStatus == NOT_STARTED ||           vChatStatus == STARTED ||           vChatStatus == WAIT_PAYMENT))        {        print.at("The clerk chuckles and says, \"I see yer fresh on the "                 "frontier! A gold flake like that will get ya nothin'. Perhaps "                 "ya have somethin' else?\"", 2, 10, 28);        }      }    else      {      print.at("The clerk says, \"Ya don't have a gold flake. Even if ya did "               "it's not enough gold to get anything anywhere.\"", 2, 10, 28);      }    }  else    {    print("There's no one right here!");    }  }  [ thank youif ((said("thank", "you") ||     said("thank") ||     said("thank", "boy")))  {  print("Yer Welcome!");  }  [ look cabinetif (said("examine", "cabinet"))  {  [ (there should be a location test for this otherwise it  [ won't make sense when Jerrod is not by the cabinet shop)  print("These are mighty fine cabinets!");  }  [ open cabinetif (said("open", "cabinet"))  {  print("The cabinet's empty!");  }  [ get cabinetif ((said("acquire", "cabinet") ||     said("buy", "cabinet") ||     said("want", "cabinet")))  {  print("Ya came to California fer gold, not fer cabinets!!");  }  [ look sign/ look wallif ((said("examine", "sign", "rol") ||     said("examine", "anyword", "sign", "rol") ||     said("examine", "note", "rol") ||     said("examine", "anyword", "note", "rol") ||     said("examine", "billboard", "rol") ||     said("examine", "anyword", "billboard", "rol") ||     said("sign") ||     said("beam", "sign") ||     said("sign", "wall") ||     said("examine", "fort")))  {  [ there should be a location test; if Jerrod is in one of  [ the shops/rooms, he can't see the sign  print("There's a wooden sign hangin' on the wall.");  }  [ look wallif (said("examine", "wall"))  {  [ if in one of the rooms  if ((posn(ego, 1, 77, 22, 92) ||       posn(ego, 25, 73, 51, 88) ||       posn(ego, 52, 73, 54, 85) ||       posn(ego, 55, 69, 77, 82) ||       posn(ego, 78, 69, 104, 81) ||       posn(ego, 105, 68, 110, 68) ||       posn(ego, 105, 69, 118, 78) ||       posn(ego, 118, 66, 152, 78) ||       posn(ego, 132, 79, 152, 82) ||       posn(ego, 136, 83, 152, 83)))    {    [ if in the shop    if (posn(ego, 1, 77, 22, 92))      {      print("There are shovels leanin' against the wall.");      }    else      {      [ for all other locations, reset the match flag so      [ main logic can handle the input      reset(haveMatch);      }    }  else    {    [ if anywhere else    print("There's a wooden sign hangin' on the wall.");    }  }  [ read signif ((said("read", "sign", "rol") ||     said("read", "anyword", "sign", "rol") ||     said("read", "note", "rol") ||     said("read", "anyword", "note", "rol") ||     said("read", "billboard", "rol") ||     said("read", "anyword", "billboard", "rol")))  {  [ if Jerrod is near the sign  if ((posn(ego, 0, 92, 57, 125) ||       posn(ego, 36, 87, 57, 91)))    {    [ sign uses '-','\','/' and '<' to create an arrow     print("\n\n  TRADIN' STORE  \n\n\n    /\n   <---------\n    \\\\\n");    }  else    {    print("Ya cain't read the sign from here.");    }  }  [ look in window/look windowif ((said("examine", "in", "glass") ||     said("examine", "glass")))  {  [ if near any window  if ((posn(ego, 0, 20, 19, 120) ||       posn(ego, 20, 20, 159, 120)))    {    [ if near the store window    if (posn(ego, 0, 20, 19, 120))      {      print("Through the window ya see some sort of store.");      }    else      {      [ any other window      print("Ya see nothin' important from here.");      }    }  else    {    [ not by a window    print("From here, ya cain't see through a window.");    }  }  [ anything about moneyif ((said("anyword", "bucks") ||     said("anyword", "anyword", "bucks") ||     said("anyword", "bucks", "anyword") ||     said("bucks", "anyword", "anyword")))  {  print("Ya don't have any money.");  }  [ pay with goldif ((said("use", "gold") ||     said("pay") ||     said("pay", "gold") ||     said("pay", "boy") ||     said("pay", "anyword", "gold") ||     said("pay", "gold", "anyword") ||     said("contribute", "gold") ||     said("contribute", "anyword", "gold") ||     said("contribute", "gold", "anyword")))  {  [ if Jerrod is in the store  if (posn(ego, 1, 77, 22, 92))    {    [ if Jerrod has enough gold    if (GoldIndex > 59)      {      [ if not waiting for payment      if ((vChatStatus == NOT_STARTED ||           vChatStatus == STARTED))        {        print.at("The clerk says, \"Yer mighty eager to get rid of that gold! "                 "Slow down just a tad.\"", 2, 10, 28);        print.at("\"What can I do for ya?\"", 2, 10, 28);        [ conversation has started        vChatStatus = STARTED;        }            [ if clerk is waiting for payment      if (vChatStatus == WAIT_PAYMENT)        {        [ reset conversation status        vChatStatus = STARTED;        [ lose one step of gold        --GoldIndex;        call(lgc.AdjustGold);        [ play score sound        sound(m.FoundGold, fSoundDone);        [ score one point        currentScore  += 1;                [ if buying a shovel        if (isset(fBuyShovel))          {          [ complete the sale          reset(fBuyShovel);          print.at("The clerk says, \"Alright, I'll take some of that "                   "California gold you've found and give ya this shovel. We "                   "both know everyone needs a shovel!\"", 2, 10, 28);          [ get the shovel          get("Shovel");          }                [ if buying a gold pan        if (isset(fBuyPan))          {          [ complete the sale          reset(fBuyPan);          print.at("The clerk says, \"I'll just take some of that California "                   "gold that you've found and give ya this gold pan.\"", 2, 10, 28);          [ get the gold pan          get("Gold pan");          }                  [ if buying a lantern        if (isset(fBuyLantern))          {          [ complete the sale          reset(fBuyLantern);          print.at("The clerk says, \"This fine lantern is all yers. I'll take "                   "some of that California gold you've got.\"", 2, 10, 28);          [ get the lantern          get("Lantern");          }        }      }    else      {      print.at("The clerk says, \"Ya haven't found enough California gold to "               "get anythin' here. I'll take any form of gold.\"", 2, 10, 28);      }    }  else    {    print("There's no one right here!");    }  }  [ if in the store, and trying to buy anything elseif (posn(ego, 1, 77, 22, 92) &&     (said("acquire", "rol") ||     said("buy", "rol") ||     said("want", "rol")))  {  print.at("The clerk says, \"My stock is runnin' low. I don't have that.\"", 2, 10, 28);  }  Done:[ if Jerrod has a muleif ((has(LazyMule) || has("James' ol' mule")))  {  [ call mule logic to handle mule related commands  call(lgc.Mule);  }  return();[ **************************************[ MESSAGES[ **************************************#message 1 "This is the tradin' store at Sutter's Fort. The shelves are gettin' bare but there's still some good stuff here, like gold pans, shovels, and lanterns. There's also a clerk here."#message 2 "This is the fort's bakery."#message 3 "This is the entryway to the weavin' room."#message 4 "This is where all the weavin' is done. The room is filled with looms."#message 5 "This is the cabinet shop. Cabinets of every size and shape are made here!"#message 6 "Yer keen eye notices a sign attached to the wall."#message 7 "\"What can I do for ya?\""#message 9 "There's no one right here!"#message 10 "Ya already got a lantern."#message 11 "The clerk says, \"Alright, I'll take some of that California gold you've found and give ya this shovel. We both know everyone needs a shovel!\""#message 14 "The clerk stands in a state of stupor as you hand over the gold disk. Finally the clerk says, \"It's a pleasure doin' business with ya!\""#message 15 "There ain't no %w2 right here!"#message 20 "There's no gold pan right here."#message 21 "The looms are filled with partially woven cloth."#message 22 "There ain't no loom right here!"#message 23 "There are still some gold pans on the shelf!"#message 24 "There are just a few lanterns left!"#message 25 "The shovels are leanin' against the wall."#message 26 "There's a clerk standin' in the store."#message 27 "What do ya want to do with that?"#message 28 "Just walk  up to it."#message 29 "These are mighty fine cabinets!"#message 30 "The cabinet's empty!"#message 31 "Ya came to California fer gold, not fer cabinets!!"#message 34 "There's a wooden sign hangin' on the wall."#message 35 "\n\n  TRADIN' STORE  \n\n\n    /\n   <---------\n    \\\\\n"#message 37 "Ya cain't read the sign from here."#message 38 "There's a store close by."#message 40 "Diggin' ain't allowed here! Do that somewhere else!!"#message 41 "No shovel, no diggin'!"#message 42 "Ya need to be in the water!"#message 43 "Ya need to be a little more specific."#message 45 "From here, ya cain't see through a window."#message 46 "Ya see nothin' important from here."#message 47 "Through the window ya see some sort of store."#message 48 "The clerk says, \"I don't know where yer from, sonny, but shovels ain't free here!\""#message 49 "\"Yer gonna hafta give me some gold in one form or another if ya want to take anything outta this store!\""#message 51 "The clerk says, \"Yer mighty eager to get rid of that gold! Slow down just a tad.\""#message 52 "The clerk grins and says, \"I can tell by the way ya talk, yer new to these parts!\""#message 53 "The clerk says, \"Ya haven't found enough California gold to get anythin' here. I'll take any form of gold.\""#message 54 "The clerk, with a puzzled look on his face, says, \"Why? You've already got a shovel.\""#message 55 "The clerk looks at the shelves, then says, \"There are a few pans left but I'm not givin' 'em away!\""#message 56 "The clerk exclaims, \"I'm not in this business fer my health, and lanterns are gettin' scarce!\""#message 57 "Ya already have a shovel."#message 58 "Ya already have a gold pan."#message 59 "The clerk says, \"I know yer excited about findin' lots of gold, and it's not that I don't wanna sell ya another pan, but you'll find that one pan is enough!\""#message 60 "The clerk says, \"No, no, sonny. You'll just overload yer self carryin' more than one lantern 'round. Believe me!\""#message 63 "The grass is kept short by all the animals!"#message 64 "Nothin' special 'bout these doors."#message 65 "The clerk says, \"I'll just take some of that California gold that you've found and give ya this gold pan.\""#message 66 "The clerk says, \"This fine lantern is all yers. I'll take some of that California gold you've got.\""#message 67 "The clerk's eyes open wide. After a moment of silence, the clerk says, \"I've never seen anything like that before! Hang onto it fer just a second!\""#message 68 "\"Here's yer shovel. Don't break it, it's priceless!\""#message 69 "\"Here's yer gold pan. Yer always welcome here!\""#message 70 "Yer Welcome!"#message 71 "\"Here's yer lantern. Don't drop it, its priceless!\""#message 72 "The clerk says, \"That's a nice gold coin, but hang on to it fer just a second.\""#message 73 "The clerk says, \"Sonny, you don't have a gold disk!\""#message 74 "You don't need anything here!"#message 75 "The clerk says, \"That's a fair deal. A gold coin fer a shovel.  Here's yer shovel.\""#message 76 "The clerk says, \"Okay, I'll take that gold coin and here's yer gold pan. I wish ya the best of luck!\""#message 77 "The clerk says, \"Here's yer lantern. Thanks fer doin' yer business here and welcome to California!\""#message 78 "The clerk says, \"Ya don't have a gold coin!\""#message 79 "The clerk says, \"Ya don't have a gold flake. Even if ya did it's not enough gold to get anything anywhere.\""#message 80 "The clerk chuckles and says, \"I see yer fresh on the frontier! A gold flake like that will get ya nothin'. Perhaps ya have somethin' else?\""#message 81 "There are shovels leanin' against the wall."#message 82 "Ya don't have any money."#message 83 "Ya left yer mule outside without tyin' it up. Now yer mule is gone!"#message 84 "The bakery is empty. Everyone must be lookin' for gold."#message 85 "There's a bakery close by."#message 86 "The clerk says, \"My stock is runnin' low. I don't have that.\""