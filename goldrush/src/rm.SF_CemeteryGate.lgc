[***********************************************************[[ rm.SF_CemeteryGate[ [ The main feature in this room is the gate leading to the [ cemetery. There is also another bunkroom and a lumber[ room. There is nothing for Jerrod to do here.[[***********************************************************[ **************************************[ LOCAL DEFINES[ **************************************#define oDoor1                       o1#define oDoor2                       o2#define vTmpX                      v220#define fForcePriority             f220#define fDoor1Moved                f221#define fDoor1Open                 f222#define fDoor2Moved                f223#define fDoor2Open                 f224[ f225 and f226 are not used#define fBehindWindow              f227[ f228 through f237 are not used#define fEffectDone                f238[ **************************************[ FIRST CYCLE ONLY[ **************************************if (isset(newRoom))  {  [ load mule logic  load.logics(lgc.Mule);    [ load picture for current room  load.pic(currentRoom);    [ load views used in the room  load.view(vw.JerrodCA);  load.view(vw.SF_Doors2);  load.view(vw.SuttersFortArt2);  load.view(vw.WindowJerrod);    [ load sounds used in the room  load.sound(s.Effect1);  load.sound(s.Effect2);    [ draw the current room picture  draw.pic(currentRoom);    [ add bunks visible in bunkroom  add.to.pic(vw.SuttersFortArt2, 2, 0, 77, 71, 5, 5);    [ door to bunkroom  animate.obj(oDoor1);  set.view(oDoor1, vw.SF_Doors2);  set.loop(oDoor1, 0);  set.cel(oDoor1, 0);  ignore.objs(oDoor1);  ignore.blocks(oDoor1);  set.priority(oDoor1, 7);  position(oDoor1, 77, 81);  draw(oDoor1);  stop.update(oDoor1);    [ door to lumber room  animate.obj(oDoor2);  set.view(oDoor2, vw.SF_Doors2);  set.loop(oDoor2, 1);  set.cel(oDoor2, 0);  ignore.objs(oDoor2);  ignore.blocks(oDoor2);  set.priority(oDoor2, 7);  position(oDoor2, 116, 80);  draw(oDoor2);  stop.update(oDoor2);    [ Jerrod, with normal California attire  animate.obj(ego);  set.view(ego, vw.JerrodCA);  [ if coming from Sutter's Fort-North  if (previousRoom == rm.SuttersFortNorth)    {    [ change direction and loop    egoDir = STOPPED;    set.loop(ego, 2);    }  [ Jerrod ignores conditional lines (they are needed to  [ keep mule from getting stuck in corner)  ignore.blocks(ego);  draw(ego);    [ if Jerrod has a mule  if ((has(LazyMule) || has("James' ol' mule")))    {    [ do mule initialization stuff    call(lgc.Mule);    }    [ now show the picture  show.pic();    [ not necessary to reset this flag; AGI resets it   [ automatically  reset(newRoom);  }  [ **************************************[ EVERY CYCLE[ **************************************[ if Jerrod is on an alarm line and not marked as behind a[ windowif (isset(egoHitSpecial) && !isset(fBehindWindow))  {  [ show Jerrod behind window  set(fBehindWindow);  set.view(ego, vw.WindowJerrod);  }  [ if Jerrod is not on an alarm line but is marked as behind[ a windowif (!isset(egoHitSpecial) && isset(fBehindWindow))  {  [ no longer behind window  reset(fBehindWindow);  [ restore normal view  set.view(ego, vw.JerrodCA);  }  [ if directly in front of bunkroom, by the corner and[ priority is not forcedif (posn(ego, 77, 80, 116, 84) && !isset(fForcePriority))  {  [ the shape of the corner creates a zone where the auto  [ priority won't work, so force priority when Jerrod is in  [ this zone  set(fForcePriority);  set.priority(ego, 8);  }  [ if not in the priority zone, and priority is forcedif (!posn(ego, 77, 80, 116, 84) && isset(fForcePriority))  {  [ restore automatic priority assignment  reset(fForcePriority);  release.priority(ego);  }  [ if in the bunkroom or by the bunkroom door and door is not[ openif (!isset(fDoor1Open) &&     (posn(ego, 58, 65, 68, 80) ||     posn(ego, 69, 71, 87, 83) ||     posn(ego, 88, 65, 106, 78)))  {  [ play door-open sound  sound(s.Effect1, fEffectDone);  [ allow door #1 to  update  start.update(oDoor1);  [ temporarily halt Jerrod while door #1 opens  stop.update(ego);  [ open door #1  end.of.loop(oDoor1, fDoor1Moved);  set(fDoor1Open);  }  [ if not in bunkroom or by bunkroom door and door is openif (!posn(ego, 58, 65, 68, 80) &&     !posn(ego, 69, 71, 87, 83) &&     !posn(ego, 88, 65, 106, 78) &&     isset(fDoor1Open))  {  [ allow door #1 to update  start.update(oDoor1);  [ close it  reverse.loop(oDoor1, fDoor1Moved);  reset(fDoor1Open);  }  [ if door #1 is done cyclingif (isset(fDoor1Moved))  {  [ stop updating door #1  stop.update(oDoor1);  [ allow Jerrod to continue moving  start.update(ego);  [ reset movement flag  reset(fDoor1Moved);  [ if door is now closed  if (!isset(fDoor1Open))    {    [ play door-closed sound    sound(s.Effect2, fEffectDone);    }  }  [ if Jerrod is in or by door to lumber room and door is not[ openif (posn(ego, 107, 65, 159, 83) && !isset(fDoor2Open))  {  [ play door-open sound  sound(s.Effect1, fEffectDone);  [ allow door #2 to update  start.update(oDoor2);  [ temporarily halt Jerrod while door #2 opens  stop.update(ego);  [ open door #2  end.of.loop(oDoor2, fDoor2Moved);  set(fDoor2Open);  }  [ if Jerrod is not in or by door to lumber room and door is[ openif (!posn(ego, 107, 65, 159, 83) && isset(fDoor2Open))  {  [ allow door #2 to update  start.update(oDoor2);  [ close it  reverse.loop(oDoor2, fDoor2Moved);  reset(fDoor2Open);  }  [ if door #2 is done cyclingif (isset(fDoor2Moved))  {  [ stop updating door #2  stop.update(oDoor2);  [ allow Jerrod to continue moving  start.update(ego);  [ reset movement flag  reset(fDoor2Moved);  [ if door #2 is now closed  if (!isset(fDoor2Open))    {    [ play door-closed sound    sound(s.Effect2, fEffectDone);    }  }  [ **************************************[ CHECK FOR AN EXIT CONDITION[ **************************************[ the trading store is to the leftif (posn(ego, 1, 96, 1, 166))  {  [ position Jerrod on right side of trading store room  vTmpX = 151;  position.v(ego, vTmpX, EgoY);  new.room(rm.SF_TradingStore); [ ##LE001##  }  [ workshops are to the rightif (posn(ego, 152, 97, 152, 166))  {  [ position Jerrod on left side of workshop room  vTmpX = 2;  position.v(ego, vTmpX, EgoY);  new.room(rm.SF_Workshops); [ ##LE002##  }  [ going down leads to the officesif (posn(ego, 1, 166, 152, 166))  {  [ position Jerrod in middle of the offices room  position(ego, 76, 165);  [ moving up  set.loop(ego, 3);  egoDir = UP;  new.room(rm.SF_Offices); [ ##LE003##  }  [ the gate leads to the cemeteryif (posn(ego, 15, 68, 35, 68))  {  [ position Jerrod just left of center  position(ego, 61, 159);  [ moving up  set.loop(ego, 3);  egoDir = UP;  new.room(rm.SutterCemetery); [ ##LE004##  }  [ **************************************[ PROCESS PLAYER INPUT[ **************************************[ if player hasn't provided input no need to do said testsif (!isset(haveInput))  {  goto(Done);  }  [ look around/lookif ((said("examine", "around") || said("examine")))  {  [ response depends on Jerrod's location  if ((posn(ego, 58, 69, 101, 80) ||       posn(ego, 102, 68, 121, 79) ||       posn(ego, 116, 80, 121, 80) ||       posn(ego, 122, 68, 152, 83)))    {    if (posn(ego, 58, 69, 101, 80))      {      print("This room is filled with bunks. Many weary workers have slept "            "here.");      print("You don't need anything here!");      }    if ((posn(ego, 102, 68, 121, 79) ||         posn(ego, 116, 80, 121, 80)))      {      print("Yer in the entryway 'tween a couple of rooms. To yer left is a "            "bunk room, to yer right is the lumber room.");      print("You don't need anything here!");      }    if (posn(ego, 122, 68, 152, 83))      {      print("This is the lumber room. The wood here is cut at the sawmill in "            "the town of Coloma.");      print("You don't need anything here!");      }    }  else    {    print("Through the gate ya see the fort's cemetery.");    }  }  [ look lumberif (said("examine", "beam"))  {  [ if in the lumber room  if (posn(ego, 122, 68, 152, 83))    {    print("The room is filled with lumber.");    }  else    {    print("Ya cain't do that right here!");    }  }  [ get lumber/buy lumberif ((said("acquire", "beam") || said("buy", "beam")))  {  [ if in lumber room  if (posn(ego, 122, 68, 152, 83))    {    print("All you'd get outta that would be splinters!");    }  else    {    print("Ya cain't do that right here!");    }  }  [ look cemeteryif (said("examine", "cemetery"))  {  print("The Sutter's Fort cemetery is just outside the gate.");  }  [ use shovel/dig for goldif ((said("use", "shovel") ||     said("dig", "gold") ||     said("dig") ||     said("dig", "hole")))  {  [ if Jerrod has a shovel  if (has("Shovel"))    {    print("Diggin' ain't allowed here! Do that somewhere else!!");    }  else    {    print("No shovel, no diggin'!");    }  }  [ use pan/pan for goldif ((said("use", "pan") ||     said("pan", "gold") ||     said("pan")))  {  print("Ya need to be in the water!");  }  [ look ground/look grassif ((said("examine", "dirt") || said("examine", "grass")))  {  print("The grass is kept short by all the animals!");  }  [ look doorif (said("examine", "door"))  {  print("These are just normal doors.");  }  [ look windowif (said("examine", "glass"))  {  print("There's nothin' unusual 'bout these windows.");  }  [ open doorif (said("open", "door"))  {  print("Just walk up to it!");  }  [ look fort/look wallsif ((said("examine", "fort") || said("examine", "wall")))  {  print("The walls of Sutter's Fort are all 'round, but there's nothin' unusual "        "'bout that.");  }  [ sleep/take a napif ((said("sleep") ||     said("sleep", "bed") ||     said("sleep", "in", "bed") ||     said("go", "sleep") ||     said("acquire", "sleep") ||     said("lay", "down") ||     said("lay", "down", "sleep") ||     said("lay", "down", "bed") ||     said("lay", "down", "in", "bed") ||     said("lay", "bed") ||     said("lay", "in", "bed") ||     said("use", "bed") ||     said("go", "bed") ||     said("enter", "bed") ||     said("nap") ||     said("acquire", "nap")))  {  print("No time fer sleepin'!");  }  [ look gateif (said("examine", "gate"))  {  print("The Sutter's Fort cemetery is just outside the gate.");  }  [ close gateif (said("close", "gate"))  {  print("The gate doesn't need to be closed.");  }  [ look Colomaif (said("examine", "coloma"))  {  print("The town of Coloma is located east of Sutter's Fort.");  }  [ look sawmillif (said("examine", "sawmill"))  {  print("Sutter's Mill is located in the town of Coloma.");  }  Done:[ if Jerrod has a muleif ((has(LazyMule) || has("James' ol' mule")))  {  [ call mule logic to handle mule related commands  call(lgc.Mule);  }return();[ **************************************[ MESSAGES[ **************************************#message 1 "Through the gate ya see the fort's cemetery."#message 2 "This room is filled with bunks. Many weary workers have slept here."#message 3 "Yer in the entryway 'tween a couple of rooms. To yer left is a bunk room, to yer right is the lumber room."#message 4 "This is the lumber room. The wood here is cut at the sawmill in the town of Coloma."#message 5 "The room is filled with lumber."#message 6 "Ya cain't do that right here!"#message 7 "All you'd get outta that would be splinters!"#message 8 "No time fer sleepin'!"#message 9 "The Sutter's Fort cemetery is just outside the gate."#message 10 "The gate doesn't need to be closed."#message 11 "The town of Coloma is located east of Sutter's Fort."#message 12 "Sutter's Mill is located in the town of Coloma."#message 40 "Diggin' ain't allowed here! Do that somewhere else!!"#message 41 "No shovel, no diggin'!"#message 42 "Ya need to be in the water!"#message 63 "The grass is kept short by all the animals!"#message 64 "These are just normal doors."#message 65 "There's nothin' unusual 'bout these windows."#message 66 "Just walk up to it!"#message 69 "The walls of Sutter's Fort are all 'round, but there's nothin' unusual 'bout that."#message 74 "You don't need anything here!"