[***********************************************************[[ rm.CabinInterior[[ The interior of the Jake's cabin. There is a trap door [ in the floor that connects to the tunnels leading to[ Jake and the gold room.[[***********************************************************[ **************************************[ LOCAL DEFINES[ **************************************#define oMatches                     o1#define oRug                         o2#define oTrapDoor                    o3#define vTmpVal                    v220#define vRugStatus                 v221#define fTrapDoorOpen              f220#define fDoorMoved                 f221#define fRugMoved                  f222#define fSoundDone                 f223#define fEgoMoved                  f224[ **************************************[ FIRST CYCLE ONLY[ **************************************if (isset(newRoom))  {  [ load picture for current room  load.pic(currentRoom);    [ load views used in the room  load.view(vw.BigJerrodCA);  load.view(vw.CabinArt);    [ load sounds used in the room  load.sound(m.FoundGold);  load.sound(s.Effect2);    [ draw the current room picture  draw.pic(currentRoom);    [ add Jakes bed  add.to.pic(vw.CabinArt, 1, 1, 72, 91, 4, 4);  [ add the stove  add.to.pic(vw.CabinArt, 1, 2, 51, 98, 0, 4);  [ some logs by the stove  add.to.pic(vw.CabinArt, 1, 3, 59, 85, 0, 4);  [ small rug by the bed  add.to.pic(vw.CabinArt, 1, 4, 79, 99, 4, 4);  [ table  add.to.pic(vw.CabinArt, 1, 5, 98, 163, 0, 4);  [ door mat  add.to.pic(vw.CabinArt, 1, 6, 70, 163, 0, 4);  [ some storage chests  add.to.pic(vw.CabinArt, 1, 7, 36, 163, 15, 4);  [ a couple of chairs  add.to.pic(vw.CabinArt, 1, 8, 109, 139, 0, 4);  add.to.pic(vw.CabinArt, 1, 9, 42, 128, 0, 4);    [ a rug covers the trap door  animate.obj(oRug);  set.view(oRug, vw.CabinArt);  set.loop(oRug, 1);  set.cel(oRug, 0);  ignore.objs(oRug);  ignore.blocks(oRug);  set.priority(oRug, 5);  [ if the rug is moved aside  if (isset(RugMoved))    {    [ position it away from trap door    position(oRug, 61, 142);    }  else    {    [ otherwise position it on the trap door    position(oRug, 61, 125);    }      [ if coming from the tunnel  if (previousRoom == rm.Tunnel_4)    {    [ the rug is moved aside    set(RugMoved);    position(oRug, 61, 142);    }  draw(oRug);  stop.cycling(oRug);  stop.update(oRug);    [ the trap door is under the rug  animate.obj(oTrapdoor);  set.view(oTrapdoor, vw.CabinArt);  [ show door open  set.loop(oTrapdoor, 0);  [ if coming from the tunnel  if (previousRoom == rm.Tunnel_4)    {    [ show it open    set(fTrapDoorOpen);    set.cel(oTrapdoor, 0);    }  else    {    [ if coming from outside, show the trapdoor closed    set.cel(oTrapdoor, 6);    }  ignore.objs(oTrapdoor);  ignore.blocks(oTrapdoor);  set.priority(oTrapdoor, 4);  position(oTrapdoor, 69, 120);  draw(oTrapdoor);  stop.cycling(oTrapdoor);    [ if Jerrod doesn't have the matches  if (!has("Matches"))    {    [ show the matches on the table    animate.obj(oMatches);    set.view(oMatches, vw.CabinArt);    set.loop(oMatches, 1);    set.cel(oMatches, 10);    set.priority(oMatches, 15);    ignore.objs(oMatches);    ignore.blocks(oMatches);    position(oMatches, 106, 140);    draw(oMatches);    stop.cycling(oMatches);    }      [ use the large Jerrod view, with California attire  animate.obj(ego);  set.view(ego, vw.BigJerrodCA);  vTmpVal = 2;  step.size(ego, vTmpVal);  draw(ego);    [ now show the picture  show.pic();  }  [ **************************************[ EVERY CYCLE[ **************************************[ if Jerrod is not by the trapdoor and the door is openif (!posn(ego, 52, 110, 94, 126) && isset(fTrapDoorOpen))  {  [ close the trapdoor  reset(fTrapDoorOpen);  end.of.loop(oTrapdoor, fDoorMoved);  }  [ after trapdoor finishes closingif (isset(fDoorMoved))  {  [ reset the flag  reset(fDoorMoved);  [ door is done updating  stop.update(oTrapdoor);  [ play open-door sound effect  sound(s.Effect2, fSoundDone);  }  [ if Jerrod is beginning to move the rugif (isset(fEgoMoved) && vRugStatus == 1)  {  [ reset the flag  reset(fEgoMoved);  [ if rug is currently moved aside  if (isset(RugMoved))    {    [ move Jerrod to bottom edge of rug    move.obj(ego, 74, 142, 0, fEgoMoved);    [ next stage is to move rug up    vRugStatus = 2;    }  else    {    [ move Jerrod to bottom edge of rug    move.obj(ego, 74, 106, 0, fEgoMoved);    [ next stage is to move rug down    vRugStatus = 4;    }  }  [ if ready to move rug up to cover the trapdoorif (isset(fEgoMoved) && vRugStatus == 2)  {  [ reset the flag  reset(fEgoMoved);  [ advance to next stage  vRugStatus = 3;  [ move the rug up  start.update(oRug);  move.obj(oRug, 61, 124, 2, fRugMoved);  [ reset the rug-moved flag  reset(RugMoved);  [ move Jerrod up at same time so it looks like he's moving  [ the rug  move.obj(ego, 74, 124, 0, fEgoMoved);  }  [ when Jerrod finishes moving the rug upif (isset(fEgoMoved) && vRugStatus == 3)  {  [ reset flag and rug status  reset(fEgoMoved);  vRugStatus = 0;  }  [ if ready to move the rug down to reveal the trapdoorif (isset(fEgoMoved) && vRugStatus == 4)  {  [ reset the flag  reset(fEgoMoved);  [ advance to next status  vRugStatus = 5;  [ move the rug down  start.update(oRug);  move.obj(oRug, 61, 142, 2, fRugMoved);  [ set the rug-moved flag  set(RugMoved);  [ move Jerrod down at same time so it looks like he's  [ moving the rug  move.obj(ego, 74, 124, 0, fEgoMoved);  }  [ when Jerrod finishes moving the rug downif (isset(fEgoMoved) && vRugStatus == 5)  {  [ reset the flag and the rug status  reset(fEgoMoved);  vRugStatus = 0;  }  [ if the rug is done movingif (isset(fRugMoved))  {  [ reset its flag and stop updating the rug  reset(fRugMoved);  stop.update(oRug);  }  [ **************************************[ CHECK FOR AN EXIT CONDITION[ **************************************[ if by the cabin doorif (posn(ego, 1, 165, 159, 166))  {  [ adjust Jerrod's position and step size for the new room  position(ego, 61, 112);  vTmpVal = 1;  step.size(ego, vTmpVal);  [ then go outside to the cabin exterior  new.room(rm.JakesCabin); [ ##LE001##  }  [ if the trap door is openif (isset(fTrapDoorOpen))  {  [ if Jerrod is by the trapdoor  if (posn(ego, 59, 110, 87, 120))    {    [ stop moving, and position Jerrod for the next room    egoDir = STOPPED;    position(ego, 65, 61);    [ then move into tunnel #4    new.room(rm.Tunnel_4); [ ##LE002##    }  }  [ **************************************[ PROCESS PLAYER INPUT[ **************************************[ if player hasn't provided input no need to do said testsif (!isset(haveInput))  {  goto(Done);  }  [ move carpetif (said("move", "carpet"))  {  [ if trapdoor is currently open  if (isset(fTrapDoorOpen))    {    print("Ya can't do that with the trap door open.");    goto(Done);    }      [ if rug is currently not being moved  if (vRugStatus == 0)    {    [ move Jerrod horizontally to the trap door    EgoX = 74;    move.obj.v(ego, EgoX, EgoY, vTmpVal, fEgoMoved);    [ begin rug move sequence    vRugStatus = 1;    }  else    {    print("Yer already doing that.");    }  }  [ get matchesif ((said("acquire", "match") ||     said("acquire", "book", "match") ||     said("acquire", "match", "book")))  {  [ if Jerrod alerady has the matches  if (has("Matches"))    {    print("Ya already have the matches.");    }  else    {    [ if Jerrod is by the table, near the matches    if (posn(ego, 84, 142, 118, 164))      {      [ take 'em      print("Ya get the matches from the table.");      [ remove them from the screen      erase(oMatches);      get("Matches");      [ there are five matches to start      MatchesCount = 5;      [ score one point      currentScore  += 1;      sound(m.FoundGold, fSoundDone);      }    else      {      print("Ya can't do that from here.");      }    }  }  [ take carpetif (said("acquire", "carpet"))  {  print("You don't need a rug.");  }  [ take doormatif (said("acquire", "doormat"))  {  print("You don't need a doormat.");  }  [ look around/lookif ((said("examine", "around") ||     said("examine") ||     said("examine", "cabin")))  {  print("This is the inside of yer brother's cabin. It's tidy, but dusty. He "        "must not spend much time here.");  }  [ look stoveif (said("examine", "stove"))  {  print("There's a stove in the corner of the cabin, with a supply of firewood.");  }  [ look log/look firewoodif ((said("examine", "beam") ||     said("examine", "firewood")))  {  print("It's always a good idea to have a supply of wood on hand!");  }  [ look bedif (said("examine", "bed"))  {  print("Ya detect the bed has been slept in recently.");  }  [ look carpetif (said("examine", "carpet"))  {  print("The rug in the center of the floor is dirty. There are specks of gold "        "in the dirt. There's also a doormat by the front door.");  }  [ look under carpet/lift carpetif ((said("examine", "below", "carpet") ||     said("lift", "carpet")))  {  [ if the rug is moved  if (isset(RugMoved))    {    print("Right now, there's nothin' under the rug but a floor.");    }  else    {    print("It's difficult to see what's under the rug.");    }  }  [ look doormatif ((said("examine", "doormat") ||     said("examine", "mat") ||     said("examine", "door", "mat")))  {  print("The doormat is clean, but the rug in the center of the floor is dirty.");  }  [ look chairif (said("examine", "chair"))  {  print("There are a couple of chairs in the cabin.");  }  [ look tableif ((said("examine", "table") || said("examine", "desk")))  {  [ if Jerrod has the matches  if (has("Matches"))    {    print("The table is cluttered with useless items.");    }  else    {    print("The only thing of interest on the table is a book of matches.");    }  }  [ look chest/look boxif ((said("examine", "chest") || said("examine", "box")))  {  print("Ya recognize yer brother's chests.");  }  [take chestif (said("acquire", "chest"))  {  print("You have no need for the chest.");  }  [ look windowif (said("examine", "glass"))  {  print("Out the window ya see nothin' but the California wilderness.");  }  [ look wallif (said("examine", "wall"))  {  print("These walls were most likely made from the trees that once stood right "        "here!");  }  [ look floor/look downif ((said("examine", "deck") || said("examine", "down")))  {  [ if rug is moved  if (isset(RugMoved))    {    print("Next to the trap door is a huge rug. There's doormat at the front "          "door.");    }  else    {    print("In the center of the floor is a huge rug. There's a doormat at the "          "front door.");    }  }  [ look rafterif (said("examine", "rafter"))  {  print("Sure 'nough. They sure are rafters! They do nothin' but hold up the "        "roof.");  }  [ go to the rafter/climb rafterif ((said("go", "rafter") ||     said("climb", "rafter")))  {  print("How ya gonna get up there?");  }  [ look matchesif (said("examine", "match"))  {  [ if matches are on the table  if (!has("Matches"))    {    print("There's some matches on the table.");    }  }  [ look roofif (said("examine", "roof"))  {  print("The roof's held up by the rafters and keeps the rain off of the floor "        "in the winter time.");  }  [ feel stoveif (said("feel", "stove"))  {  [ if by the stove  if (posn(ego, 50, 93, 64, 100))    {    print("The stove's cool. There hasn't been a fire in it recently.");    }  else    {    print("Ya can't do that from here.");    }  }  [ look trap doorif ((said("examine", "trap", "door") ||     said("examine", "trapdoor") ||     said("examine", "trap") ||     said("examine", "door", "deck")))  {  [ if rug is moved  if (isset(RugMoved))    {    print("There's no doubt about it. That's a trap door!");    }  else    {    print("There's no trap door in sight.");    }  }  [ look door/look front doorif ((said("examine", "door") ||     said("examine", "front", "door") ||     said("examine", "cabin", "door")))  {  print("There's nothin' special about the front door of the cabin.");  }  [ open trapdoorif ((said("open", "trap", "door") ||     said("open", "trapdoor") ||     said("open", "door", "deck") ||     said("pull", "trap", "door") ||     said("pull", "trapdoor") ||     said("pull", "door", "deck") ||     said("lift", "trap", "door") ||     said("lift", "trapdoor") ||     said("lift", "door", "deck") ||     said("move", "trap", "door") ||     said("move", "trapdoor") ||     said("move", "door", "deck") ||     said("raise", "trap", "door") ||     said("raise", "trapdoor") ||     said("raise", "door", "deck") ||     said("knock", "trap", "door") ||     said("knock", "trapdoor") ||     said("knock", "door", "deck") ||     said("examine", "below", "trap", "door") ||     said("examine", "below", "trapdoor") ||     said("examine", "below", "door", "deck") ||     said("examine", "below", "door")))  {  [ if it is already open  if (isset(fTrapDoorOpen))    {    print("The trap door's already open.");    }  else    {    [ if rug is moved aside    if (isset(RugMoved))      {      [ if Jerrod is near the door      if (posn(ego, 60, 104, 88, 127))        {        [ it can't be opened from inside!        print("There's no way to open the trap door from inside the cabin.");        }      else        {        print("Ya can't do that from here.");        }      }    else      {      print("There's no trap door in sight.");      }    }  }  [ open front doorif ((said("open", "door") ||     said("open", "front", "door") ||     said("open", "cabin", "door")))  {  print("There's no need to open the front door of the cabin.");  }  [ close trap doorif ((said("close", "trap", "door") ||     said("close", "trapdoor") ||     said("close", "door", "deck")))  {  [ if trap door is open  if (isset(fTrapDoorOpen))    {    print("Just walk away and the trap door will fall closed.");    }  else    {    [ trap door is closed - is rug moved aside?    if (isset(RugMoved))      {      print("The trap door's already closed.");      }    else      {      print("There's no trap door in sight.");      }    }  }  [ close front doorif ((said("close", "door") ||     said("close", "front", "door") ||     said("close", "cabin", "door")))  {  print("The front door of the cabin doesn't need to be closed.");  }  [ open chestif (said("open", "chest"))  {  print("There's nothin' stored in the chest.");  }  [ look ground/look dirty carpetif ((said("examine", "dirt") ||     said("examine", "dirt", "carpet") ||     said("examine", "dirt", "deck")))  {  print("The dirt on the rug has sparkles of gold in it!");  }  [ get goldif (said("acquire", "gold"))  {  print("Ya only see specks of gold. It isn't even worth bending over for that.");  }  [ get dirtif (said("acquire", "dirt"))  {  print("Ya don't need any dirt.");  }  [ look goldif (said("examine", "gold"))  {  [ if Jerrod doesn't have any gold dug from the mine  if (GoldIndex < 60)    {    print("Ya see specks of gold in the dirt on the floor.");    }  }  [ sleep/take a napif ((said("sleep") ||     said("sleep", "bed") ||     said("sleep", "in", "bed") ||     said("go", "sleep") ||     said("acquire", "sleep") ||     said("lay", "down") ||     said("lay", "down", "sleep") ||     said("lay", "down", "bed") ||     said("lay", "down", "in", "bed") ||     said("lay", "bed") ||     said("lay", "in", "bed") ||     said("use", "bed") ||     said("go", "bed") ||     said("enter", "bed") ||     said("nap") ||     said("acquire", "nap")))  {  print("Yer mind is spinnin', wonderin' where James is. Ya wouldn't be able to "        "get any sleep.");  }  Done:return();[ **************************************[ MESSAGES[ **************************************#message 1 "Yer already doing that."#message 2 "Ya can't do that with the trap door open."#message 3 "Ya can't do that from here."#message 4 "Ya get the matches from the table."#message 5 "Ya already have the matches."#message 6 "This is the inside of yer brother's cabin. It's tidy, but dusty. He must not spend much time here."#message 7 "There's a stove in the corner of the cabin, with a supply of firewood."#message 8 "It's always a good idea to have a supply of wood on hand!"#message 9 "Ya detect the bed has been slept in recently."#message 10 "In the center of the floor is a huge rug. There's a doormat at the front door."#message 11 "There are a couple of chairs in the cabin."#message 12 "The only thing of interest on the table is a book of matches."#message 13 "Ya recognize yer brother's chests."#message 14 "Out the window ya see nothin' but the California wilderness."#message 15 "These walls were most likely made from the trees that once stood right here!"#message 16 "The floor was made from the same wood as the walls were."#message 17 "Sure 'nough. They sure are rafters! They do nothin' but hold up the roof."#message 18 "How ya gonna get up there?"#message 19 "There's some matches on the table."#message 20 "The table is cluttered with useless items."#message 21 "The roof's held up by the rafters and keeps the rain off of the floor in the winter time."#message 23 "Next to the trap door is a huge rug. There's doormat at the front door."#message 24 "The stove's cool. There hasn't been a fire in it recently."#message 25 "There's no doubt about it. That's a trap door!"#message 26 "There's no trap door in sight."#message 28 "The trap door's already open."#message 29 "There's no way to open the trap door from inside the cabin."#message 30 "Just walk away and the trap door will fall closed."#message 31 "The trap door's already closed."#message 32 "There's nothin' stored in the chest."#message 34 "The dirt on the rug has sparkles of gold in it!"#message 35 "Ya don't need any dirt."#message 36 "Ya only see specks of gold. It isn't even worth bending over for that."#message 37 "Ya see specks of gold in the dirt on the floor."#message 38 "The rug in the center of the floor is dirty. There are specks of gold in the dirt. There's also a doormat by the front door."#message 39 "There's nothin' special about the front door of the cabin."#message 40 "There's no need to open the front door of the cabin."#message 41 "The doormat is clean, but the rug in the center of the floor is dirty."#message 42 "You don't need a rug."#message 43 "You don't need a doormat."#message 44 "It's difficult to see what's under the rug."#message 45 "You have no need for the chest."#message 46 "Right now, there's nothin' under the rug but a floor."#message 47 "Yer mind is spinnin', wonderin' where James is. Ya wouldn't be able to get any sleep."#message 48 "The front door of the cabin doesn't need to be closed."