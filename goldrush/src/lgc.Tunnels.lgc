[***********************************************************[[ lgc.Tunnels[[ Contains all the code that is common to all tunnel rooms.[ Each tunnel room calls this logic in each cycle.[[***********************************************************[ **************************************[ LOCAL DEFINES[ **************************************#define vDeathTimer                v245[ if lantern is lit, and Jerrod isn't fallingif (isset(LanternLit) && !isset(FellOffLadder))  {  [ increment lantern timer  ++LanternTimer1;  [ if lower counter maxes out  if (LanternTimer1 == 255)    {    [ reset it and increment high counter    LanternTimer1 = 0;    ++LanternTimer2;    [ each high count gives ~15 to 20 seconds of playing    [ time after 58 cycles of high counter ( ~15 - 25    [ minutes of playing time)    if (LanternTimer2 == 58)      {      [ lantern runs out of oil      set(LanternEmpty);      [ and goes out      reset(LanternLit);      print.at("Yer lantern just ran out of oil!", 2, 26, 10);            [ unless Jerrod also has a match lit      if (!isset(MatchLit))        {        [ things go dark        call(lgc.DarkenTunnel);        }      }    }  }  [ if Jerrod is holding a lit match and not fallingif (isset(MatchLit) && !isset(FellOffLadder))  {  [ increment match timer  ++MatchTimer;  [ after 75 cycles  if (MatchTimer == 75)    {    [ match goes out    MatchTimer = 0;    reset(MatchLit);    print.at("Yer match just burned out!", 2, 26, 10);        [ unless Jerrod's lantern is lit    if (!isset(LanternLit))      {      [ things go dark      call(lgc.DarkenTunnel);      }    }  }  [ if Jerrod used his last matchif (MatchesCount == 0 && has("Matches"))  {  [ no more matches  drop("Matches");  }  [ if Jerrod is falling of a ladderif (isset(FellOffLadder))  {  [ erase ego object from screen  reset(FellOffLadder);  erase(ego);  [ clear edge hit  reset(egoHitSpecial);  [ no more input  prevent.input();  [ draw black box over entire screen  clear.text.rect(1, 0, 21, 39, BLACK);  [ provide message to user  print.at("Watch yer step on these ladders!", 2, 26, 10);  display(22, 0, "Even in the depths of this darkness, death has found you!");  [ start timer for short delay before showing  [ restore/restart message  vDeathTimer = 1;  }  [ if pausing before showing restart/restoreif (vDeathTimer > 0)  {  [ increment timer  ++vDeathTimer;  [ at 80 cycles  if (vDeathTimer == 80)    {    [ reset, and then show restore/restart message    vDeathTimer = 0;    print.at("\nF7 Restore\nF9 Restart\n", 2, 26, 11);    }  }[ if an unknown word was enteredif (isset(haveInput) && unknownWordNum > 0)  {  [ reset input so it parser doesn't try to parse it later  reset(haveInput);  [ display a random 'what did you say' message  unknownWordNum  += 100;  print.at.v(unknownWordNum, 2, 26, 10);  }  [ **************************************[ PROCESS PLAYER INPUT[ **************************************[ if player hasn't provided input no need to do said testsif (!isset(haveInput))  {  goto(Done);  }  [ **************************************[ PROCESS PLAYER INPUT[ **************************************[ light the lanternif ((said("lamp", "lantern") ||     said("use", "lantern") ||     said("lamp", "lantern", "match") ||     said("use", "match", "lamp", "lantern")))  {  if (has("Lantern"))    {    if (isset(LanternLit))      {      print.at("The lantern's already lit.", 2, 26, 10);      }    else      {      if (has("Matches"))        {        if (isset(LanternEmpty))          {          print.at("Yer lantern's out of oil.", 2, 26, 10);          }        else          {          print.at("Ya light the lantern.", 2, 26, 10);          set(LanternLit);          [ chance to make it through tunnels in total          [ darkness is gone          set(UsedLantern);          --MatchesCount;          }        }      else        {        print.at("Yer out of matches.", 2, 26, 10);        }      }    }  else    {    print.at("Ya don't have a lantern.", 2, 26, 10);    }  }  [ blow out lanternif ((said("place", "out", "lantern") ||     said("place", "out", "lamp") ||     said("quench", "lantern") ||     said("quench", "lamp") ||     said("blow", "out", "lantern") ||     said("blow", "out", "lamp") ||     said("blow", "lantern") ||     said("blow", "lamp")))  {  if (has("Lantern"))    {    if (isset(LanternLit))      {      print.at("Ya blow out the lantern.", 2, 26, 10);      reset(LanternLit);      [ if Jerrod doesn't have a lit match      if (!isset(MatchLit))        {        [ everything goes dark        call(lgc.DarkenTunnel);        }      }    else      {      print.at("The lantern isn't lit.", 2, 26, 10);      }    }  else    {    print.at("Ya don't have a lantern.", 2, 26, 10);    }  }  [ light a matchif ((said("lamp", "match") || said("use", "match")))  {  if (has("Matches"))    {    if (isset(MatchLit))      {      print.at("Ya already have a match lit.", 2, 26, 10);      }    else      {      print.at("Ya light one of yer matches.", 2, 26, 10);      set(MatchLit);      [ the programmers forgot to set the flag 'UsedMatch'      [ which is used to award a bonus if player navigates      [ the entire tunnel complex without lighting a match      [ or the torch            [ one less match now      --MatchesCount;      }    }  else    {    print.at("Ya don't have any more matches.", 2, 26, 10);    }  }  [ blow out matchif ((said("place", "out", "match") ||     said("quench", "match") ||     said("blow", "match") ||     said("blow", "out", "match")))  {  if (isset(MatchLit))    {    print.at("Ya blow out the match.", 2, 26, 10);    reset(MatchLit);    [ if Jerrod doesn't have his lantern lit    if (!isset(LanternLit))      {      [ everything goes dark      call(lgc.DarkenTunnel);      }    }  else    {    print.at("Ya don't have a match lit.", 2, 26, 10);    }  }  [ get oil for lanternif ((said("acquire", "oil") ||     said("acquire", "lantern", "oil") ||     said("acquire", "oil", "lantern")))  {  [ there is none to get in the tunnels  print.at("There's no more oil.", 2, 26, 10);  }  [dig with shovelif ((said("use", "shovel") ||     said("dig", "gold") ||     said("dig") ||     said("dig", "hole")))  {  if (has("Shovel"))    {    print.at("This ground is too hard to use a shovel.", 2, 26, 10);    }  else    {    print.at("Ya don't have a shovel.", 2, 26, 10);    }  }  if ((said("examine", "wall") ||     said("examine", "mine") ||     said("examine", "cave") ||     said("examine", "around") ||     said("examine")))  {  [ if Jerrod is using the lantern  if (isset(LanternLit))    {    print.at("Ya scan the walls for gold.", 2, 26, 10);    }  else    {    print.at("It's too dern dark in here!", 2, 26, 10);    }  }  if (said("examine", "rock"))  {  [ if Jerrod has a lit match OR his lit lantern  if ((isset(LanternLit) || isset(MatchLit)))    {    print.at("There are rocks all over in the mine.", 2, 26, 10);    }  else    {    print.at("It's too dern dark in here!", 2, 26, 10);    }  }  if (said("examine", "beam"))  {  [ if Jerrod has a lit match OR his lit lantern  if ((isset(LanternLit) || isset(MatchLit)))    {    print.at("These timbers look strong and sturdy.", 2, 26, 10);    }  else    {    print.at("It's too dern dark in here!", 2, 26, 10);    }  }  if ((said("examine", "deck") ||     said("examine", "dirt")))  {  [ if Jerrod has a lit match OR his lit lantern  if ((isset(LanternLit) || isset(MatchLit)))    {    print.at("Ya look at the ground for any sign of gold.", 2, 26, 10);    }  else    {    print.at("It's too dern dark in here!", 2, 26, 10);    }  }  if (said("find", "gold"))  {  print.at("Look, and you will find!", 2, 26, 10);  }  if ((said("climb", "ladder") || said("go", "ladder")))  {  print.at("If ya see a ladder, climb it.", 2, 26, 10);  }  if (said("examine", "match"))  {  if (has("Matches"))    {    if (MatchesCount == 1)      {      print.at("Ya have 1 match left.", 2, 26, 10);      }    else      {      print.at("Ya have %v170 matches left.", 2, 26, 10);      }    }  else    {    print("Yer out of matches.");    }  }  if ((said("anyword", "jake") ||     said("anyword", "james")))  {  print.at("He must be in here somewhere.", 2, 26, 10);  }  if (said("examine", "rol"))  {  print.at("Ya notice nothin' unusual.", 2, 26, 10);  }  [ if any other input was provided (that didn't include an [ unknown word), provide a generic responseif (isset(haveInput) &&     !isset(haveMatch) &&     unknownWordNum <= 0)  {  [ reset haveInput so parser won't continue trying to parse  reset(haveInput);  print.at("Ya can't do that here.", 2, 26, 10);  }  Done:return();[ **************************************[ MESSAGES[ **************************************#message 1 "Ya don't have a lantern."#message 2 "Yer out of matches."#message 3 "Yer lantern's out of oil."#message 4 "There's no more oil."#message 5 "The lantern's already lit."#message 6 "Ya light the lantern."#message 7 "Yer lantern just ran out of oil!"#message 8 "Yer match just burned out!"#message 9 "Ya light one of yer matches."#message 10 "Ya don't have any more matches."#message 11 "Ya already have a match lit."#message 12 "Ya blow out the lantern."#message 13 "The lantern isn't lit."#message 14 "Ya blow out the match."#message 15 "Ya don't have a match lit."#message 18 "This ground is too hard to use a shovel."#message 19 "Ya don't have a shovel."#message 20 "There are rocks all over in the mine."#message 21 "It's too dern dark in here!"#message 22 "These timbers look strong and sturdy."#message 23 "Ya look at the ground for any sign of gold."#message 24 "Ya scan the walls for gold."#message 25 "Ya notice nothin' unusual."#message 26 "Look, and you will find!"#message 27 "\nF7 Restore\nF9 Restart\n"#message 28 "Watch yer step on these ladders!"#message 29 "If ya see a ladder, climb it."#message 30 "He must be in here somewhere."#message 31 "Ya have %v170 matches left."#message 32 "Ya have 1 match left."#message 90 "Even in the depths of this darkness, death has found you!"#message 100 "Ya can't do that here."#message 101 "%g50\"%w1.\""#message 102 "%g50\"%w2.\""#message 103 "%g50\"%w3.\""#message 104 "%g50\"%w4.\""#message 105 "%g50\"%w5.\""#message 106 "%g50\"%w6.\""#message 107 "%g50\"%w7.\""#message 108 "%g50\"%w8.\""#message 109 "%g50\"%w9.\""