[***********************************************************[[ rm.SF_Blacksmith[ [ John Sutter's quarters, a candle shop, a blacksmith shop[ and a gunshop are all in this scene. Only the blacksmith[ shop has interactions. Jerrod can get the branding iron [ to brand his lazy mule here.[[***********************************************************[ **************************************[ LOCAL DEFINES[ **************************************#define oDoor1                       o1#define oDoor2                       o2#define oFire                        o3#define oSmoke                       o4#define oBlacksmith                  o5#define oBrandIron                   o6#define vTmpX                      v220#define vChatStatus                v221#define vSmithStatus               v222#define vBrandTimer                v223#define vCelNum                    v224#define vHammerTimer               v225[ f220 is not used#define fDoor1Moved                f221#define fDoor1Open                 f222#define fDoor2Moved                f223#define fDoor2Open                 f224#define fByFire                    f225#define fIronIsHot                 f226#define fMusicDone                 f227#define fSmithMoved                f228#define fTalkToSmith               f229[ f230 is not used#define fBehindWindow              f231#define fBySmithy                  f232#define fSoundDone                 f233[ **************************************[ FIRST CYCLE ONLY[ **************************************if (isset(newRoom))  {  [ load, draw and discard current room picture  load.pic(currentRoom);  draw.pic(currentRoom);  discard.pic(currentRoom);    [ load mule logic  load.logics(lgc.Mule);    [ load views used in the room  load.view(vw.JerrodCA);  load.view(vw.SuttersFortArt);  load.view(vw.BlacksmithArt);  load.view(vw.WindowJerrod);    [ load sounds used in the game  load.sound(m.FoundGold);  load.sound(s.Effect1);  load.sound(s.Effect2);  load.sound(s.SmithHammer);    [ add bed in John Sutter's room on left to the image  add.to.pic(vw.SuttersFortArt, 1, 0, 3, 82, 6, 6);  [ fireplace in candle shop  add.to.pic(vw.SuttersFortArt, 1, 1, 37, 83, 6, 6);  [ stuff behind windows in blacksmith shop (smithy)  add.to.pic(vw.SuttersFortArt, 1, 2, 80, 82, 6, 6);  [ wagon wheel leaning against wall  add.to.pic(vw.SuttersFortArt, 1, 3, 83, 99, 9, 0);    [ blacksmith (behind window to start)  animate.obj(oBlacksmith);  set.view(oBlacksmith, vw.BlacksmithArt);  set.loop(oBlacksmith, 2);  set.cel(oBlacksmith, 3);  set.priority(oBlacksmith, 8);  ignore.blocks(oBlacksmith);  position(oBlacksmith, 119, 82);  draw(oBlacksmith);  [ start at stage 6  vSmithStatus = 6;    [ if Jerrod does not have the branding iron  if (!has("Branding iron"))    {    [ show it on screen    animate.obj(oBrandIron);    set.view(oBrandIron, vw.BlacksmithArt);    set.loop(oBrandIron, 0);    set.cel(oBrandIron, 0);    [ in smith shop, just inside the door    position(oBrandIron, 100, 85);    set.priority(oBrandIron, 6);    ignore.blocks(oBrandIron);    ignore.objs(oBrandIron);    draw(oBrandIron);    stop.update(oBrandIron);    }      [ forge fire  animate.obj(oFire);  set.view(oFire, vw.SuttersFortArt);  set.loop(oFire, 2);  set.priority(oFire, 6);  position(oFire, 106, 72);  draw(oFire);    [ smoke coming from forge fire  animate.obj(oSmoke);  set.view(oSmoke, vw.SuttersFortArt);  set.loop(oSmoke, 3);  set.priority(oSmoke, 9);  ignore.horizon(oSmoke);  position(oSmoke, 96, 2);  draw(oSmoke);    [ door to John Sutter's quarters  animate.obj(oDoor1);  set.view(oDoor1, vw.BlacksmithArt);  set.loop(oDoor1, 6);  set.cel(oDoor1, 0);  ignore.objs(oDoor1);  ignore.blocks(oDoor1);  set.priority(oDoor1, 8);  position(oDoor1, 3, 93);  draw(oDoor1);  stop.update(oDoor1);    [ door to candle shop  animate.obj(oDoor2);  set.view(oDoor2, vw.BlacksmithArt);  set.loop(oDoor2, 6);  set.cel(oDoor2, 0);  ignore.objs(oDoor2);  ignore.blocks(oDoor2);  set.priority(oDoor2, 8);  position(oDoor2, 37, 93);  draw(oDoor2);  stop.update(oDoor2);    [ Jerrod, with normal California attire  animate.obj(ego);  set.view(ego, vw.JerrodCA);  [ if coming from the bunkroom room  if (previousRoom == rm.SF_Bunkroom)    {    [ change direction, and set correct loop    egoDir = UP;    set.loop(ego, 3);    }  draw(ego);    [ if Jerrod has a mule  if ((has(LazyMule) || has("James' ol' mule")))    {    [ do mule initializtion for the room    call(lgc.Mule);    }      [ now show the picture  show.pic();    [ not necessary to reset this flag; AGI resets it  [ automatically  reset(newRoom);  }  [ **************************************[ EVERY CYCLE[ **************************************[ if Jerrod is in front of smithy and not markedif (posn(ego, 80, 96, 159, 109) && !isset(fBySmithy))  {  [ set flag  set(fBySmithy);  [ Jerrod ignores blocks (this is needed so Jerrod can go  [ into/out of the smithy, while keeping other objects,  [ such as the mule, from wandering in/out)  ignore.blocks(ego);  }  [ if Jerrod is not in front of smithy but is markedif (!posn(ego, 80, 96, 159, 109) && isset(fBySmithy))  {  [ reset flag  reset(fBySmithy);  [ Jerrod observes blocks (prevents him from walking in  [ some areas of the smithy)  observe.blocks(ego);  }  [ if Jerrod is on an alarm line, but marked as behind a[ windowif (isset(egoHitSpecial) && !isset(fBehindWindow))  {  [ mark Jerrod as behind the window  set(fBehindWindow);  [ change view  set.view(ego, vw.WindowJerrod);  }  [ if Jerrod is not on alarm line, but is marked as behind a[ windowif (!isset(egoHitSpecial) && isset(fBehindWindow))  {  [ reset the flag  reset(fBehindWindow);  [ switch back to normal view  set.view(ego, vw.JerrodCA);  }  [ if Jerrod is near door to Sutter's quarters, and door #1[ is not openif (posn(ego, 1, 81, 25, 96) && !isset(fDoor1Open))  {  [ play open-door sound effect  sound(s.Effect1, fSoundDone);  [ allow door #1 to cycle  start.update(oDoor1);  [ temporarily halt Jerrod while door #1 opens  stop.update(ego);  [ open door #1  end.of.loop(oDoor1, fDoor1Moved);  set(fDoor1Open);  }  [ if Jerrod is not near door to Sutter's quarters, and door[ #1 is openif (!posn(ego, 1, 81, 25, 96) && isset(fDoor1Open))  {  [ allow door to cycle  start.update(oDoor1);  [ close door #1  reverse.loop(oDoor1, fDoor1Moved);  reset(fDoor1Open);  }  [ when door #1 finishes cyclingif (isset(fDoor1Moved))  {  [ stop door #1  stop.update(oDoor1);  [ allow Jerrod to continue moving  start.update(ego);  [ reset movement flag  reset(fDoor1Moved);  [ if door is now closed  if (!isset(fDoor1Open))    {    [ play door-closed sound effect    sound(s.Effect2, fSoundDone);    }  }  [ if Jerrod is near door to candle shop, and door #2 is not[ openif (posn(ego, 33, 81, 61, 96) && !isset(fDoor2Open))  {  [ play door-open sound effect  sound(s.Effect1, fSoundDone);  [ allow door #2 to cycle  start.update(oDoor2);  [ temporarily halt Jerrod while door opens  stop.update(ego);  [ open door #1  end.of.loop(oDoor2, fDoor2Moved);  set(fDoor2Open);  }  [ if Jerrod is not near the door to candle shop, and door #2[ is openif (!posn(ego, 33, 81, 61, 96) && isset(fDoor2Open))  {  [ allow door #2 to cycle  start.update(oDoor2);  [ close door #2  reverse.loop(oDoor2, fDoor2Moved);  reset(fDoor2Open);  }  [ when door #2 finishes cyclingif (isset(fDoor2Moved))  {  [ stop door #2  stop.update(oDoor2);  [ allow Jerrod to continue moving  start.update(ego);  [ reset movement flag  reset(fDoor2Moved);  [ if door #2 is now closed  if (!isset(fDoor2Open))    {    [ play door-closed sound effect    sound(s.Effect2, fSoundDone);    }  }  [ if Jerrod is near the forge fire but flag not setif (posn(ego, 96, 81, 124, 93) && !isset(fByFire))  {  [ set the flag  set(fByFire);  }  [ if Jerrod is not near the forge and flag is setif (!posn(ego, 96, 81, 124, 93) && isset(fByFire))  {  [ reset flag  reset(fByFire);  [ dismiss any print windows that might be open  close.window();  [ force input prompt back to normal  set.string(inputPrompt, "%g69");  accept.input();  inputLength = 38;  [ reset chat sequence to start  vChatStatus = 0;  }  [ if blacksmith is ready to start hammeringif (vSmithStatus == 6)  {  [ set a random length of time to hammer  random(20, 50, vHammerTimer);  [ begin hammering  vSmithStatus = 7;  }  [ while blacksmith is hammeringif (vSmithStatus == 7)  {  [ decrement timer  --vHammerTimer;  [ get current cel  current.cel(oBlacksmith, vCelNum);  [ whenever cel number is 5  if (vCelNum == 5)    {    [ play hammering sound effect    sound(s.SmithHammer, fSoundDone);    }  }[ when hammering is doneif (vHammerTimer == 0 && vSmithStatus == 7)  {  [ remove blacksmith from screen  erase(oBlacksmith);  [ if Jerrod interrupts the blacksmith  if (isset(fTalkToSmith))    {    reset(fTalkToSmith);    vSmithStatus = 10;    }  else    {    [ start another blacksmith-hammer cycle    vSmithStatus = 1;    }  }  [ if a new blacksmith-hammer cycle is ready to startif (vSmithStatus == 1)  {  [ increment timer  ++vHammerTimer;  [ after 10 cycles  if (vHammerTimer == 10)    {    [reset timer    vHammerTimer = 0;    [ blacksmith comes back    vSmithStatus = 2;    set.loop(oBlacksmith, 5);    set.cel(oBlacksmith, 0);    release.priority(oBlacksmith);    position(oBlacksmith, 103, 85);    draw(oBlacksmith);    }  }  [ while blacksmith is coming backif (vSmithStatus == 2)  {  [ get current cel  current.cel(oBlacksmith, vCelNum);  [ when blacksmith turns to face the forge  if (vCelNum == 4)    {    [ he pauses here for a bit to put the metal he's working    [ on in the fire    stop.cycling(oBlacksmith);    vSmithStatus = 3;    }  }  [ while pausing at the forgeif (vSmithStatus == 3)  {  [ increment timer  ++vHammerTimer;  [ at 25 cycles   if (vHammerTimer == 25)    {    [ reset timer    vHammerTimer = 0;    [ now blacksmith goes back into the smithy    vSmithStatus = 4;    end.of.loop(oBlacksmith, fSmithMoved);    }  }  [ after blacksmith goes back into smithyif (isset(fSmithMoved) && vSmithStatus == 4)  {  [ reset flag  reset(fSmithMoved);  [ remove blacksmith from screen  vSmithStatus = 5;  erase(oBlacksmith);  }  [ while blacksmith is gone from screen for second timeif (vSmithStatus == 5)  {  [ increment timer  ++vHammerTimer;  [ after 10 cycles  if (vHammerTimer == 10)    {    [ reset timer    vHammerTimer = 0;    [ blacksmith is ready to start hammering    vSmithStatus = 6;    [ change loop to show him behind window, at the forge,    [ swinging hammer    set.loop(oBlacksmith, 2);    set.cel(oBlacksmith, 3);    set.priority(oBlacksmith, 8);    position(oBlacksmith, 119, 82);    draw(oBlacksmith);    start.cycling(oBlacksmith);    }  }  [ if blacksmith is responding to Jerrodif (vSmithStatus == 10)  {  [ increment timer  ++vHammerTimer;  [ after 5 cycles  if (vHammerTimer == 5)    {    [ reset timer    vHammerTimer = 0;    [ blacksmith comes to door    vSmithStatus = 11;    [ change loop to show blacksmith moving to door    set.loop(oBlacksmith, 3);    set.cel(oBlacksmith, 0);    release.priority(oBlacksmith);    position(oBlacksmith, 103, 92);    draw(oBlacksmith);    end.of.loop(oBlacksmith, fSmithMoved);    }  }  [ when blacksmith gets to doorif (isset(fSmithMoved) && vSmithStatus == 11)  {  [ reset movement flag  reset(fSmithMoved);  [ blacksmith begins talking  vSmithStatus = 12;  set.loop(oBlacksmith, 1);  start.cycling(oBlacksmith);  }  [ if Jerrod is not by the forge and blacksmith is not[ talking or waiting for Jerrod to respondif (!isset(fByFire) &&     (vSmithStatus == 12 ||     vSmithStatus == 13))  {  [ end the conversation  vSmithStatus = 14;  }  [ if blacksmith is talkingif (vSmithStatus == 12)  {  [ increment timer  ++vHammerTimer;  [ after 15 cycles of talking  if (vHammerTimer == 15)    {    [ reset timer    vHammerTimer = 0;    [ blacksmith asks Jerrod a question    vSmithStatus = 13;    print.at("\"Can'tcha see, man, that I'm as busy as a one-armed paperhanger "             "with an itch!\"", 2, 7, 0);    print.at("\"If you'd excuse me, I best be gettin' back to my work!\"", 2, 7, 0);    print.at("\"Hold on there, son. You ain't from the parts around, say, New "             "York, would ya be?\"", 2, 7, 0);    [ chat conversation begins    vChatStatus = 1;    set.string(inputPrompt, "yea or nay %g69");    accept.input();    inputLength = 28;    stop.cycling(oBlacksmith);    }  }  [ when conversation endsif (vSmithStatus == 14)  {  [ blacksmith returns  vSmithStatus = 15;  [ change loop to show him going back  [ to the forge  set.loop(oBlacksmith, 4);  set.cel(oBlacksmith, 0);  end.of.loop(oBlacksmith, fSmithMoved);  }  [ when blacksmith gets back to forgeif (isset(fSmithMoved) && vSmithStatus == 15)  {  [ reset movement flag  reset(fSmithMoved);  [ remove blacksmith from screen  vSmithStatus = 16;  erase(oBlacksmith);  }  [ after blacksmith is gone from screenif (vSmithStatus == 16)  {  [ increment timer  ++vHammerTimer;  [ after five cycles  if (vHammerTimer == 5)    {    [ reset timer    vHammerTimer = 0;    [ blacksmith is ready to start hammering again    vSmithStatus = 6;    set.loop(oBlacksmith, 2);    set.cel(oBlacksmith, 3);    set.priority(oBlacksmith, 8);    position(oBlacksmith, 119, 82);    draw(oBlacksmith);    start.cycling(oBlacksmith);    }  }  [ if Jerrod is still near the blacksmith and the blacksmith[ has a message for Jerrod from Jakeif (posn(ego, 96, 81, 124, 93) && vChatStatus == 6)  {  [ conversation is done  vChatStatus = 0;  [ after blacksmith gives message to Jerrod  print.at("\"I gotta message fer ya from yer brother. I ain't got no notion of "           "his whereabouts, all I got is a message.\"", 2, 7, 0);  print.at("\"He wants ya to know that in these parts he's known as uh, uh... "           "He's known as uh, uh, James, that's it, James!\"", 2, 7, 0);  print.at("\"He won't tell nobody of his whereabouts, but he gave me this to "           "give to ya.\"", 2, 7, 0);  print.at("\"Ain't got no idea what it's fer, but he wanted me to give it to "           "ya.\"", 2, 7, 0);  [ play score sound  sound(m.FoundGold, fMusicDone);  print("The soot-covered blacksmith hands you a branding iron.");  print("Now you know yer on the right trail to find yer brother. He must be on "        "to somethin' big! REALLY BIG!");  [ Jerrod gains the branding iron  get("Branding iron");  [ need to allow update so the branding iron can be removed  [ from the screen  start.update(oBrandIron);  [ remove it  erase(oBrandIron);  [ score two points  currentScore  += 2;  [ blacksmith is ready to return to work  vSmithStatus = 14;  }  [ if branding iron is hotif (isset(fIronIsHot))  {  [ increment timer  ++vBrandTimer;  [ after 250 cycles  if (vBrandTimer == 250)    {    [ increment timer one more (not really necessary)    vBrandTimer = 251;    [ brand has cooled and will need to be reheated    [ if Jerrod wants to use it    reset(fIronIsHot);    }  }  [ **************************************[ CHECK FOR AN EXIT CONDITION[ **************************************[ bottom-right corner leads to bunk roomif ((posn(ego, 152, 120, 152, 167) ||     posn(ego, 130, 166, 159, 166)))  {  [ position Jerrod for new room  position(ego, 2, 106);  new.room(rm.SF_BunkRoom); [ ##LE001##  }  [ left edge leads to south gateif (posn(ego, 1, 97, 1, 166))  {  [ position Jerrod for new room  vTmpX = 151;  position.v(ego, vTmpX, EgoY);  new.room(rm.SF_SouthGate); [ ##LE002##  }  [ bottom-left/bottom-center also goes to bunkroom, but start[ Jerrod closer to bottom in new roomif (posn(ego, 1, 166, 129, 166))  {  [ position Jerrod for new room  position(ego, 2, 131);  new.room(rm.SF_BunkRoom); [ ##LE003##  }  [ **************************************[ PROCESS PLAYER INPUT[ **************************************[ if player hasn't provided input no need to do said testsif (!isset(haveInput))  {  goto(Done);  }  [ if blacksmith is waiting for Jerrod to respond with Jake's[ nameif (vChatStatus == 5)  {  [ if just a single word was entered (or any unknown word)  if ((said("anyword") || unknownWordNum > 0))    {    [ reset flag to another said test can be used    reset(haveMatch);    [ if Jerrod responded correctly    if (said("jake"))      {      [ if Jerrod is still near the blacksmith      if (posn(ego, 96, 81, 124, 93))        {        [ force input prompt back to normal        set.string(inputPrompt, "%g69");        accept.input();        inputLength = 38;        [ blacksmith tells Jerrod that he's got a clue for him        print.at("\"Well, I'll be! I cain't believe it! Lean over here uh, uh, "                 "young fella and listen to me close.\"", 2, 7, 0);        print.at("\"I cain't be talkin' too loud 'bout this kinda thing.\"", 2, 7, 0);        vChatStatus = 6;        [ skip ahead to end (so prompt doesn't get reset)        goto(Done);        }      else        {        [ Jerrod isn't close enough        print("It's awful loud 'round here. Better get closer!");        }      }    else      {      [ Jerrod's response wasn't correct; force match flag      [ so no other said commands get processed      set(haveMatch);      [ also clear unknown word      unknownWordNum = 0;      print.at("\"Never you mind, that ain't it. I musta mistook ya for some "               "other fella.\"", 2, 7, 0);      [ conversation is over      vChatStatus = 0;      [ blacksmith is ready to go back to work      vSmithStatus = 14;      }    }  }  [ if blacksmith is waiting for Jerrod to respond with his[ (Jerrod's) nameif (vChatStatus == 4)  {  [ if a single word was entered (or any unknown word)  if ((said("anyword") || unknownWordNum > 0))    {    [ reset match flag so another said test can be used    reset(haveMatch);    [ if Jerrod responded correctly    if (said("jerrod"))      {      [ if Jerrod is still near the blacksmith      if (posn(ego, 96, 81, 124, 93))        {        [ blacksmith asks for Jake's name        print.at("\"That's it! And, uh, ya got a brother named uh, uh, dag bern "                 "it! Uh, uh...\"", 2, 7, 0);        vChatStatus = 5;        [ force input prompt to ask for Jake's name        set.string(inputPrompt, "Brothers name %g69");        accept.input();        inputLength = 25;        [ skip ahead to end (so prompt doesn't get reset)        goto(Done);        }      else        {        [ Jerrod isn't close enough        print("It's awful loud 'round here. Better get closer!");        }      }    else      {      [ Jerrod's response was incorrect; set match flag so      [ no other said tests get processed      set(haveMatch);      [ also clear unknown word      unknownWordNum = 0;      print.at("\"Never you mind, that ain't it. I musta mistook ya for some "               "other fella.\"", 2, 7, 0);      [ conversation is over      vChatStatus = 0;      [ blacksmith is ready to go back to work      vSmithStatus = 14;      }    }  }  [ if blacksmith is waiting for Jerrod to respond with his[ last nameif (vChatStatus == 3)  {  [ if just a single wore was entered, or an unknown word  if ((said("anyword") || unknownWordNum > 0))    {    [ reset match flag so another test command can be used    reset(haveMatch);    [ if Jerrod answered correctly    if (said("wilson"))      {      [ if Jerrod is still near the blacksmith      if (posn(ego, 96, 81, 124, 93))        {        [ blacksmith asks for Jerrod's name        print.at("\"Yeah, that's it! An uh, yer first name wouldn't be, uh, "                 "shoot, uh... Uh, uh...\"", 2, 7, 0);        vChatStatus = 4;        [ force input prompt to ask for Jerrod's name        set.string(inputPrompt, "Enter first name %g69");        accept.input();        inputLength = 22;        [ skip ahead to end ( so prompt doesn't get reset)        goto(Done);        }      else        {        [ Jerrod is not close enough        print("It's awful loud 'round here. Better get closer!");        }      }    else      {      [ Jerrod's response was incorrect; set match flag so      [ no other said tests get processed      set(haveMatch);      [ also reset unknown word      unknownWordNum = 0;      print.at("\"Never you mind, that ain't it. I musta mistook ya for some "               "other fella.\"", 2, 7, 0);      [ conversation is over      vChatStatus = 0;      [ blacksmith is ready to return to work      vSmithStatus = 14;      }    }  }  [ always force input prompt to reset to normalset.string(inputPrompt, "%g69");accept.input();inputLength = 38;[ look around/lookif ((said("examine", "around") ||     said("examine")))  {  [ response depends on Jerrod's current location  if ((posn(ego, 0, 81, 25, 93) ||       posn(ego, 33, 81, 61, 93) ||       posn(ego, 69, 81, 130, 93) ||       posn(ego, 145, 96, 152, 107)))    {    [ near Sutter's quarters    if (posn(ego, 0, 81, 25, 93))      {      print("These are the livin' quarters of John Augustus Sutter!");      print("You don't need anything here!");      }          [ near candle shop    if (posn(ego, 33, 81, 61, 93))      {      print("This is the fort's candle shop!");      print("You don't need anything here!");      }          [ near smithy    if (posn(ego, 69, 81, 130, 93))      {      print("Whew, is it steamin' in here! There's a fire roarin', some metal "            "glowin' and a blacksmith sweatin'!!");      [ if Jerrod doesn't have the branding iron      if (!has("Branding iron"))        {        print("Leanin' against the wall is a branding iron.");        }      }    [ near gunsmith shop    if (posn(ego, 145, 96, 152, 107))      {      print("The gunsmith's shop is an excitin', but unecessary, stop on yer "            "tour of the fort.");      print("You don't need anything here!");      }    }  else    {    [ anywhere else    print("Looks like there's a blacksmith's shop in the corner!");    }  }  [ talk to blacksmithif ((said("speak", "blacksmith") ||     said("speak", "boy") ||     said("speak")))  {  [ if Jerrod is near the blacksmith  if (posn(ego, 96, 81, 124, 93))    {    [ if Jerrod has the branding iron    if (has("Branding iron"))      {      [ nothing special to say      print.at("\"Well, I declare! Hello there, uh, uh... Blast it! Uh, young "               "fella.Good to see ya again!\"", 2, 7, 0);      }    else      {      [ if blacksmith is ready to share Jake's secret      if (vChatStatus == 6)        {        [ force input prompt to update        set.string(inputPrompt, "%g69");        accept.input();        inputLength = 38;        print.at("\"Well, I'll be! I cain't believe it! Lean over here uh, uh, "                 "young fella and listen to me close.\"", 2, 7, 0);        print.at("\"I cain't be talkin' too loud 'bout this kinda thing.\"", 2, 7, 0);        }              [ if blacksmith is waiting for Jake's name      if (vChatStatus == 5)        {        print.at("\"That's it! And, uh, ya got a brother named uh, uh, dag bern "                 "it! Uh, uh...\"", 2, 7, 0);        [ force input prompt to update        set.string(inputPrompt, "Brothers name %g69");        accept.input();        inputLength = 25;        }            [ if blacksmith is waiting for Jerrod's name      if (vChatStatus == 4)        {        print.at("\"Yeah, that's it! An uh, yer first name wouldn't be, uh, "                 "shoot, uh... Uh, uh...\"", 2, 7, 0);        [ force input prompt to update        set.string(inputPrompt, "Enter first name %g69");        accept.input();        inputLength = 22;        }              [ if blacksmith is waiting for last name      if (vChatStatus == 3)        {        print.at("\"Yer last name ain't by chance uh, uh... Dern it, uh, "                 "uhhh...\"", 2, 7, 0);        [ force input prompt to update        set.string(inputPrompt, "Enter last name %g69");        accept.input();        inputLength = 23;        }              [ if blacksmith is waiting for Jerrod to say he's from      [ Brooklyn      if (vChatStatus == 2)        {        print.at("\"You wouldn't be from Brooklyn would ya?\"", 2, 7, 0);        [ force input prompt to update        set.string(inputPrompt, "yea or nay %g69");        accept.input();        inputLength = 28;        }      [ if blacksmith is waiting for Jerrod to say he's from      [ New York      if (vChatStatus == 1)        {        print.at("\"Can'tcha see, man, that I'm as busy as a one-armed "                 "paperhanger with an itch!\"", 2, 7, 0);        print.at("\"If you'd excuse me, I best be gettin' back to my work!\"", 2, 7, 0);        print.at("\"Hold on there, son. You ain't from the parts around, say, "                 "New York, would ya be?\"", 2, 7, 0);        [ status is already 1; this line is unnecessary        vChatStatus = 1;        [ force input prompt to update        set.string(inputPrompt, "yea or nay %g69");        accept.input();        inputLength = 28;        }      [ if conversation hasn't started      if (vChatStatus == 0)        {        print.at("\"Hang on there, fella. I'll be right with ya!\"", 2, 7, 0);        [ if smith isn't in process of moving back to start        if (vSmithStatus != 10 &&             vSmithStatus != 11 &&             vSmithStatus != 12)          {          [ set flag to begin talking sequence          set(fTalkToSmith);          }        }      }    }  else    {    print("It's awful loud 'round here. Better get closer!");    }  }  [ yesif (said("y"))  {  [ if Jerrod is close to blacksmith  if (posn(ego, 96, 81, 124, 93))    {    [ if no conversation    if (vChatStatus == 0)      {      [ 'yes' makes no sense      print("\"%w1\" what?");      }          [ if ready to share Jake's secret    if (vChatStatus == 6)      {      [ 'yes' makes no sense      print.at("\"%w1\" what?", 2, 14, 0);      [ force input prompt to normal      set.string(inputPrompt, "%g69");      accept.input();      inputLength = 38;      [ blacksmith tells Jerrod again that he's got a secret      print.at("\"Well, I'll be! I cain't believe it! Lean over here uh, uh, "               "young fella and listen to me close.\"", 2, 7, 0);      print.at("\"I cain't be talkin' too loud 'bout this kinda thing.\"", 2, 7, 0);      }          [ if Jerrod answers 'yes' to Brooklyn question    if (vChatStatus == 2)      {      [ blacksmith asks for last name      print.at("\"Yer last name ain't by chance uh, uh... Dern it, uh, "               "uhhh...\"", 2, 7, 0);      vChatStatus = 3;      [ force input prompt to update      set.string(inputPrompt, "Enter last name %g69");      accept.input();      inputLength = 23;      }          [ if Jerrod answers 'yes' to New York question    if (vChatStatus == 1)      {      [ blacksmith asks if Jerrod is from Brooklyn      print.at("\"You wouldn't be from Brooklyn would ya?\"", 2, 7, 0);      vChatStatus = 2;      [ force input prompt to update      set.string(inputPrompt, "yea or nay %g69");      accept.input();      inputLength = 28;      }    }  else    {    [ not near blacksmith - 'yes' makes no sense    print("\"%w1\" what?");    }  }  [ noif (said("n"))  {  [ if near blacksmith  if (posn(ego, 96, 81, 124, 93))    {    [ if no conversation is going on    if (vChatStatus == 0)      {      [ 'no' makes no sense      print("\"%w1\" what?");      }          [ if blacksmith is ready to share secret    if (vChatStatus == 6)      {      [ 'no' makes no sense      print.at("\"%w1\" what?", 2, 14, 0);      [ force input prompt back to normal      set.string(inputPrompt, "%g69");      accept.input();      inputLength = 38;      [ tell Jerrod about the secret again      print.at("\"Well, I'll be! I cain't believe it! Lean over here uh, uh, "               "young fella and listen to me close.\"", 2, 7, 0);      print.at("\"I cain't be talkin' too loud 'bout this kinda thing.\"", 2, 7, 0);      }          [ if anwering 'no' to Brooklyn question    if (vChatStatus == 2)      {      print.at("\"Pardon me, young fella. My mistake. I thought you was someone "               "else!\"", 2, 7, 0);      [ end conversation      vChatStatus = 0;      [ blacksmith is ready to return to work      vSmithStatus = 14;      }          [ if answering 'no' to New York question    if (vChatStatus == 1)      {      print.at("\"Pardon me, young fella. My mistake. I thought you was someone "               "else!\"", 2, 7, 0);      [ end conversation      vChatStatus = 0;      [ blacksmith is ready to return to work      vSmithStatus = 14;      }    }  else    {    [ no near blacksmith - 'no' makes no sense    print("\"%w1\" what?");    }  }  [ brand mule/use branding ironif ((said("brand", "donkey") ||     said("use", "iron") ||     said("use", "branding", "iron")))  {  [ if Jerrod has the branding iron  if (has("Branding iron"))    {    [ and if Jerrod has a mule    if ((has(LazyMule) || has("James' ol' mule")))      {      [ if Jerrod has the lazy mule      if (has(LazyMule))        {        [ if mule is already branded        if (isset(LazyMuleBranded))          {          print("This mule already has a brand on it!");          }        else          {          [ if branding iron is still hot          if (isset(fIronIsHot))            {            [ if close enough to the mule            if (MuleDistance < 15)              {              [ play score sound              sound(m.FoundGold, fMusicDone);              [ brand the mule              print("Ya take the red-hot iron and place it firmly on the mule's "                    "left rear haunch.");              print("It sizzles and stinks, but the mule takes it on all fours!");              set(LazyMuleBranded);              [ score three points              currentScore  += 3;              }            else              {              print("Ya gotta be closer to a mule than this!");              }            }          else            {            [ brand is cold; was it ever heated up?            if (vBrandTimer > 250)              {              print("Ya took too long, the branding iron cooled off!");              }            else              {              print("You've got everything ya need to do that but a hot, "                    "glowin' branding iron!");              }            }          }        }      [ if Jake has Jame's (Jake's) mule      if (has("James' ol' mule"))        {        print("This mule already has a brand on it!");        }      }    else      {      print("Ya got yerself a branding iron there, but ya got nothin' to brand!");      }    }  else    {    print("Ya got to have a branding iron if yer gonna do some brandin'!");    }  }  [ heat branding iron/place branding iron in fireif ((said("heat", "iron") ||     said("heat", "branding", "iron") ||     said("heat", "up", "iron") ||     said("heat", "up", "branding", "iron") ||     said("acquire", "iron", "hot") ||     said("acquire", "branding", "iron", "hot") ||     said("place", "iron", "fire") ||     said("place", "branding", "iron", "fire")))  {  [ if Jerrod has the branding iron  if (has("Branding iron"))    {    [ if Jerrod is close to the fire    if (posn(ego, 98, 86, 107, 86))      {      print("Ya put the branding iron into the depths of the coals. It comes "            "out glowin' red!!");      [ branding iron is now hot      set(fIronIsHot);      }    else      {      print("Ya gotta get closer to the fire.");      }    }  else    {    print("Ya got to have a branding iron if yer gonna do some brandin'!");    }  }  [ look candleif (said("examine", "candle"))  {  [ if in the candle shop  if (posn(ego, 33, 81, 61, 93))    {    print("It ain't surprisin' to see candles here, yer in a candle shop!");    }  else    {    print("There ain't no candles 'round here!");    }  }  [ look gun/get gunif ((said("examine", "gun") ||     said("acquire", "gun") ||     said("buy", "gun") ||     said("hold up", "gun")))  {  [ if in the gun shop  if (posn(ego, 145, 96, 152, 107))    {    print("The gunsmith is gone and, as always, the guns are safely stowed "          "away.");    }  else    {    print("There ain't no gun right here!");    }  }  [ look branding ironif ((said("examine", "branding", "iron") || said("examine", "iron")))  {  [ if Jerrod doesn't have the branding iron  if (!has("Branding iron"))    {    [ if Jerrod is in the smithy    if (posn(ego, 69, 81, 130, 93))      {      print("Leanin' against the wall is a branding iron.");      }    else      {      print("Ain't no branding iron in sight right here!");      }    }  }  [ get branding ironif ((said("acquire", "branding", "iron") ||     said("acquire", "iron") ||     said("buy", "branding", "iron") ||     said("buy", "iron")))  {  [ if Jerrod already has the branding iron  if (has("Branding iron"))    {    print("Ya already got a branding iron!");    }  else    {    [ if Jerrod is in the smithy    if (posn(ego, 69, 81, 130, 93))      {      print("\"Keep yer sticky fingers offa that branding iron, fella!\"");      }    else      {      print("Ain't no branding iron in sight right here!");      }    }  }  [ look man/look blacksmithif ((said("examine", "boy") || said("examine", "blacksmith")))  {  [ if in the smithy  if (posn(ego, 69, 81, 130, 93))    {    print("The man is a blacksmith and he's sweatin' up a storm!");    }  else    {    print("Ya see the blacksmith workin' inside his shop.");    }  }  [ use shovel/dig for goldif ((said("use", "shovel") ||     said("dig", "gold") ||     said("dig") ||     said("dig", "hole")))  {  [ if Jerrod has a shovel  if (has("Shovel"))    {    print("Diggin' ain't allowed here! Do that somewhere else.");    }  else    {    print("No shovel, no diggin'!");    }  }  [ use pan/pan for goldif ((said("use", "pan") ||     said("pan", "gold") ||     said("pan")))  {  print("Ya need to be in the water!");  }  [ look ground/look grassif ((said("examine", "dirt") || said("examine", "grass")))  {  print("The grass is kept short by all the animals!");  }  [ look doorif (said("examine", "door"))  {  print("These doors are fer walkin' through!");  }  [ look windowif (said("examine", "glass"))  {  print("The fort is fortunate to have so many windows!");  }  [ open doorif (said("open", "door"))  {  print("Just walk up to it.");  }  [ look wagon wheelif ((said("examine", "wheel") || said("examine", "cart", "wheel")))  {  print("Just outside the blacksmith shop is a wagon wheel.");  }  [ get wheelif ((said("acquire", "wheel") || said("acquire", "cart", "wheel")))  {  print("Why? It's busted and the blacksmith needs to fix it!");  }  [ look fort/look wallsif ((said("examine", "fort") || said("examine", "wall")))  {  print("Yer inside the walls of Sutter's Fort!");  }  [ tie up muleif ((said("tie", "up", "donkey") ||     said("tie", "donkey")))  {  print("There's nothin' to tie it to!");  }  [ tie mule to wheelif ((said("tie", "donkey", "wheel") ||     said("tie", "up", "donkey", "wheel") ||     said("tie", "donkey", "cart", "wheel") ||     said("tie", "up", "donkey", "cart", "wheel")))  {  print("That'll never hold it!");  }  [ use fireif (said("use", "fire"))  {  print("A grand idea, but fer what?");  }  [ look fireif (said("examine", "fire"))  {  [ if in the candle shop  if (posn(ego, 33, 81, 61, 93))    {    print("There's no fire burnin' in the candle shop.");    }  else    {    print("The roarin' fire is a dandy place fer heatin' up metal objects!");    }  }  [ get {stuff from Sutter's quarters}if ((said("acquire", "bed") ||     said("acquire", "table") ||     said("acquire", "desk") ||     said("acquire", "chair") ||     said("acquire", "carpet") ||     said("acquire", "pillow")))  {  [ if in Sutter's quarters  if (posn(ego, 0, 81, 25, 93))    {    print("That is John Augustus Sutter's personal property!");    }  else    {    [ reset match flag so main logic can provide a response    reset(haveMatch);    }  }  [ look {stuff from Sutter's quarters}if ((said("examine", "bed") ||     said("examine", "table") ||     said("examine", "desk") ||     said("examine", "chair") ||     said("examine", "carpet") ||     said("examine", "pillow")))  {  [ if in Sutter's quarters  if (posn(ego, 0, 81, 25, 93))    {    print("Even though it's John Augustus Sutter's personal %w2, there ain't "          "nothin' special about it!");    }  else    {    [ reset match flag so main logic can provide a response    reset(haveMatch);    }  }  [ look {stuff in candle shop}if ((said("examine", "fireplace") ||     said("examine", "shelf") ||     said("examine", "table") ||     said("examine", "brick")))  {  [ if in candle shop  if (posn(ego, 33, 81, 61, 93))    {    print("This is what you'd expect to see in a candle shop.");    }  else    {    [ reset match flag so main logic can provide a response    reset(haveMatch);    }  }  [ get anythingif (said("acquire", "anyword"))  {  [ if in candle shop  if (posn(ego, 33, 81, 61, 93))    {    print("Ya don't need that. You've wasted enough time here!");    }  else    {    [ reset match flag so main logic can provide a response    reset(haveMatch);    }  }  [ look fireplaceif ((said("examine", "fireplace") ||     said("examine", "stove")))  {  [ if in smithy  if (posn(ego, 69, 81, 130, 93))    {    print("The blacksmith builds a hot fire in this fireplace.");    }  else    {    [ reset match flag so main logic can provide a response    reset(haveMatch);    }  }  [ look metalif (said("examine", "metal"))  {  [ if in smithy  if (posn(ego, 69, 81, 130, 93))    {    print("The metal glows when the blacksmith takes it out of the fire.");    }  else    {    [ reset match flag so main logic can provide a response    reset(haveMatch);    }  }  Done:[ if an unknown word was enteredif (unknownWordNum > 0)  {  [ force input string back to normal  set.string(inputPrompt, "%g69");  accept.input();  inputLength = 38;  }  [ if Jake has a muleif ((has(LazyMule) || has("James' ol' mule")))  {  [ call mule logic to process mule related commands  call(lgc.Mule);  }return();[ **************************************[ MESSAGES[ **************************************#message 1 "These are the livin' quarters of John Augustus Sutter!"#message 2 "This is the fort's candle shop!"#message 3 "Whew, is it steamin' in here! There's a fire roarin', some metal glowin' and a blacksmith sweatin'!!"#message 4 "The gunsmith's shop is an excitin', but unecessary, stop on yer tour of the fort."#message 5 "Looks like there's a blacksmith's shop in the corner!"#message 6 "\"Can'tcha see, man, that I'm as busy as a one-armed paperhanger with an itch!\""#message 7 "\"If you'd excuse me, I best be gettin' back to my work!\""#message 8 "\"Hold on there, son. You ain't from the parts around, say, New York, would ya be?\""#message 9 "\"Well, I declare! Hello there, uh, uh... Blast it! Uh, young fella.Good to see ya again!\""#message 10 "yea or nay %g69"#message 11 "It's awful loud 'round here. Better get closer!"#message 12 "%g69"#message 13 "\"%w1\" what?"#message 14 "\"You wouldn't be from Brooklyn would ya?\""#message 15 "\"Yer last name ain't by chance uh, uh... Dern it, uh, uhhh...\""#message 16 "Enter last name %g69"#message 17 "\"Yeah, that's it! An uh, yer first name wouldn't be, uh, shoot, uh... Uh, uh...\""#message 18 "Enter first name %g69"#message 19 "\"That's it! And, uh, ya got a brother named uh, uh, dag bern it! Uh, uh...\""#message 20 "Brothers name %g69"#message 21 "\"Well, I'll be! I cain't believe it! Lean over here uh, uh, young fella and listen to me close.\""#message 22 "\"I cain't be talkin' too loud 'bout this kinda thing.\""#message 23 "\"Never you mind, that ain't it. I musta mistook ya for some other fella.\""#message 24 "\"I gotta message fer ya from yer brother. I ain't got no notion of his whereabouts, all I got is a message.\""#message 25 "\"He won't tell nobody of his whereabouts, but he gave me this to give to ya.\""#message 26 "\"Ain't got no idea what it's fer, but he wanted me to give it to ya.\""#message 27 "The soot-covered blacksmith hands you a branding iron."#message 28 "Now you know yer on the right trail to find yer brother. He must be on to somethin' big! REALLY BIG!"#message 29 "\"He wants ya to know that in these parts he's known as uh, uh... He's known as uh, uh, James, that's it, James!\""#message 30 "\"Pardon me, young fella. My mistake. I thought you was someone else!\""#message 31 "Ya got to have a branding iron if yer gonna do some brandin'!"#message 32 "Ya got yerself a branding iron there, but ya got nothin' to brand!"#message 33 "This mule already has a brand on it!"#message 34 "Ya take the red-hot iron and place it firmly on the mule's left rear haunch."#message 35 "It sizzles and stinks, but the mule takes it on all fours!"#message 36 "You've got everything ya need to do that but a hot, glowin' branding iron!"#message 37 "Ya gotta get closer to the fire."#message 38 "Ya put the branding iron into the depths of the coals. It comes out glowin' red!!"#message 39 "Ya took too long, the branding iron cooled off!"#message 40 "Ya gotta be closer to a mule than this!"#message 41 "It ain't surprisin' to see candles here, yer in a candle shop!"#message 42 "There ain't no candles 'round here!"#message 43 "The gunsmith is gone and, as always, the guns are safely stowed away."#message 45 "There ain't no gun right here!"#message 46 "\"Hang on there, fella. I'll be right with ya!\""#message 47 "Leanin' against the wall is a branding iron."#message 48 "Ain't no branding iron in sight right here!"#message 49 "Ya already got a branding iron!"#message 50 "\"Keep yer sticky fingers offa that branding iron, fella!\""#message 51 "The man is a blacksmith and he's sweatin' up a storm!"#message 52 "Ya see the blacksmith workin' inside his shop."#message 53 "There's no fire burnin' in the candle shop."#message 54 "That is John Augustus Sutter's personal property!"#message 55 "Even though it's John Augustus Sutter's personal %w2, there ain't nothin' special about it!"#message 56 "Ya don't need that. You've wasted enough time here!"#message 57 "This is what you'd expect to see in a candle shop."#message 58 "The metal glows when the blacksmith takes it out of the fire."#message 59 "The blacksmith builds a hot fire in this fireplace."#message 60 "Diggin' ain't allowed here! Do that somewhere else."#message 61 "No shovel, no diggin'!"#message 62 "Ya need to be in the water!"#message 63 "The grass is kept short by all the animals!"#message 64 "These doors are fer walkin' through!"#message 65 "The fort is fortunate to have so many windows!"#message 66 "Just walk up to it."#message 67 "Just outside the blacksmith shop is a wagon wheel."#message 68 "Why? It's busted and the blacksmith needs to fix it!"#message 69 "Yer inside the walls of Sutter's Fort!"#message 70 "There's nothin' to tie it to!"#message 71 "That'll never hold it!"#message 72 "A grand idea, but fer what?"#message 73 "The roarin' fire is a dandy place fer heatin' up metal objects!"#message 74 "You don't need anything here!"