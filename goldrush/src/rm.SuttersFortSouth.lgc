[***********************************************************[[ rm.SuttersFortSouth[ [ A panoramic view of the south side of Sutters Fort. It [ uses tiny views to represent Jerrod and other people and [ object that interact with the scene. The room is also used[ as a cutscene to show Jerrod's stagecoach ride from [ Sacramento to Sutter's Fort as the last scene in the [ journey from Brooklyn to California.[[***********************************************************[ **************************************[ LOCAL DEFINES[ **************************************#define oFlag                        o1#define oBanner                      o2#define oGate                        o3#define oStageCoach                  o4#define oWagon2                      o5#define oWagon1                      o6#define vBannerTimer               v220#define vTmpVal                    v221#define vStageStatus               v222#define vStageTimer                v223#define vWgn2MovePt                v224#define vWgn1MovePt                v225#define vWagon2Status              v226#define vWagon1Status              v227#define fGateMoved                 f220#define fGateOpen                  f221#define fStageMoved                f222#define fWagon2Moved               f223#define fWagon1Moved               f224[ **************************************[ FIRST CYCLE ONLY[ **************************************if (isset(newRoom))  {  [ load picture for current room  load.pic(currentRoom);    [ load views used in the room  load.view(vw.TinyJerrodMule);  load.view(vw.SacPeople);  load.view(vw.StageCoachCA);  load.view(vw.CaliforniaArt);    [ load sound used in the room  load.sound(m.California);    [ draw the picture  draw.pic(currentRoom);    [ if fadename flag is not set (meaning this is first time  [ Jerrod visits Sutters Fort via  the stagecoach from  [ Sacramento)  if (!isset(FadeName))    {    [ name banner    animate.obj(oBanner);    set.view(oBanner, vw.CaliforniaArt);    set.loop(oBanner, 2);    set.cel(oBanner, 0);    set.priority(oBanner, 15);    position(oBanner, 60, 139);    draw(oBanner);    ignore.objs(oBanner);    ignore.blocks(oBanner);    stop.cycling(oBanner);        [ stagecoach from Sacramento    animate.obj(oStagecoach);    set.view(oStagecoach, vw.StageCoachCA);    set.loop(oStagecoach, 0);    fix.loop(oStagecoach);    position(oStagecoach, 0, 124);    draw(oStagecoach);    [ stagecoach begins moving west along the road toward    [ the fort    move.obj(oStagecoach, 52, 124, 1, fStageMoved);    vStageStatus = 1;    }      [ wagon #1  animate.obj(oWagon1);  set.view(oWagon1, vw.SacPeople);  set.loop(oWagon1, 0);  fix.loop(oWagon1);  [ wagon #2  animate.obj(oWagon2);  set.view(oWagon2, vw.SacPeople);  set.loop(oWagon2, 1);  fix.loop(oWagon2);    [ flag that flies above the fort  animate.obj(oFlag);  set.view(oFlag, vw.CaliforniaArt);  set.loop(oFlag, 0);  position(oFlag, 87, 92);  draw(oFlag);  ignore.objs(oFlag);  ignore.blocks(oFlag);  start.cycling(oFlag);  vTmpVal = 3;  cycle.time(oFlag, vTmpVal);    [ corral gate  animate.obj(oGate);  set.view(oGate, vw.CaliforniaArt);  set.loop(oGate, 3);  [ starts closed  set.cel(oGate, 0);  position(oGate, 109, 113);  ignore.objs(oGate);  ignore.blocks(oGate);  set.priority(oGate, 8);  draw(oGate);  stop.cycling(oGate);    [ if not the first time visiting the fort  if (isset(FadeName))    {    [ add Jerrod    animate.obj(ego);    [ if Jerrod has a mule    if ((has(LazyMule) || has("James' ol' mule")))      {      [ use the view showing Jerrod and his mule      set.view(ego, vw.TinyJerrodMule);      }    else      {      [ if Jerrod doesn't have a mule, use a tiny person      [ view from the Sacramento people view      set.view(ego, vw.SacPeople);      set.loop(ego, 2);      fix.loop(ego);      }    [ add Jerrod to screen    draw(ego);    [ he begins motionless    egoDir = STOPPED;    }      [ show the picture  show.pic();    [ in this scene, ego object needs to cycle when not moving  reset(CycleAtRest);    [ if previous room was the cutscene arriving in California  if (previousRoom == cs.California)    {    [ play the music to announce Jerrod's arrival    sound(m.California, DoneNoAction);    }  }[ **************************************[ EVERY CYCLE[ **************************************[ if banner has not faded yet and timer is still activeif (!isset(FadeName) && vBannerTimer < 254)  {  [ increment timer  ++vBannerTimer;  [ after two hundred cycles  if (vBannerTimer == 200)    {    [ fade banner halfway    set.cel(oBanner, 1);    }  [ after 253 cycles  if (vBannerTimer == 253)    {    [ remove banner from screen    erase(oBanner);    [ set flag to show banner is done    set(FadeName);    }  }  [ if showing the cutscene of Jerrod arriving by stagecoach[ from Sacramento, and stagecoach reaches first pointif (isset(fStageMoved) && vStageStatus == 1)  {  [ move stagecoach to second point  reset(fStageMoved);  vStageStatus = 2;  move.obj(oStagecoach, 58, 123, 1, fStageMoved);  }  [ when stagecoach reaches second pointif (isset(fStageMoved) && vStageStatus == 2)  {  [ move stagecoach to third point  reset(fStageMoved);  vStageStatus = 3;  move.obj(oStagecoach, 102, 122, 1, fStageMoved);  }  [ when stagecoach reaches third pointif (isset(fStageMoved) && vStageStatus == 3)  {  [ move stagecoach to fourth point  reset(fStageMoved);  vStageStatus = 4;  move.obj(oStagecoach, 104, 120, 1, fStageMoved);  }  [ when stagecoach reaches fourth pointif (isset(fStageMoved) && vStageStatus == 4)  {  [ reset flag  reset(fStageMoved);  [ coach has reached the fort  vStageStatus = 10;  stop.cycling(oStagecoach);  }  [ when stagecoach reaches the fortif (vStageStatus == 10)  {  [ increment timer  ++vStageTimer;  [ after nine cycles  if (vStageTimer == 9)    {    [ reset timer, advance to next     [ stage (discharge passengers)    vStageTimer = 0;    vStageStatus = 5;    }  }  [ when passengers are ready to disembarkif (vStageStatus == 5)  {  [ advance to next stage  vStageStatus = 6;  [ add Jerrod  animate.obj(ego);  [ using tiny view from Sacramento population view  set.view(ego, vw.SacPeople);  set.loop(ego, 2);  fix.loop(ego);  position(ego, 108, 118);  draw(ego);  egoDir = STOPPED;  [ coach continues on its way  start.cycling(oStagecoach);  move.obj(oStagecoach, 126, 123, 1, fStageMoved);  }  [ when stagecoach reaches point 6if (isset(fStageMoved) && vStageStatus == 6)  {  [ move stagecoach to seventh point  reset(fStageMoved);  vStageStatus = 7;  move.obj(oStagecoach, 139, 124, 1, fStageMoved);  }  [ when stagecoach reaches point 7 (last point)if (isset(fStageMoved) && vStageStatus == 7)  {  reset(fStageMoved);  [ advance stage to show the stagecoach is done  vStageStatus = 8;  [ stagecoach is at edge; remove it from screen  erase(oStagecoach);  }  [ if wagon #1 is not currently driving across the screenif (vWagon1Status != 250)  {  [ random chance wagon #1 appears  random(210, 249, vWagon1Status);  [ one in forty chance  if (vWagon1Status == 230)    {    [ wagon #1 starts on left side    position(oWagon1, 1, 125);    draw(oWagon1);    [ moves to right side in three steps    move.obj(oWagon1, 53, 125, 1, fWagon1Moved);    [ set status to show wagon #1 is moving    vWagon1Status = 250;    [ to point 1    vWgn1MovePt = 1;    }  }  [ when wagon #1 gets to point 1if (isset(fWagon1Moved) && vWgn1MovePt == 1)  {  [ move to point 2  reset(fWagon1Moved);  vWgn1MovePt = 2;  move.obj(oWagon1, 85, 123, 1, fWagon1Moved);  }  [ when wagon #1 gets to point 2if (isset(fWagon1Moved) && vWgn1MovePt == 2)  {  [ move to point 3  reset(fWagon1Moved);  vWgn1MovePt = 3;  move.obj(oWagon1, 146, 125, 1, fWagon1Moved);  }  [ when wagon #1 gets to point 3if (isset(fWagon1Moved) && vWgn1MovePt == 3)  {  [ trip is over  reset(fWagon1Moved);  [ set move point to show trip is over  vWgn1MovePt = 5;  [ remove wagon #1 from screen  erase(oWagon1);  [ set status so wagon #1 can randomly reappear  ++vWagon1Status;  }  [ if wagon #2 is not currently driving across the screenif (vWagon2Status != 250)  {  [ random chance wagon #2 reappears  random(210, 249, vWagon2Status);  [ one in forty chance  if (vWagon2Status == 230)    {    [ wagon #2 starts on right side    position(oWagon2, 146, 123);    draw(oWagon2);    [ moves left in three steps    move.obj(oWagon2, 135, 122, 1, fWagon2Moved);    [ set status to show wagon #2 is moving    vWagon2Status = 250;    [ to point 1    vWgn2MovePt = 1;    }  }  [ when wagon #2 reaches to point 1if (isset(fWagon2Moved) && vWgn2MovePt == 1)  {  [ move to point 2  reset(fWagon2Moved);  vWgn2MovePt = 2;  move.obj(oWagon2, 45, 119, 1, fWagon2Moved);  }  [ when wagon #2 reaches point 2if (isset(fWagon2Moved) && vWgn2MovePt == 2)  {  [ move to point 3  reset(fWagon2Moved);  vWgn2MovePt = 3;  move.obj(oWagon2, 0, 123, 1, fWagon2Moved);  }  [ when wagon #2 reaches point 3if (isset(fWagon2Moved) && vWgn2MovePt == 3)  {  [ trip is over  reset(fWagon2Moved);  [ set move point to show trip is over  vWgn2MovePt = 5;  [ remove wagon #2 from screen  erase(oWagon2);  [ set status to allow wagon #2 to randomly reappear  ++vWagon2Status;  }  [ if Jerrod moves to line 113if (EgoY == 113)  {  [ force priority to 9; this will apply as long as Jerrod  [ stays at line 113 or above  set.priority(ego, 9);  }[ if Jerrod moves to line 114if (EgoY == 114)  {  [ use automatic priority; this will apply as long as  [ Jerrod stays at line 114 or below  release.priority(ego);  }  [ if Jerrod is near the gate and gate is not openif (posn(ego, 108, 113, 112, 113) && !isset(fGateOpen))  {  [ Jerrod waits while the gate is opened  stop.update(ego);  [ open the gate  end.of.loop(oGate, fGateMoved);  set(fGateOpen);  }  [ if Jerrod is not near the gate and the gate is openif (!posn(ego, 108, 113, 112, 113) && isset(fGateOpen))  {  [ close the gate  reverse.loop(oGate, fGateMoved);  reset(fGateOpen);  }  [ when gate finishes movingif (isset(fGateMoved))  {  [ allow Jerrod to continue moving  start.update(ego);  [ reset the flag  reset(fGateMoved);  }  [ **************************************[ CHECK FOR AN EXIT CONDITION[ **************************************[ if Jerrod is by the stablesif (posn(ego, 114, 113, 114, 113))  {  [ adjust Jerrod's position for the new room  position(ego, 13, 137);  [ force fadename flag (in case Jerrod   [ exits before timer expires)  set(FadeName);  new.room(rm.StableNorth); [ ##LE001##  }  [ if Jerrod is by the south gateif (posn(ego, 83, 111, 92, 113))  {  [ adjust Jerrod's position for the new room  position(ego, 53, 115);  [ force fadename flag (in case Jerrod   [ exits before timer expires)  set(FadeName);  new.room(rm.SF_SouthGate); [ ##LE002##  }    [ if Jerrod is going north of Sutters Fort on right sideif (posn(ego, 157, 114, 159, 114))  {  [ force fadename flag (in case Jerrod   [ exits before timer expires)  set(FadeName);  [ new position depends on whether or not   [ Jerrod has a mule with him  if ((has(LazyMule) || has("James' ol' mule")))    {    position(ego, 12, 84);    set.loop(ego, 1);    }  else    {    position(ego, 4, 84);    }  new.room(rm.SuttersFortNorth); [ ##LE003##  }  [ if Jerrod has a mule with him (this matters because size[ of ego object is different, so different posn command is[ needed to tell if ego object is in the area where a change[ in rooms is needed)if ((has(LazyMule) || has("James' ol' mule")))  {  [ if Jerrod is going left along the road  if (posn(ego, 153, 115, 153, 125))    {    [ force fadename flag (in case Jerrod     [ exits before timer expires)    set(FadeName);    [ adjust Jerrod's position for the new room    position(ego, 94, 98);    new.room(rm.SuttersFortArea); [ ##LE004##    }  }else  {  [ if Jerrod is going left along the road  if (posn(ego, 158, 115, 158, 123))    {    [ force fadename flag (in case Jerrod     [ exits before timer expires)    set(FadeName);    [ adjust Jerrod's position for the new room    position(ego, 94, 98);    new.room(rm.SuttersFortArea); [ ##LE005##    }  }[ if Jerrod is going to north of Sutters Fort on left edgeif (posn(ego, 0, 110, 8, 110))  {  [ force fadename flag (in case Jerrod   [ exits before timer expires)  set(FadeName);  if ((has(LazyMule) || has("James' ol' mule")))    {    [ adjust Jerrod's position for the new room    position(ego, 150, 100);    set.loop(ego, 1);    }  else    {    [ adjust Jerrod's position for the new room    position(ego, 155, 97);    }  new.room(rm.SuttersFortNorth); [ ##LE006##  }  [ if Jerrod is going right along the roadif (posn(ego, 1, 111, 1, 120))  {  [ force fadename flag (in case Jerrod   [ exits before timer expires)  set(FadeName);  [ adjust Jerrod's position for the new room  position(ego, 74, 93);  new.room(rm.SuttersFortArea); [ ##LE007##  }  [ if Jerrod is going south, into Sutters Fort Areaif (isset(egoHitSpecial))  {  [ force fadename flag (in case Jerrod   [ exits before timer expires)  set(FadeName);  position(ego, 82, 106);  [ adjust Jerrod's position for the new room  new.room(rm.SuttersFortArea); [ ##LE008##  }  [ **************************************[ PROCESS PLAYER INPUT[ **************************************[ if player hasn't provided input no need to do said testsif (!isset(haveInput))  {  goto(Done);  }  [ follow muleif (said("follow", "donkey"))  {  [ if Jerrod has a mule  if ((has(LazyMule) || has("James' ol' mule")))    {    print("Ya might try that somewhere nearby!");    }  else    {    print("Ya ain't got no mule!");    }  }  [ look aroundif ((said("examine", "around") || said("examine")))  {  print("Yer on the south side of Sutter's Fort. There's a road in front of "        "Sutter's Fort that follows the American River to the town of Coloma.");  }  [ look grassif (said("examine", "grass"))  {  print("This is green, wild grass!");  }  [ look flagif (said("examine", "flag"))  {  print("The Stars and Stripes are flyin' over the fort!");  }  [ look fortif ((said("examine", "fort") ||     said("examine", "wall") ||     said("examine", "fort", "wall") ||     said("examine", "wall", "fort")))  {  print("Sutter's fort is an impressive sight. The fort's main corral is built "        "onto the south wall of the fort.");  }  [ look roadif (said("examine", "path"))  {  print("The road heads east into the wilderness.");  }  [ look wagon/stagecoachif ((said("examine", "cart") || said("examine", "coach")))  {  print("A never-endin' stream of wagons use this road.");  }  [ ride wagon/catch wagonif ((said("ride", "cart") || said("catch", "cart")))  {  print("They won't stop fer ya!");  }  [ look Colomaif (said("examine", "coloma"))  {  print("Ya cain't see the town of Coloma from here. It's quite a ways east "        "along the American River.");  }  [ look riverif ((said("examine", "creek") ||     said("examine", "american", "creek") ||     said("examine", "sacramento", "creek")))  {  print("There's no river in sight right now, but the American River lies north "        "of the fort and the Sacramento River lies west of the fort.");  }  [ look wildernessif (said("examine", "wilderness"))  {  print("Wilderness surrounds Sutter's Fort.");  }  [ look gate/look doorif ((said("examine", "gate") ||     said("examine", "gate", "fort") ||     said("examine", "fort", "gate") ||     said("examine", "south", "gate") ||     said("examine", "corral", "gate") ||     said("examine", "gate", "corral") ||     said("examine", "door") ||     said("examine", "door", "fort") ||     said("examine", "fort", "door") ||     said("examine", "south", "door") ||     said("examine", "corral", "door") ||     said("examine", "door", "corral")))  {  print("The fort's south gate is always open.  The gate leadin' to the fort's "        "corral is open only when it's bein' used.");  }  [ look corralif ((said("examine", "corral") ||     said("examine", "fort", "corral") ||     said("examine", "corral", "fort") ||     said("examine", "fort", "main", "corral") ||     said("examine", "main", "corral", "fort")))  {  print("The fort's main corral is built onto the south wall of the fort. "        "There's a gate in the corral wall.");  }  [ open gateif ((said("open", "gate") ||     said("open", "corral", "gate") ||     said("open", "gate", "corral") ||     said("open", "door") ||     said("open", "corral", "door") ||     said("open", "door", "corral")))  {  print("Just walk up to it!");  }  [ use shovel/dig for goldif ((said("use", "shovel") ||     said("dig", "gold") ||     said("dig") ||     said("dig", "hole")))  {  [ if Jerrod has a shovel  if (has("Shovel"))    {    print("Diggin' ain't allowed here!  Do that somewhere else!!");    }  else    {    print("No shovel, no diggin'!");    }  }  [ use pan/pan for goldif ((said("use", "pan") ||     said("pan", "gold") ||     said("pan")))  {  print("Ya needs to be in the water!");  }  Done:return();[ **************************************[ MESSAGES[ **************************************#message 1 "Ya ain't got no mule!"#message 2 "Ya might try that somewhere nearby!"#message 3 "Yer on the south side of Sutter's Fort. There's a road in front of Sutter's Fort that follows the American River to the town of Coloma."#message 4 "This is green, wild grass!"#message 5 "The Stars and Stripes are flyin' over the fort!"#message 6 "Sutter's fort is an impressive sight. The fort's main corral is built onto the south wall of the fort."#message 7 "The road heads east into the wilderness."#message 8 "A never-endin' stream of wagons use this road."#message 9 "They won't stop fer ya!"#message 10 "Ya cain't see the town of Coloma from here. It's quite a ways east along the American River."#message 11 "There's no river in sight right now, but the American River lies north of the fort and the Sacramento River lies west of the fort."#message 12 "Wilderness surrounds Sutter's Fort."#message 13 "The fort's south gate is always open.  The gate leadin' to the fort's corral is open only when it's bein' used."#message 14 "The fort's main corral is built onto the south wall of the fort. There's a gate in the corral wall."#message 15 "Just walk up to it!"#message 40 "Diggin' ain't allowed here!  Do that somewhere else!!"#message 41 "No shovel, no diggin'!"#message 42 "Ya needs to be in the water!"