#define aGenesta    o1#define aPoof       o2#define aWave1      o3#define aWave2      o4#define aBlueFairy  o5#define aRedFairy   o6#define aRosella    o7#define roomScript  v220#define roomTimer   v221#define thePic  v224#define fairyStepSize   v227#define genestaCycles   v228#define savedCel    v230#define fairyX  v231#define fairyY  v232#define roomScriptDone  f220#define fairyMoved  f226#define musicDone   f234program.control();status.line.off();if (newRoom)  {  thePic = 70;  load.pic(thePic);  draw.pic(thePic);  discard.pic(thePic);  work = 78;  load.pic(work);  load.view(vTalkingHeads);  load.sound(Sound74);  load.view(vRosellaIntro);  set.view(aRosella, vRosellaIntro);  animate.obj(aRosella);  position(aRosella, 120, 127);  set.loop(aRosella, 5);  if (isset(f68))    {    draw(aRosella);    set.cel(aRosella, 1);    stop.update(aRosella);    }  else    {    set.cel(aRosella, 0);    }  load.view(vGenesta);  set.view(aGenesta, vGenesta);  animate.obj(aGenesta);  set.priority(aGenesta, 12);  ignore.blocks(aGenesta);  ignore.horizon(aGenesta);  if (isset(f68))    {    position(aGenesta, 125, 128);    draw(aGenesta);    set.loop(aGenesta, 4);    fix.loop(aGenesta);    set.cel(aGenesta, 0);    genestaCycles = 17;    cycle.time(aGenesta, genestaCycles);    }  else    {    position(aGenesta, 0, 39);    set.loop(aGenesta, 0);    fix.loop(aGenesta);    }  load.view(vBlueFairy);  set.view(aBlueFairy, vBlueFairy);  animate.obj(aBlueFairy);  set.priority(aBlueFairy, 8);  ignore.blocks(aBlueFairy);  ignore.horizon(aBlueFairy);  if (isset(f68))    {    position(aBlueFairy, 135, 80);    draw(aBlueFairy);    }  else    {    position(aBlueFairy, 0, 20);    }  load.view(vRedFairy);  set.view(aRedFairy, vRedFairy);  animate.obj(aRedFairy);  set.priority(aRedFairy, 8);  ignore.blocks(aRedFairy);  ignore.horizon(aRedFairy);  if (isset(f68))    {    position(aRedFairy, 112, 85);    draw(aRedFairy);    }  else    {    position(aRedFairy, 14, 20);    }  animate.obj(aWave1);  animate.obj(aWave2);  set.view(aWave1, vGenesta);  set.view(aWave2, vGenesta);  set.loop(aWave1, 7);  set.loop(aWave2, 6);  work = 2;  cycle.time(aWave1, work);  cycle.time(aWave2, work);  step.time(aWave1, work);  position(aWave1, 49, 122);  position(aWave2, 49, 156);  ignore.objs(aWave1);  ignore.objs(aWave2);  set.priority(aWave1, 5);  set.priority(aWave2, 5);  reverse.cycle(aWave2);  draw(aWave1);  draw(aWave2);  set.view(aPoof, vGenesta);  animate.obj(aPoof);  position(aPoof, 114, 130);  set.loop(aPoof, 5);  set.cel(aPoof, 0);  stop.update(aPoof);  set(roomScriptDone);  savedCel = 0;  v229 = 0;  if (isset(f68))    {    set(fairyMoved);    }  else    {    reset(fairyMoved);    }  show.pic();  return();  }if ((roomTimer > 0) && (aSecondPassed))  {  --roomTimer;  if (roomTimer <= 0)    {    close.window();    set(roomScriptDone);    }  }if ((!isset(f68)) &&     (isset(f221)))  {  current.cel(aPoof, savedCel);  if (savedCel == 3)    {    reset(f221);    draw(aRosella);    stop.update(aRosella);    }  }if (isset(f225))  {  reset(f225);  move.obj(aBlueFairy, 135, 80, 1, fairyMoved);  move.obj(aRedFairy, 112, 85, 1, fairyMoved);  }if (fairyMoved)  {  reset(fairyMoved);  wander(aBlueFairy);  wander(aRedFairy);  set(f227);  }if ((isset(f227)) &&     (!isset(f232)))  {  get.posn(aBlueFairy, fairyX, fairyY);  if (fairyX < 101)    {    normal.motion(aBlueFairy);    fairyX = 3;    set.dir(aBlueFairy, fairyX);    reset(f228);    }  else    {    if (!isset(f228))      {      wander(aBlueFairy);      set(f228);      }    }  get.posn(aBlueFairy, fairyX, fairyY);  if ((fairyY < 73 ||       fairyY > 111))    {    normal.motion(aBlueFairy);    if (fairyY > 90)      {      fairyY = 2;      }    else      {      fairyY = 6;      }    set.dir(aBlueFairy, fairyY);    reset(f228);    }  else    {    if (!isset(f228))      {      wander(aBlueFairy);      set(f228);      }    }  get.posn(aRedFairy, fairyX, fairyY);  if (fairyX < 101)    {    normal.motion(aRedFairy);    fairyX = 3;    set.dir(aRedFairy, fairyX);    reset(f229);    }  else    {    if (!isset(f229))      {      wander(aRedFairy);      set(f229);      }    }  get.posn(aRedFairy, fairyX, fairyY);  if ((fairyY < 73 ||       fairyY > 111))    {    normal.motion(aRedFairy);    if (fairyY > 90)      {      fairyY = 2;      }    else      {      fairyY = 6;      }    set.dir(aRedFairy, fairyY);    reset(f229);    }  else    {    if (!isset(f229))      {      wander(aRedFairy);      set(f229);      }    }  }if ((roomScriptDone) && (!isset(f68)))  {  reset(roomScriptDone);  ++roomScript;  if (roomScript == 1)    {    load.sound(Sound74);    sound(Sound74, musicDone);    set(f221);    start.update(aPoof);    draw(aPoof);    work5 = 6;    cycle.time(aPoof, work5);    end.of.loop(aPoof, roomScriptDone);    current.cel(aPoof, savedCel);    }  if (roomScript == 2)    {    erase(aPoof);    draw(aGenesta);    move.obj(aGenesta, 104, 77, 0, roomScriptDone);    draw(aBlueFairy);    move.obj(aBlueFairy, 29, 49, 0, roomScriptDone);    draw(aRedFairy);    move.obj(aRedFairy, 49, 62, 0, roomScriptDone);    }  if (roomScript == 3)    {    move.obj(aGenesta, 125, 128, 0, roomScriptDone);    move.obj(aBlueFairy, 104, 49, 0, f225);    move.obj(aRedFairy, 112, 62, 0, f225);    }  if (roomScript == 4)    {    set.cel(aRosella, 1);    force.update(aRosella);    set.loop(aGenesta, 3);    fix.loop(aGenesta);    v225 = 2;    cycle.time(aGenesta, v225);    start.cycling(aGenesta);    set(roomScriptDone);    }  if (roomScript == 5)    {    set(leaveWindow);    roomTimer = 7;    print.at("The lovely fairy speaks. \"I am the fairy, Genesta. Welcome to "             "Tamir!\"", 1, 3, 35);    }  if (roomScript == 6)    {    new.room(Logic78);    }  }if ((isset(f68)) &&     (isset(f223)))  {  current.cel(aGenesta, savedCel);  if (savedCel == 2)    {    reset(f223);    set.cel(aPoof, 0);    draw(aPoof);    set(f221);    end.of.loop(aPoof, f230);    current.cel(aPoof, v229);    }  }if ((isset(f221)) &&     (isset(f68)))  {  current.cel(aPoof, v229);  if (v229 == 2)    {    set.loop(aRosella, 6);    set.cel(aRosella, 1);    force.update(aRosella);    }  }if (isset(f230))  {  reset(f230);  erase(aPoof);  set(roomScriptDone);  }if (isset(f222))  {  reset(f222);  v225 = 2;  cycle.time(aGenesta, v225);  set.loop(aGenesta, 3);  cycle.time(aGenesta, work);  start.cycling(aGenesta);  }if (isset(f224))  {  reset(f224);  stop.update(aRosella);  }if (isset(f231))  {  fairyStepSize = 2;  step.size(aBlueFairy, fairyStepSize);  step.size(aRedFairy, fairyStepSize);  move.obj(aBlueFairy, 0, 20, 0, f231);  move.obj(aRedFairy, 14, 20, 0, f231);  }if (isset(f232))  {  get.posn(aGenesta, v222, v223);  if (v222 == 107)    {    set.loop(aRosella, 6);    set.cel(aRosella, 0);    force.update(aRosella);    }  }if ((isset(roomScriptDone)) &&     (isset(f68)))  {  reset(roomScriptDone);  ++roomScript;  if (roomScript == 1)    {    load.sound(Sound79);    sound(Sound79, musicDone);    set(leaveWindow);    roomTimer = 10;    print.at("The beautiful fairy points eastward. \"Lolotte's castle overlooks "             "Tamir from the great mountains.\"", 1, 3, 35);    end.of.loop(aGenesta, f222);    }  if (roomScript == 2)    {    set(leaveWindow);    roomTimer = 10;    print.at("Genesta looks weaker as she says, \"There is not much more I can "             "do, Rosella. As it is, it will be difficult for me to fly home "             "again.\"", 1, 3, 35);    }  if (roomScript == 3)    {    set(leaveWindow);    roomTimer = 10;    print.at("\"One thing I must do for you, though. I shall disguise you as a "             "peasant girl so as not to attract attention.\"", 1, 3, 35);    }  if (roomScript == 4)    {    set(f223);    set.loop(aGenesta, 2);    fix.loop(aGenesta);    set.cel(aGenesta, 0);    work5 = 6;    cycle.time(aGenesta, work5);    end.of.loop(aGenesta, roomScriptDone);    current.cel(aGenesta, savedCel);    }  if (roomScript == 5)    {    set.loop(aGenesta, 3);    fix.loop(aGenesta);    v225 = 2;    cycle.time(aGenesta, v225);    start.cycling(aGenesta);    }  if (roomScript == 6)    {    set(leaveWindow);    roomTimer = 9;    print.at("\"Th-thank-you, Genesta...I think,\" Rosella stammers.", 1, 3, 35);    start.update(aRosella);    set.loop(aRosella, 7);    set.cel(aRosella, 0);    v226 = 11;    cycle.time(aRosella, v226);    end.of.loop(aRosella, f224);    }  if (roomScript == 7)    {    roomTimer = 2;    }  if (roomScript == 8)    {    set(leaveWindow);    roomTimer = 9;    print.at("\"It will be better for you,\" the fairy says. \"Well, I must be "             "off while I can still fly. I KNOW you can do it!\"", 1, 3, 35);    }  if (roomScript == 9)    {    set(leaveWindow);    print.at("\"Good-bye, good luck.\"", 1, 6, 26);    roomTimer = 3;    }  if (roomScript == 10)    {    thePic = 2;    set.loop(aGenesta, 1);    fix.loop(aGenesta);    cycle.time(aGenesta, thePic);    start.cycling(aGenesta);    start.update(aGenesta);    ignore.blocks(aGenesta);    ignore.horizon(aGenesta);    move.obj(aGenesta, 75, 128, 0, roomScriptDone);    set(f232);    normal.motion(aBlueFairy);    normal.motion(aRedFairy);    move.obj(aBlueFairy, 10, 40, 0, f231);    move.obj(aRedFairy, 24, 40, 0, f231);    }  if (roomScript == 11)    {    move.obj(aGenesta, 0, 53, 0, roomScriptDone);    }  if (roomScript == 12)    {    erase(aGenesta);    erase(aBlueFairy);    erase(aRedFairy);    stop.update(aWave2);    set(leaveWindow);    roomTimer = 6;    if (isset(f233))      {      print.at("King's Quest IV: The Perils of Rosella.  The latest thrilling "               "chapter in the continuing King's Quest saga.", 19, 6, 30);      }    else      {      print.at("King's Quest IV: The Perils of Rosella.  The latest thrilling "               "chapter in the continuing King's Quest saga.", 16, 6, 30);      }    }  if (roomScript == 13)    {    work = 78;    draw.pic(work);    erase(aRosella);    erase(aWave1);    erase(aWave2);    add.to.pic(vTalkingHeads, 7, 0, 59, 148, 5, 5);    add.to.pic(vTalkingHeads, 7, 1, 75, 148, 5, 5);    add.to.pic(vTalkingHeads, 7, 2, 87, 148, 5, 5);    show.pic();    roomTimer = 6;    }  if (roomScript == 14)    {    new.room(rmDemoSelect);    }  }return();[ Messages#message 21 "The lovely fairy speaks. \"I am the fairy, Genesta. Welcome to Tamir!\""#message 22 "Rosella looks awestruck at the fairy. She is stunningly beautiful! But still there is a certain sadness to her."#message 23 "Genesta looks sadder than ever. \"You're wrong, Rosella. You see, I'm losing my magical powers. Yesterday as I was strolling through the woods, Lolotte, the evil fairy, caught me unawares and stole my magic talisman.\""#message 24 "The fairy sighs, \"She yanked it from my neck and raced away screeching with laughter. Immediately I felt my powers diminishing and my body weakening. I will die in 24 hours if my talisman is not returned.\""#message 25 "Intently, Genesta looks at Rosella. \"Lolotte is very evil and will use the talisman to bring more evil to Tamir. Now I fear it will contaminate my whole country!\""#message 26 "Rosella is unsure as to what SHE can do. Meekly, she asks, \"I want to help you, but how?\""#message 27 "\"You can do more than you think, Rosella,\" Genesta assures her. \"I believe you will be able to penetrate Lolotte's domain.\""#message 28 "Suddenly, Rosella remembers the tiny tree. \"Can you tell me where to find the magic fruit?\""#message 29 "Remorsefully, Genesta looks at Rosella. \"It will not be easy to reach the tree. It grows on a tiny island within a vast swamp on the other side of the great mountains.\""#message 30 "Bravely fighting back tears, Rosella says, \"I will help you in any way I can, Genesta. How can I find Lolotte?\""#message 31 "The beautiful fairy points eastward. \"Lolotte's castle overlooks Tamir from the great mountains.\""#message 32 "Genesta looks weaker as she says, \"There is not much more I can do, Rosella. As it is, it will be difficult for me to fly home again.\""#message 33 "\"One thing I must do for you, though. I shall disguise you as a peasant girl so as not to attract attention.\""#message 34 "\"Th-thank-you, Genesta...I think,\" Rosella stammers."#message 35 "\"It will be better for you,\" the fairy says. \"Well, I must be off while I can still fly. I KNOW you can do it!\""#message 36 "\"Good-bye, good luck.\""#message 37 "King's Quest IV: The Perils of Rosella.  The latest thrilling chapter in the continuing King's Quest saga."#message 220 "Finally, Rosella speaks. \"I know you would like me to help you in some way, but I don't know how I could help a fairy.\""#message 250 "\"Further, I can not send you home without my talisman.\""