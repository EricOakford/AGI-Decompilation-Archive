#define aValanice   o1#define aGraham o2#define aAlex   o3#define aHat    o4#define aMirror o5#define aRosella    o7#define roomScript  v220#define roomTimer   v223#define myStepSize  v224#define myStepTime  v225#define grahamCel   v226#define roomScriptDone  f220#define hatMoved        f221#define startThrowing   f222#define throwHat  f223#define musicDone       f225#define isMonochrome    f226program.control();status.line.off();if (newRoom)  {  set.horizon(34);  prevent.input();  work = 71;  load.pic(work);  draw.pic(work);  discard.pic(work);  load.view(vGraham);  load.view(vGrahamThrowHat);  load.view(View71);  load.view(vRosellaIntro);  load.view(vMirror);  load.sound(Sound70);  animate.obj(aGraham);  if (!heartAttack)    {    set.view(aGraham, vGraham);    position(aGraham, 60, 116);    set.loop(aGraham, 0);    set.cel(aGraham, 2);    }  else    {    set.view(aGraham, vGrahamThrowHat);    position(aGraham, 65, 116);    set.loop(aGraham, 1);    set.cel(aGraham, 0);    }  stop.cycling(aGraham);  draw(aGraham);  stop.update(aGraham);  animate.obj(aValanice);  set.view(aValanice, vGrahamThrowHat);  set.loop(aValanice, 2);  set.cel(aValanice, 0);  position(aValanice, 63, 106);  stop.cycling(aValanice);  draw(aValanice);  stop.update(aValanice);  animate.obj(aAlex);  set.view(aAlex, View71);  if (!heartAttack)    {    position(aAlex, 108, 133);    }  else    {    position(aAlex, 127, 133);    }  stop.cycling(aAlex);  set.loop(aAlex, 0);  set.cel(aAlex, 4);  draw(aAlex);  stop.update(aAlex);  animate.obj(aRosella);  set.view(aRosella, vRosellaIntro);  if (!heartAttack)    {    position(aRosella, 101, 120);    }  else    {    position(aRosella, 120, 120);    }  set.loop(aRosella, 0);  set.cel(aRosella, 5);  stop.cycling(aRosella);  draw(aRosella);  stop.update(aRosella);  animate.obj(aMirror);  set.view(aMirror, vMirror);  position(aMirror, 73, 51);  stop.cycling(aMirror);  set.loop(aMirror, 1);  set.cel(aMirror, 1);  draw(aMirror);  stop.update(aMirror);  if (!heartAttack)    {    animate.obj(aHat);    set.view(aHat, vGrahamThrowHat);    set.loop(aHat, 0);    fix.loop(aHat);    set.cel(aHat, 3);    stop.cycling(aHat);    position(aHat, 16, 109);    draw(aHat);    stop.update(aHat);    }  else    {    add.to.pic(vGrahamThrowHat, 0, 3, 150, 126, 4, 2);    }  add.to.pic(vGrahamThrowHat, 3, 0, 16, 129, 4, 2);  if (!heartAttack)    {    set.view(aRosella, View71);    set.loop(aRosella, 2);    set.cel(aRosella, 0);    fix.loop(aRosella);    set.view(aAlex, View71);    set.loop(aAlex, 1);    fix.loop(aAlex);    }  if (heartAttack)    {    roomScript = 1;    roomTimer = 1;    }  else    {    set(roomScriptDone);    }  grahamCel = 0;  show.pic();  return();  }if ((roomTimer > 0) && (aSecondPassed) && (!hatMoved))  {  --roomTimer;  reset(roomScriptDone);  if (roomTimer <= 0)    {    set(roomScriptDone);    }  }if ((roomTimer > 0) && (aSecondPassed) && (hatMoved))  {  --roomTimer;  reset(roomScriptDone);  if (roomTimer <= 0)    {    close.window();    set(roomScriptDone);    reset(hatMoved);    }  }if (throwHat)  {  current.cel(aGraham, grahamCel);  if (grahamCel == 4)    {    reset(throwHat);    myStepSize = 4;    work5 = 2;    reverse.cycle(aHat);    cycle.time(aHat, work5);    step.size(aHat, myStepSize);    draw(aHat);    start.cycling(aHat);    move.obj(aHat, 113, 60, 1, hatMoved);    set(roomScriptDone);    }  }if (roomScriptDone && !heartAttack)  {  reset(roomScriptDone);  ++roomScript;  if (roomScript == 1)    {    sound(Sound70, musicDone);    roomTimer = 5;    }  if (roomScript == 2)    {    set(leaveWindow);    roomTimer = 11;    print.at("With the return of his long-lost son, Alexander, and the rescue "             "of his daughter, Rosella, from the terrible dragon, old King "             "Graham decides it's time to pass on his adventurer's hat to "             "younger blood.", 14, 3, 37);    }  if (roomScript == 3)    {    close.window();    start.update(aGraham);    start.cycling(aGraham);    set.cel(aGraham, 3);    move.obj(aGraham, 20, 129, 1, roomScriptDone);    }  if (roomScript == 4)    {    move.obj(aGraham, 17, 129, 1, roomScriptDone);    }  if (roomScript == 5)    {    start.update(aHat);    erase(aHat);    move.obj(aGraham, 57, 129, 1, roomScriptDone);    }  if (roomScript == 6)    {    move.obj(aGraham, 68, 116, 1, roomScriptDone);    }  if (roomScript == 7)    {    stop.update(aGraham);    set.loop(aGraham, 0);    force.update(aGraham);    set.cel(aGraham, 3);    position(aHat, 76, 80);    set.cel(aHat, 0);    set.priority(aHat, 15);    set(leaveWindow);    if (isMonochrome)      {      print.at("He flings the battered hat towards his children while his wife, "               "Queen Valanice, proudly looks on.", 20, 3, 37);      }    else      {      print.at("He flings the battered hat towards his children while his wife, "               "Queen Valanice, proudly looks on.", 18, 3, 37);      }    roomTimer = 3;    }  if (roomScript == 8)    {    myStepTime = 3;    set.loop(aGraham, 2);    set.cel(aGraham, 0);    start.update(aGraham);    set(throwHat);    cycle.time(aGraham, myStepTime);    end.of.loop(aGraham, startThrowing);    current.cel(aGraham, grahamCel);    }  if (roomScript == 9)    {    start.update(aRosella);    cycle.time(aRosella, myStepTime);    start.cycling(aRosella);    step.time(aRosella, myStepTime);    start.update(aAlex);    cycle.time(aAlex, myStepTime);    start.cycling(aAlex);    step.time(aAlex, myStepTime);    move.obj(aRosella, 125, 120, 1, hatMoved);    move.obj(aAlex, 132, 133, 1, hatMoved);    roomTimer = 2;    }  if (roomScript == 10)    {    set(heartAttack);    close.window();    new.room(Logic71);    }  }if ((heartAttack) && (roomScriptDone))  {  reset(roomScriptDone);  ++roomScript;  if (roomScript == 2)    {    set(leaveWindow);    if (isMonochrome)      {      print.at("\"Help me,\" he rasps.", 19, 6, 30);      }    else      {      print.at("\"Help me,\" he rasps.", 17, 6, 30);      }    set(roomScriptDone);    }  if (roomScript == 3)    {    work = 3;    start.update(aGraham);    cycle.time(aGraham, work);    end.of.loop(aGraham, roomScriptDone);    }  if (roomScript == 4)    {    set(roomScriptDone);    stop.update(aGraham);    }  if (roomScript == 5)    {    start.update(aValanice);    end.of.loop(aValanice, roomScriptDone);    work5 = 2;    start.update(aRosella);    step.size(aRosella, work5);    cycle.time(aRosella, work5);    start.cycling(aRosella);    move.obj(aRosella, 100, 120, 1, roomScriptDone);    start.update(aAlex);    step.size(aAlex, work5);    cycle.time(aAlex, work5);    start.cycling(aAlex);    move.obj(aAlex, 107, 133, 1, roomScriptDone);    }  if (roomScript == 6)    {    new.room(Logic72);    }  }return();[ Messages#message 1 "With the return of his long-lost son, Alexander, and the rescue of his daughter, Rosella, from the terrible dragon, old King Graham decides it's time to pass on his adventurer's hat to younger blood."#message 2 "He flings the battered hat towards his children while his wife, Queen Valanice, proudly looks on."#message 3 "The hat arches through the air."#message 4 "King Graham experiences a terrible squeezing pain in his chest."#message 5 "\"Help me,\" he rasps."#message 6 "The adventurer's hat lies, unclaimed, upon the floor...forgotten."#message 7 "King Graham lies weakly in bed, Father Death hovering near."#message 8 "Grief suddenly overwhelming her, Rosella runs from the room."#message 9 "\"Oh, Father!\" she sobs. \"You're still young; you should have many years ahead of you! Oh, I wish I could help you, Father!\""#message 10 "Rosella looks up but sees no one. \"Who's speaking to me?\""#message 11 "Rosella sees an image in the mirror. \"Wh-who are you?\" she queries."#message 12 "\"I am the fairy, Genesta. In my land of Tamir there is a remarkable tree. This tiny tree needs one hundred years to bear a single fruit.\""#message 13 "Rosella is much heartened by this news! \"Where is the land of Tamir?\""#message 14 "Genesta smiles. \"Tamir is very far away. But with my magic, I can bring you here.\""#message 15 "Rosella senses that there is more to the story. \"But, I suppose there are some problems?\""#message 16 "Again, Genesta smiles. \"Yes, you are correct, Rosella. If you are willing to come to Tamir I will explain the situation.\""#message 17 "Confused, Rosella says, \"I don't know! What if I can't help you or find the tree?\""#message 18 "Genesta pleads, \"You must decide NOW, Rosella. My powers are growing weaker by the minute.\""#message 19 "Now, the fairy is but a faint glimmer, and her voice barely audible. \"If you care for your father, say `yes' now!...\" And suddenly she's gone."#message 20 "\"YES!!\""#message 92 "\"Do you really mean that?\" a soft voice asks."#message 102 "\"I am,\" the voice says. \"Look in the magic mirror.\""#message 120 "\"But, this is no ordinary fruit; for if a person were to eat it, one would find that good health and well-being would be theirs for many years.\""#message 160 "\"However, once I bring you here, I can't send you back; you will have to help me first.\""#message 200 "Debug0"#message 201 "Debug1"#message 202 "Debug2"#message 203 "Suddenly...!"#message 204 "Debug4"#message 205 "Debug5"#message 206 "Debug6"